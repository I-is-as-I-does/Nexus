/*! Nexus | (c) 2021 I-is-as-I-does | AGPLv3 license */
"use strict";(self.webpackChunknexus=self.webpackChunknexus||[]).push([[22],{625:(e,t,n)=>{n.d(t,{N:()=>ee});var a=n(696),d=n(425),i=n(931),r=n(947),c=n(180),l=n(75),o=n(85),s=n(451),u=n(253);function p(){var e=(0,r.O1)(10);return{nexus:a.Gd,author:{handle:"Anonymous-"+(0,r.Iy)(100,999),about:"",url:""},threads:[h(e)],index:[e]}}function h(e){return{id:e,name:e,description:"...",record:{timestamp:(new Date).toISOString().substr(0,16),main:"...",aside:"",media:{url:"",type:"",caption:""}},linked:[]}}var v=n(549),f=n(142);function x(e,t){for(var n=(0,d.gd)("P","nx-edit-category"),a=0;a<t;a++){var i=(0,d.gd)("SPAN","nx-edit-category-indent");i.textContent="|",n.append(i)}var r=(0,d.gd)("SPAN");return r.textContent=(0,l.GY)(e),(0,f.w)(r,e),n.append(r),n}function g(){var e=(0,d.gd)("BUTTON","nx-add-link");return e.type="button",e.textContent="+",e}const D=["youtube","vimeo","soundcloud"],m={image:["jpg","jpeg","gif","svg","png","webp"],video:["mp4","webm"],audio:["mp3"]};function b(e){return{dataUrl:"nx-edit",srcData:e,threadId:"/",threadIndex:-1}}const k=(0,c.hb)();var E,I,y,C={dataUrl:"nx-edit",srcData:null,threadId:"/",threadIndex:-1},N=new CustomEvent("IndexChange"),O=!1,T={ctrls:{prev:{symbol:"↶",elm:null},next:{symbol:"↷",elm:null}},position:0,count:1},L=[],S=null,w=null,U=null,V={up:"↑",down:"↓"},j={handle:null,url:null,about:null};function A(e,t){C.srcData.index.splice(t,0,C.srcData.index.splice(e,1)[0]),C.srcData.threads.splice(t,0,C.srcData.threads.splice(e,1)[0])}function P(e,t){var n=C.srcData.index.indexOf(e);t.up.disabled=0==n,n+1==C.srcData.index.length?t.down.disabled=!0:t.down.disabled=!1}function B(e,t){S.removeChild(e),S.insertBefore(e,t),t.dispatchEvent(N),e.dispatchEvent(N)}function F(e,t,n){var c=(0,d.gd)("DIV","nx-edit-distant-link"),l={url:null,id:null,list:(0,d.gd)("DIV","nx-distant-ids")},o={id:null,url:null};l.id=G(["threads",t,"linked",n,"id"],null,o),l.url=G(["threads",t,"linked",n,"url"],(function(e,t){!function(e,t,n,i){var c=function(n=[]){var a=e.id.value;a&&n.includes(a)||(e.id.value="/"),"/"!=a&&n.unshift("/"),e.id.pattern="("+n.join("|")+")";var i=(0,d.Sb)(n,e.id,null,"nx-edit-linked-id");t.id.lastChild.replaceWith(i)};n&&i?(0,v.P)(n).then((e=>{c(Array.from(e.index))})).catch((()=>{e.url.pattern=a.Ni+"(?<!"+(0,r.hr)(n)+")",e.url.dispatchEvent(new window.Event("change"))})):c()}(o,l,e,t)}),o),Object.values(l).forEach((e=>{e&&(0,i.am)(c,e,!1,!0,200)}));var s,u=((s=(0,d.gd)("BUTTON","nx-delete-link")).type="button",s.textContent="-",s),p=(0,d.gd)("DIV","nx-distant-link-action");p.append(u),c.append(p),u.addEventListener("click",(()=>{var a=function(a){if(a)(0,i.Vv)(c,200,(function(){c.remove()}));else if(n==C.srcData.threads[t].linked.length-1)(0,i.am)(e,c,!1,!0,200);else{var d=e.childNodes[n];e.insertBefore(c,d),(0,i.YQ)(c,200)}};Q(a),a(!0)})),e.append(c)}function W(e,t){var n=(0,d.gd)("LI");return n.append(t),C.threadId!=e&&(n.style.display="none"),(0,c.Ek)((function(t){"nx-edit"==t.dataUrl&&(C=t,t.threadId==e?setTimeout((function(){(0,i.YQ)(n,200)}),200):(0,i.Vv)(n,200))})),n}function Y(e,t){var n=Object.assign({},C);return n.threadId=t,n.threadIndex=e,n}function M(e,t){var n={index:{parent:S,child:null,link:null,del:null},local:{parent:w,child:null},distant:{parent:U,child:null}};return n.index.child=(0,d.gd)("LI"),n.index.link=function(e,t){var n=Y(e,t),a=(0,d.j1)(n,!1);return(0,d.Zx)(a,n),a.addEventListener("click",(()=>{var e=C.srcData.index.indexOf(t);(0,c.f2)(Y(e,t),!0)})),a}(e,t),n.index.child.append(n.index.link),function(e,t){var n=(0,d.gd)("DIV","nx-edit-move"),a={up:null,down:null};e.addEventListener("IndexChange",(function(){P(t,a)})),Object.keys(a).forEach((i=>{a[i]=(0,d.gd)("BUTTON","nx-edit-move-"+i),a[i].type="button",a[i].textContent=V[i],n.append(a[i]),a[i].addEventListener("click",(function(){!function(e,t,n){var a=function(a){var d=C.srcData.index.indexOf(n),i="up"==t;a||(i=!i),i&&0!=d?(A(d,d-1),B(e,e.previousSibling)):i||d+1==C.srcData.index.length||(A(d,d+1),B(e.nextSibling,e))};Q(a),a(!0)}(e,i,t)}))})),P(t,a),e.append(n)}(n.index.child,t),n.distant.child=W(t,function(e,t){var n=(0,d.gd)("FORM","nx-thread-distant-form"),a=C.srcData.threads[e].linked;if(a.length)for(var i=0;i<a.length;i++)F(n,e,i);var r=(0,d.gd)("DIV"),c=g();return c.addEventListener("click",(()=>{var e=C.srcData.index.indexOf(t),a=C.srcData.threads[e].linked.length;C.srcData.threads[e].linked.push({url:"",id:"/"}),F(n,e,a)})),r.append(n,c),r}(e,t)),n.local.child=W(t,function(e,t){var n=(0,d.gd)("FORM","nx-thread-local-form"),a=(0,d.gd)("FIELDSET");a.append(G(["threads",e,"name"],t)),a.append(G(["threads",e,"description"]));var i=(0,d.gd)("FIELDSET");i.append(x("record",1)),["timestamp","main","aside"].forEach((t=>{i.append(G(["threads",e,"record",t]))}));var r=(0,d.gd)("FIELDSET");r.append(x("media",2));var c=G(["threads",e,"record","media","type"]);return r.append(G(["threads",e,"record","media","url"],(function(e,t){if(t){var n=c.querySelector("[data-item="+function(e){for(var t=0;t<D.length;t++)if(e.includes(D[t]))return D[t];var n=e.split(".").pop();for(let[e,t]of Object.entries(m))if(t.includes(n))return e;return"page"}(e)+"]");n&&n.click()}}))),r.append(c),r.append(G(["threads",e,"record","media","caption"])),n.append(a,i,r),n}(e,(function(t,a){if(a){var d=(i=t,(0,r.V7)(i.trim().replace(/[\s_]/,"-")));n.index.link.firstChild.textContent=d,R(["threads",e,"id"],d)}var i}))),n.index.del=function(e,t,n){var a=(0,d.gd)("BUTTON","nx-delete-thread");return a.type="button",a.textContent="-",a.addEventListener("click",(function(){!function(e,t,n){var a=C.srcData.index.indexOf(n),d=S.childNodes[a],r=C.srcData.index.length,c={index:n,threads:C.srcData.threads[a]},l=function(n){if(n)Object.keys(c).forEach((e=>{C.srcData[e].splice(a,1)})),C.threadId="/",C.threadIndex=-1,[t,e,d].forEach((e=>{(0,i.Vv)(e,200,(function(){e.remove()}))})),r>1&&(0===a?d.nextSibling.dispatchEvent(N):a===r-1&&d.previousSibling.dispatchEvent(N));else{if(Object.keys(c).forEach((e=>{C.srcData[e].splice(a,0,c[e])})),a<r-1){var l=S.childNodes[a];S.insertBefore(d,l),0===a&&l.dispatchEvent(N)}else S.append(d),r>1&&d.previousSibling.dispatchEvent(N);(0,i.YQ)(d,200),w.append(e),U.append(t),d.firstChild.click()}};Q(l),l(!0)}(e,t,n)})),a}(n.local.child,n.distant.child,t),n.index.child.append(n.index.del),n}function Q(e){T.position!=T.count-1&&(L.splice(T.position),T.count=L.length+1),10===T.count?L.splice(0,1):T.count++,L.push(e),T.position=T.count-1,(0,d.eV)(T),I.disabled=!1}function R(e,t){return C.srcData||(C.srcData={}),"author"==e[0]?function(e,t){C.srcData.author||(C.srcData.author={}),C.srcData.author[e[1]]=t}(e,t):(function(e){C.srcData.threads?void 0===C.srcData.threads[e[1]]&&(C.srcData.threads[e[1]]={}):C.srcData.threads=[]}(e),["linked","record"].includes(e[2])?("record"==e[2]&&function(e,t){C.srcData.threads[e[1]].record||(C.srcData.threads[e[1]].record={}),"media"==e[3]?(C.srcData.threads[e[1]].record.media||(C.srcData.threads[e[1]].record.media={}),C.srcData.threads[e[1]].record.media[e[4]]=t):C.srcData.threads[e[1]].record[e[3]]=t}(e,t),void function(e,t){C.srcData.threads[e[1]].linked?void 0===C.srcData.threads[e[1]].linked[e[3]]&&(C.srcData.threads[e[1]].linked[e[3]]={}):C.srcData.threads[e[1]].linked=[],C.srcData.threads[e[1]].linked[e[3]][e[4]]=t}(e,t)):function(e,t){C.srcData.threads[e[1]][e[2]]=t}(e,t))}function G(e,t=null,n=null){var i,r=function(e){return C.srcData?"author"==e[0]?C.srcData[e[0]][e[1]]:["linked","record"].includes(e[2])?"record"==e[2]?"media"!=e[3]?C.srcData.threads[e[1]].record[e[3]]:C.srcData.threads[e[1]].record.media[e[4]]:C.srcData.threads[e[1]].linked[e[3]][e[4]]:C.srcData.threads[e[1]][e[2]]:""}(e),c=e[e.length-1],o=e[e.length-2];Number.isInteger(o)&&(o=e[e.length-3]),i=["about","description","main","aside","caption"].includes(c)?function(e){var t=(0,d.gd)("TEXTAREA","nx-edit-textarea");return t.textContent=e,t}(r):"timestamp"==c?function(e){var t=(0,d.gd)("INPUT");return t.type="datetime-local",t.value=e,t}(r):function(e){var t=(0,d.gd)("INPUT","nx-edit-text");return t.type="text",t.value=e,t}(r);var s=e.join("-");i.id=s,i.name=s,["handle","name","main","id","url","type","timestamp"].includes(c)&&(i.required=!0);var u=function(e){var t=(0,d.gd)("LABEL","nx-edit-label");t.for=e;var n=(0,d.gd)("SPAN","nx-edit-title");return n.textContent=(0,l.GY)(e),(0,f.w)(n,e),t.append(n),t}(c),p=(0,d.gd)("SPAN","nx-edit-indication"),h=(0,d.gd)("SPAN","nx-edit-feedback");switch(u.append(p,h),c){case"url":p.textContent="[http]",i.pattern=a.Ni;break;case"id":e.includes("linked")?i.pattern=a.bt:i.pattern=a.Q1;break;case"type":i.pattern="("+a.WS.join("|")+")";break;case"timestamp":break;default:var v=a.m2[c];p.textContent="["+v[0]+"-"+v[1]+"]",i.setAttribute("maxlength",v[1]),i.setAttribute("minlength",v[0])}n&&(n[c]=i);var x=(0,d.gd)("DIV","nx-edit-input nx-edit-"+o+"-"+c);if(x.append(u),"type"==c||"id"==c&&"linked"==e[2]){var g=[];"type"==c?g=a.WS:(g=["/"],"/"!=r&&g.push(r)),x.append((0,d.Sb)(g,i,null,"nx-edit-"+e[2]+"-"+c))}else x.append(i);return function(e,t,n,a){var d="",i=t.value;t.addEventListener("focus",(function(){i=t.value})),t.addEventListener("change",(function(){H(e,t,n,a),Q((function(r){r?t.value=d:(d=t.value,t.value=i),H(e,t,n,a)}))}))}(e,i,h,t),H(e,i,h,t),x}function H(e,t,n,a){var d=!1;t.checkValidity()?(d=!0,R(e,t.value),n.textContent="✓"):n.textContent="✗","function"==typeof a&&a(t.value,d)}function q(e){if(!O){var t=T.position,n=!1;"next"==e&&(t-=1,n=!0),L[t](n),setTimeout(function(){O=!1}.bind(this),k),I.disabled=!1}}function J(e){var t=Object.assign({},C.srcData),n=function(n){var a;a=n?e:t,C.srcData.threads.length&&[S,w,U].forEach((e=>{Array.from(e.childNodes).forEach((e=>{(0,i.Vv)(e,100,(function(){e.remove()}))}))})),C=b(a),function(){for(let[e,t]of Object.entries(j))t.value=C.srcData.author[e]}(),Z()};Q(n),n(!0)}function X(e){(0,i.Po)(y,(0,l.GY)(e),20),setTimeout((function(){(0,i.Po)(y,"",20)}),3e3)}function Z(){var e,t=C.srcData.index;if(t.length)for(var n=0;n<t.length;n++)void 0,e=M(n,t[n]),Object.values(e).forEach((e=>{e.parent.append(e.child)}))}function $(){var e,t=(0,d.gd)("DIV","nx-edit-menu");return t.append(function(){var e=(0,d.gd)("DIV","nx-edit-nav");y=(0,d.gd)("SPAN","nx-action-feedback"),(I=(0,d.gd)("BUTTON","nx-save")).type="button",I.textContent="🖫",I.disabled=!0,I.addEventListener("click",(function(){I.disabled||((0,o.EW)(C.srcData),I.disabled=!0,X("saved"))}));var t,n,a=(0,d.gd)("DIV");return a.append(((n=(0,d.gd)("BUTTON","nx-new")).type="button",n.textContent="🗋",n.addEventListener("click",(function(){J(p())})),n),function(){var e=(0,d.gd)("INPUT");e.type="file",e.accept="application/json",e.addEventListener("change",(function(e){(0,v.e)(e).then((e=>{J(e)})).catch((()=>{X("Invalid source")}))})),e.style.display="none";var t=(0,d.gd)("BUTTON","nx-open-file");t.type="button",t.textContent="🗁",t.addEventListener("click",(function(){e.click()}));var n=(0,d.gd)("SPAN");return n.append(e,t),n}(),I,((t=(0,d.gd)("BUTTON","nx-download")).type="button",t.textContent="⇣",t.addEventListener("click",(function(e){var t=Object.assign({},C.srcData);delete t.index,(0,s.wJ)(t)||X("Invalid Nexus data"),t=JSON.stringify(t,void 0,2);var n="data:text/json;charset=utf-8,"+encodeURIComponent(t),a=(0,d.gd)("A");a.setAttribute("href",n),a.setAttribute("download","Nexus.json"),(0,u.X)().appendChild(a),a.click(),a.remove()})),t)),e.append(y,a),e}(),(e=(0,d.gd)("DIV","nx-edit-actions nx-history-nav"),(0,d.Q$)(T,q),e.append(T.ctrls.prev.elm,T.ctrls.next.elm),e)),t}var _,z,K=n(694);function ee(e){!function(e){if(e&&e.srcData)e.dataUrl="nx-edit",(0,o.EW)(e.srcData);else{var t=(0,o.Ih)();t||(t=p()),e=b(t)}S=(0,d.gd)("UL","nx-edit-index"),w=(0,d.gd)("UL","nx-edit-local"),U=(0,d.gd)("UL","nx-edit-distant"),C=e,Z()}(e),_=(0,K.D)(e);var t,n=(0,d.gd)("DIV"),a=(0,d.gd)("DIV");a.append((E=(0,d.gd)("FORM","nx-edit-author"),["handle","url","about"].forEach((e=>{E.append(G(["author",e],null,j))})),(0,d.rH)("index",null,[E,S,(t=g(),t.addEventListener("click",(function(){var e=(0,r.O1)(10),t=C.srcData.index.length;C.srcData.threads.push(h(e)),C.srcData.index.push(e);var n=M(t,e);["local","distant"].forEach((e=>{n[e].parent.append(n[e].child)}));var a=null;S.childNodes.length&&(a=function(){S.childNodes[t-1].dispatchEvent(N)}),(0,i.am)(n.index.parent,n.index.child,!1,!0,200,a),I.disabled=!1})),t)],!0)));var l=(0,d.gd)("DIV");return l.append((0,d.rH)("local",null,[w],!0),(0,d.rH)("distant",null,[U],!0)),z=(0,d.IW)([(0,d.wI)(),$()],[a,l],[],"edit"),n.append(z,function(e,t){var n=(0,d.gd)("BUTTON","nx-edit-switch");return n.textContent="👁",n.addEventListener("click",(function(){"✎"==n.textContent?(n.textContent="👁",(0,i.Mo)(e,t)):((0,c.f2)(C,!0,!0),n.textContent="✎",(0,i.Mo)(t,e))})),n}(_,z)),n}}}]);