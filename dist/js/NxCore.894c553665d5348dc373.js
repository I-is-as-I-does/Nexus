/*! Nexus | (c) 2021 I-is-as-I-does | AGPLv3 license */
"use strict";(self.webpackChunknexus=self.webpackChunknexus||[]).push([[424],{253:(e,n,t)=>{t.d(n,{x:()=>d,X:()=>u});var r,a,i=t(881),l=t(25),o=t(618);function d(e=null){if(r)(0,i.Pr)("Nexus | container already set");else{e||(e=l.cZ);var n={};(r=document.querySelector(e))?r.dataset&&(n=Object.assign(n,r.dataset)):(r=document.createElement("DIV"),document.body.append(r)),(0,o.O)(n),(a=document.createElement("DIV")).className="nx",r.append(a)}}function u(){return a||d(),a}},25:(e,n,t)=>{t.d(n,{cZ:()=>r,Je:()=>a,U:()=>i,zE:()=>l});const r="#Nexus",a="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus-Prototype@latest/dist/js/NxIO.js",i="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus-Prototype@latest/dist/css/NexusI.min.css",l={src:null,id:"/",style:i,lang:"en",history:!1,debug:!1,edit:!1}},618:(e,n,t)=>{t.d(n,{O:()=>f,B:()=>h});var r=t(368),a=t(753),i=t(881),l=t(75),o=t(451),d=t(25).zE,u=window.location.href,s=u.substr(0,u.lastIndexOf("/")+1),c=new URLSearchParams(window.location.search.slice(1));function f(e){(0,r.bT)(e)&&(["src","style"].forEach((n=>{!function(e,n){if(e.hasOwnProperty(n)){var t="json";"style"===n&&(t="css"),e[n].substr(-t.length)!==t&&(e[n]=e[n]+"."+t),"http"!==e[n].substr(0,4)&&(e[n]=s+e[n])}}(e,n)})),(0,a.HH)(e.src)&&(d.src=e.src,(0,o.Q0)(e.id)&&(d.id=e.id)),(0,a.HH)(e.style)&&(d.style=e.style),(0,r.fw)(e.lang)&&(d.lang=e.lang,(0,l.uM)(e.lang)),["history","debug","edit"].forEach((n=>{c.has(n)?d[n]=!0:"true"!==e[n]&&!0!==e[n]||(d[n]=!0)})),d.debug&&(0,i.yD)(!0))}function h(e){return d[e]}},549:(e,n,t)=>{t.d(n,{e:()=>d,P:()=>u});var r=t(753),a=t(881),i=t(85),l=t(451);function o(e){e.index=[],e.threads.map((n=>{e.index.push(n.id)}))}function d(e){return e.target.files.length&&"application/json"==e.target.files[0].type?new Promise(((n,t)=>{var r=new FileReader;return r.onload=function(e){var r=function(e){var n=JSON.parse(e.target.result);return!(!n||!(n=(0,l.wJ)(n)))&&(o(n),n)}(e);r?n(r):t()},r.readAsText(e.target.files[0])})):Promise.reject()}function u(e){var n,t=(0,i.Yb)(e);return null!==t?Number.isInteger(t)?Promise.reject(t):Promise.resolve(t):(n=e,(0,r._l)(n).then((e=>((0,a.ab)(),(e=(0,l.wJ)(e))?(o(e),(0,i.pH)(n,e),e):((0,i.pH)(n,400),(0,a.Pr)((0,a.ah)()),(0,a.fZ)("Invalid source"),Promise.reject(400))))).catch((e=>{throw(0,a.Pr)(e),(0,i.pH)(n,404),(0,a.fZ)("No response"),404})))}document.cookie="Nx=Instance; SameSite=None; Secure"},869:(e,n,t)=>{t.r(n),t.d(n,{initPage:()=>c});var r=t(253),a=t(158),i=t(618),l=t(881),o=t(180),d=t(425),u=t(625),s=t(694);function c(e=null,n=null){return(0,r.x)(e),(0,i.O)(n),(0,a.A)().then((()=>(0,i.B)("src")?(0,o.t$)((0,i.B)("src"),(0,i.B)("id")):{})).then((e=>{var n;e&&(0,o.rz)(e),n=(0,i.B)("edit")?(0,u.N)(e):(0,s.D)(e),(0,r.X)().append((0,d.IW)(n))})).catch((e=>{(0,l.Pr)(e),(0,r.X)().append((0,d.ao)())}))}},158:(e,n,t)=>{t.d(n,{A:()=>d,o:()=>u});var r=t(753),a=t(881),i=t(618),l=t(25),o={};function d(e=null,n=".nx"){return e||(e=(0,i.B)("style")),(0,r.Yc)(n,e).then((()=>(o[e]=!0,!0))).catch((n=>{if((0,a.Pr)(n),(0,a.fZ)("Theme not found"),o[e]=!1,e!=l.U)return d(l.U);throw 404}))}function u(e=null){return e||(e=(0,i.B)("style")),o[e]}},881:(e,n,t)=>{t.d(n,{Pr:()=>l,yD:()=>o,ab:()=>d,fZ:()=>u,ah:()=>s});var r=t(368),a=[],i=!1;function l(e){i&&console.log(e)}function o(e=!0){i=e}function d(){a=[]}function u(e,n=null){var t={msg:e};(0,r.fw)(n)&&(t.detail=t),a.push(e)}function s(){return a}},180:(e,n,t)=>{t.d(n,{hb:()=>m,Mq:()=>h,Ek:()=>c,t$:()=>s,rz:()=>p,f2:()=>f});var r=t(618),a=t(549),i=t(85),l=!1,o={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},d={onChange:[],onSrcChange:[]},u=!1;function s(e,n){return(0,a.P)(e).then((t=>{var r={dataUrl:e,threadId:n,srcData:t,threadIndex:t.index.indexOf(n)};return-1===r.threadIndex&&"/"!==n&&(r.threadId="/"),r}))}function c(e,n=!1){var t="onChange";n&&(t="onSrcChange"),d[t].push(e)}function f(e,n=!1,t=!1){if(!u){var a=e.dataUrl!=o.dataUrl;(t||a||e.threadId!=o.threadId)&&(u=!0,n||((0,i.Dy)(o),(0,r.B)("history")&&function(e){var n={id:e.threadId,src:e.dataUrl,ix:e.threadIndex};history.replaceState(n,""),history.pushState(n,"")}(o)),o=e,l=["onChange"],(a||t)&&l.push("onSrcChange"),l.forEach((e=>{d[e].length&&d[e].forEach((e=>{e(o)}))})),setTimeout((function(){u=!1}),800))}var l}function h(){return o}function p(e){return!o.dataUrl&&(o=e,!0)}function m(){return 800}(0,r.B)("history")&&(l||(l=!0,window.onpopstate=e=>{if(e.state&&e.state.src&&e.state.id&&e.state.ix){var n=e.state;n.srcData=(0,i.Yb)(e.state.src),f(n,!1)}}))},85:(e,n,t)=>{t.d(n,{KR:()=>w,Yb:()=>x,Ih:()=>g,XU:()=>P,VG:()=>O,$3:()=>y,pH:()=>b,EW:()=>v,q1:()=>S,Dy:()=>I,eG:()=>U});var r=t(753),a=t(811);const i=(0,a.$o)(),l=(0,a.G)();function o(e){e&&!e.getItem("available")&&e.setItem("available",5e3)}function d(e){return"session"==e?l:i}function u(e,n,t="session",r=null,i=!0){r&&(r[e]=n);var l=d(t);if(null!=l){var o=(0,a.$w)(n,!0);if(o>2e3)return;var u=l.getItem("available");u<1e3&&(u=5e3-(0,a.hh)(l,2e3)),u-=o,i&&(n=JSON.stringify(n)),l.setItem(e,n),l.setItem("available",Math.ceil(u))}}function s(e,n="session",t=null,r=!0){if(null!==t&&t.hasOwnProperty(e))return t[e];var a=d(n);if(a){var i=a.getItem(e);if(i)return r&&(i=JSON.parse(i)),t&&(t[e]=i),i}return null}o(i),o(l);var c={},f={},h={},p={};function m(e){if(-1!=e.threadIndex&&e.srcData.threads[e.threadIndex]){var n=e.srcData.threads[e.threadIndex].record.timestamp;return new Date(n)}return null}function v(e){u("nx-edit",e,"local")}function g(){return s("nx-edit","local")}function I(e){var n=e.dataUrl+"#"+e.threadId;if(!c.hasOwnProperty(n)){var t=m(e);t&&u(n,t,"local",c,!1)}}function y(e){var n=function(e){var n=s(e.dataUrl+"#"+e.threadId,"local",c,!1);return n?new Date(n):null}(e);if(!n)return!0;var t=m(e);return!t||n==t}function b(e,n){u(e,n,"session",f)}function x(e){return s(e,"session",f)}function w(e){var n=s(e,"local",h,!1);return n||u(e,n=(0,r.AB)(e),"local",h,!1),n}function S(e,n){u(e,n,"local",p,!0)}function O(e){return s(e,"local",p,!0)}function U(e){u("nx-lang",e,"local",null,!1)}function P(){return s("nx-lang","local",null,!1)}},75:(e,n,t)=>{t.d(n,{Ye:()=>f,VQ:()=>h,GY:()=>p,uM:()=>u,FC:()=>c});var r=t(368),a=t(85),i={fr:{data:"données",author:"auteur·rice",handle:"pseudonyme",about:"à propos",url:"url",id:"id",name:"nom",description:"description",timestamp:"date",main:"principal",aside:"secondaire",media:"média",type:"type",caption:"légende",index:"index",distant:"distant",local:"local",threads:"fils",thread:"fil",linked:"liés",record:"contenu",history:"historique",copied:"copié",embed:"intégré",source:"source",del:"suppr",edit:"édition",preview:"aperçu","No valid thread":"Aucun fil valide","Duplicate thread id":"Identifiant du fil en double","Duplicate linked thread":"Fil lié en double","Invalid linked thread":"Fil lié non valide","Invalid url":"Url non valide","Invalid thread id":"Identifiant de fil non valide","Invalid length":"Longueur non valide","Invalid min length":"Longueur minimale non valide","Invalid max length":"Longueur maximale non valide","Unable to cut string":"Impossible de raccourcir le texte","Invalid timestamp":"Horodatage non valide","Unknown field":"Champ inconnu","Invalid field type":"Type de champ non valide","Field is empty":"Le champ est vide","Unable to extend string":"Impossible de prolonger le texte","Unknown characters limits category":"Catégorie de limite de caractères inconnue","Unknown items limits category":"Catégorie de limite d'éléments inconnue","Invalid media type":"Type de media non valide","Invalid app url":"Url de l'application non valide","Init failed":"L'initialisation a échoué","Theme not found":"Thème non trouvé","No response":"Aucune réponse","Invalid source":"Source non valide","Invalid Nexus data":"Données Nexus non valides",saved:"sauvegardé",status:"statut"}},l=["en","fr"],o=(0,a.XU)();null==o||s(o)||(o=null,(0,a.eG)(null));var d=null;function u(e){o||c(e)}function s(e){return(0,r.fw)(e)&&l.includes(e)}function c(e){return!(!s(e)||e==d||(d=e,function(e){o!=e&&((0,a.eG)(e),o=e)}(e),0))}function f(){return l}function h(){return d}function p(e){var n=e;return"en"!=d&&i[d][e]&&(n=i[d][e]),n}o?d=o:s(d=document.querySelector("html").lang)||(d="en")},142:(e,n,t)=>{t.d(n,{T:()=>o,w:()=>d});var r=t(75),a=t(931),i={};function l(e,n){(0,a.Po)(e,(0,r.GY)(n),50)}function o(e){if((0,r.FC)(e))for(let[e,n]of Object.entries(i))n.forEach((n=>{l(n,e)}))}function d(e,n){i[n]||(i[n]=[]),i[n].push(e)}},696:(e,n,t)=>{t.d(n,{Gd:()=>r,Ln:()=>a,m2:()=>i,SO:()=>l,WS:()=>o,og:()=>d,Q1:()=>u,bt:()=>s,Ni:()=>c});const r="https://github.com/I-is-as-I-does/Nexus-Prototype",a={data:"Object",nexus:"String",author:"Object",handle:"String",about:"String",url:"String",threads:"Array","threads.item":"Object",id:"String",name:"String",description:"String",record:"Object",timestamp:"String",main:"String",aside:"String",media:"Object",type:"String",caption:"String",linked:"Array","linked.item":"Object"},i={handle:[3,30],about:[0,400],name:[3,30],description:[0,400],main:[1,1e3],aside:[0,400],caption:[0,200]},l={threads:[1,100],linked:[0,100]},o=["page","video","image","audio","youtube","vimeo","soundcloud"],d="^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]))?$",u="[a-zA-Z0-9-]{3,36}",s="(/|"+u+")",c="^https?://\\w+\\.\\w+.*"},451:(e,n,t)=>{t.d(n,{Q0:()=>h,wJ:()=>m});var r=t(368),a=t(753),i=t(947),l=t(696),o=t(881);function d(e){return l.m2.hasOwnProperty(e)?l.m2[e]:((0,o.fZ)("Unknown characters limits category",e),!1)}function u(e){return l.SO.hasOwnProperty(e)?l.SO[e]:((0,o.fZ)("Unknown items limits category",e),!1)}function s(e,n){return c(e,n,!0)||(e=""),function(e,n){var t=d(n);if(!1!==t){if(e.length>=t[0])return!0;(0,o.fZ)("Invalid min length",n)}return!1}(e,n)?function(e,n){var t=d(n);if(!1!==t){if(e.length<=t[1])return!0;(0,o.fZ)("Invalid max length",n)}return!1}(e,n)||(e=function(e,n){var t=d(n);return!1!==t?(0,i.Oq)(e,t[1]):((0,o.fZ)("Unable to cut string",n),"")}(e,n)):e=function(e,n){var t=d(n);if(!1!==t){var r=t[0]-e.length;return r>0&&(e="-".repeat(r)+e),e}return(0,o.fZ)("Unable to extend string",n),null}(e,n),e}function c(e,n,t=!0){if(l.Ln.hasOwnProperty(n)){var a=l.Ln[n];if(null!=e&&e.constructor.name==a){if(!t||!(0,r.xb)(e))return!0;(0,o.fZ)("Field is empty",n)}else(0,o.fZ)("Invalid field type",n)}else(0,o.fZ)("Unknown field",n);return!1}function f(e){return c(e,"record",!0)&&function(e,n=!1){return!(!c(e,"timestamp",!0)||!(e.match(l.og)||!n&&(0,r.iX)(e)))||((0,o.fZ)("Invalid timestamp",e),!1)}(e.timestamp)&&c(e.main,"main",!0)&&(e.main=s(e.main,"main"),e.main)?(e.aside=s(e.aside,"aside"),e.media=c(n=e.media,"media",!0)&&p(n.url)&&(c(t=n.type,"type",!0)&&l.WS.includes(t)||((0,o.fZ)("Invalid media type",type),0))?(n.caption=s(n.caption,"caption"),n):{url:"",type:"",caption:""},e):null;var n,t}function h(e,n=!1){var t;return t=n?l.bt:l.Q1,!(!c(e,"id",!0)||!e.match(t))||((0,o.fZ)("Invalid thread id",e),!1)}function p(e){return!!(0,a.HH)(e)||((0,o.fZ)("Invalid url",e),!1)}function m(e){return c(e,"data",!0)&&(e.nexus=(function(e){return!(!p(e)||e!=l.Gd)||((0,o.fZ)("Invalid app url"),!1)}(n=e.url)||(n=l.Gd),n),e.author=c(t=e.author,"author",!0)&&p(t.url)&&(t.handle=s(t.handle,"handle"),t.handle)?(t.about=s(t.about,"about"),t):null,e.author&&(e.threads=function(e){if(c(e,"threads",!0)){var n=[];e=e.slice(0,u("threads")[1]);for(var t=0;t<e.length;t++){if(e[t]=c(r=e[t],"threads.item",!0)&&h(r.id)&&(r.record=f(r.record),null!=r.record)?(r.name=s(r.name,"name"),r.description=s(r.description,"description"),r.linked=function(e){e.slice(0,u("linked")[1]);for(var n,t=[],r=0;r<e.length;r++){if(c(n=e[r],"linked.item",!0)&&p(n.url)&&h(n.id,!0)||((0,o.fZ)("Invalid linked thread"),0)){var a=e[r].url+" "+e[r].id;if(!t.includes(a)){t.push(a);continue}(0,o.fZ)("Duplicate linked thread",a)}e.splice(r,1)}return e.length&&e.sort(((e,n)=>e.url<n.url?1:-1)),e}(r.linked),r):null,null!=e[t]){if(!n.includes(e[t].id)){n.push(e[t].id);continue}(0,o.fZ)("Duplicate thread id",e[t].id)}e.splice(t,1)}if(e.length)return e}var r;return(0,o.fZ)("No valid thread"),[]}(e.threads),e.threads.length))?e:null;var n,t}}}]);