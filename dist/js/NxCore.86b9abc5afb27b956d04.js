/*! Nexus | (c) 2021 I-is-as-I-does | AGPLv3 license */
"use strict";(self.webpackChunknexus=self.webpackChunknexus||[]).push([[424],{25:(n,e,t)=>{t.d(e,{cZ:()=>r,Je:()=>i,U:()=>a,zE:()=>l});const r="#Nexus",i="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus-Prototype@latest/dist/js/NxIO.js",a="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus-Prototype@latest/dist/css/NexusI.min.css",l={src:null,id:"/",style:a,lang:"en"}},618:(n,e,t)=>{t.d(e,{Ov:()=>c,pm:()=>f,Bq:()=>h});var r=t(368),i=t(753),a=t(75),l=t(451),o=t(25).zE,u=window.location.href,d=u.substr(0,u.lastIndexOf("/")+1),s=new URLSearchParams(window.location.search.slice(1));function c(n){(0,r.bT)(n)&&(["src","style"].forEach((e=>{!function(n,e){n.hasOwnProperty(e)&&n[e].length&&"http"!==n[e].substr(0,4)&&(n[e]=d+n[e])}(n,e)})),(0,i.HH)(n.src)&&(o.src=n.src,(0,l.Q0)(n.id)&&(o.id=n.id)),(0,i.HH)(n.style)&&(o.style=n.style),(0,r.fw)(n.lang)&&(o.lang=n.lang,(0,a.uM)(n.lang)))}function f(n){return s.has(n)}function h(n){return o[n]}},549:(n,e,t)=>{t.d(e,{e:()=>u,P:()=>d});var r=t(753),i=t(881),a=t(85),l=t(451);function o(n){n.index=[],n.threads.map((e=>{n.index.push(e.id)}))}function u(n){return n.target.files.length&&"application/json"==n.target.files[0].type?new Promise(((e,t)=>{var r=new FileReader;return r.onload=function(n){var r=function(n){var e=JSON.parse(n.target.result);return!(!e||!(e=(0,l.wJ)(e)))&&(o(e),e)}(n);r?e(r):t()},r.readAsText(n.target.files[0])})):Promise.reject()}function d(n){var e,t=(0,a.Yb)(n);return null!==t?Number.isInteger(t)?Promise.reject(t):Promise.resolve(t):(e=n,(0,r._l)(e).then((n=>((0,i.ab)(),(n=(0,l.wJ)(n))?(o(n),(0,a.pH)(e,n),n):((0,a.pH)(e,400),(0,i.Pr)((0,i.ah)()),(0,i.fZ)("Invalid source"),Promise.reject(400))))).catch((n=>{throw(0,i.Pr)(n),(0,a.pH)(e,404),(0,i.fZ)("No response"),404})))}document.cookie="Nx=Instance; SameSite=None; Secure"},675:(n,e,t)=>{t.r(e),t.d(e,{initPage:()=>v});var r,i,a=t(881),l=t(25),o=t(618);function u(n=null){if(r)(0,a.Pr)("Nexus | container already set");else{n||(n=l.cZ);var e={};(r=document.querySelector(n))?r.dataset&&(e=Object.assign(e,r.dataset)):(r=document.createElement("DIV"),document.body.append(r)),(0,o.Ov)(e),(i=document.createElement("DIV")).className="nx",r.append(i)}}function d(){return i||u(),i}var s=t(158),c=t(371),f=t(425),h=t(453),p=t(220);function v(n=null,e=null){return u(n),(0,o.Ov)(e),(0,o.pm)("log")&&(0,a.kb)(!0),(0,s.A)().then((()=>(0,o.Bq)("src")?(0,c.t$)((0,o.Bq)("src"),(0,o.Bq)("id")):{})).then((n=>{var e;n.srcData&&(0,c.rz)(n),e=(0,o.pm)("edit")?(0,h.N)(n):(0,p.D)(n),d().append((0,f.IW)(e))})).catch((n=>{(0,a.Pr)(n),d().append((0,f.ao)())}))}},158:(n,e,t)=>{t.d(e,{A:()=>u,o:()=>d});var r=t(753),i=t(881),a=t(618),l=t(25),o={};function u(n=null,e=".nx"){return n||(n=(0,a.Bq)("style")),(0,r.Yc)(e,n).then((()=>(o[n]=!0,!0))).catch((e=>{if((0,i.Pr)(e),(0,i.fZ)("Theme not found"),o[n]=!1,n!=l.U)return u(l.U);throw 404}))}function d(n=null){return n||(n=(0,a.Bq)("style")),o[n]}},881:(n,e,t)=>{t.d(e,{Pr:()=>l,kb:()=>o,ab:()=>u,fZ:()=>d,ah:()=>s});var r=t(368),i=[],a=!1;function l(n){a&&console.log(n)}function o(n=!0){a=n}function u(){i=[]}function d(n,e=null){var t={msg:n};(0,r.fw)(e)&&(t.detail=t),i.push(n)}function s(){return i}},371:(n,e,t)=>{t.d(e,{t$:()=>u,Ek:()=>d,f2:()=>s,Mq:()=>c,rz:()=>f,hb:()=>h});var r=t(549),i=t(85),a={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},l={onChange:[],onSrcChange:[]},o=!1;function u(n,e){return(0,r.P)(n).then((t=>{var r={dataUrl:n,threadId:e,srcData:t,threadIndex:t.index.indexOf(e)};return-1===r.threadIndex&&"/"!==e&&(r.threadId="/"),r}))}function d(n,e=!1){var t="onChange";e&&(t="onSrcChange"),l[t].push(n)}function s(n,e=!1,t=!1){if(!o){var r=n.dataUrl!=a.dataUrl;(t||r||n.threadId!=a.threadId)&&(o=!0,e||(0,i.Dy)(a),a=n,u=["onChange"],(r||t)&&u.push("onSrcChange"),u.forEach((n=>{l[n].length&&l[n].forEach((n=>{n(a)}))})),setTimeout((function(){o=!1}),800))}var u}function c(){return a}function f(n){return!a.dataUrl&&(a=n,!0)}function h(){return 800}},85:(n,e,t)=>{t.d(e,{KR:()=>S,Yb:()=>w,Ih:()=>I,XU:()=>U,VG:()=>O,of:()=>b,pH:()=>x,EW:()=>g,q1:()=>k,Dy:()=>y,eG:()=>P});var r=t(753),i=t(811);const a=(0,i.$o)(),l=(0,i.G)();function o(n){n&&!n.getItem("available")&&n.setItem("available",5e3)}function u(n){return"session"==n?l:a}function d(n,e,t="session",r=null,a=!0){r&&(r[n]=e);var l=u(t);if(null!=l){var o=(0,i.$w)(e,!0);if(o>2e3)return;var d=l.getItem("available");d<1e3&&(d=5e3-(0,i.hh)(l,2e3)),d-=o,a&&(e=JSON.stringify(e)),l.setItem(n,e),l.setItem("available",Math.ceil(d))}}function s(n,e="session",t=null,r=!0){if(null!==t&&t.hasOwnProperty(n))return t[n];var i=u(e);if(i){var a=i.getItem(n);if(a)return r&&(a=JSON.parse(a)),t&&(t[n]=a),a}return null}o(a),o(l);var c={},f={},h={},p={};const v="nx-edit#";function m(n){if(-1!=n.threadIndex&&n.srcData.threads[n.threadIndex]){var e=n.srcData.threads[n.threadIndex].content.timestamp;return new Date(e)}return null}function g(n,e){d(v+n,e,"local")}function I(n){return s(v+n,"local")}function y(n){var e=n.dataUrl+"#"+n.threadId;if(!c.hasOwnProperty(e)){var t=m(n);t&&d(e,t,"local",c,!1)}}function b(n){var e=function(n){var e=s(n.dataUrl+"#"+n.threadId,"local",c,!1);return e?new Date(e):null}(n);if(!e)return!0;var t=m(n);return!t||e==t}function x(n,e){d(n,e,"session",f)}function w(n){return s(n,"session",f)}function S(n){var e=s(n,"local",h,!1);return e||d(n,e=(0,r.AB)(n),"local",h,!1),e}function k(n,e){d(n,e,"local",p,!0)}function O(n){return s(n,"local",p,!0)}function P(n){d("nx-lang",n,"local",null,!1)}function U(){return s("nx-lang","local",null,!1)}},75:(n,e,t)=>{t.d(e,{Ye:()=>f,VQ:()=>h,GY:()=>p,uM:()=>d,FC:()=>c});var r=t(368),i=t(85),a={fr:{device:"appareil",browser:"navigateur",server:"serveur",data:"données",author:"auteur·e",handle:"pseudonyme",about:"à propos",url:"url",id:"id",title:"titre",description:"description",timestamp:"date",main:"corps",aside:"aparté",media:"média",type:"type",caption:"légende",index:"index",distant:"distant",local:"local",threads:"fils",linked:"liés",content:"contenu",history:"historique",copied:"copié",embed:"intégré",source:"source",edit:"édition",preview:"aperçu","local thread":"fil local","linked threads":"fils liés","No valid thread":"Aucun fil valide","Duplicate thread id":"Identifiant du fil en double","Duplicate linked thread":"Fil lié en double","Invalid linked thread":"Fil lié non valide","Invalid url":"Url non valide","Invalid thread id":"Identifiant de fil non valide","Invalid length":"Longueur non valide","Invalid min length":"Longueur minimale non valide","Invalid max length":"Longueur maximale non valide","Unable to cut string":"Impossible de raccourcir le texte","Invalid timestamp":"Horodatage non valide","Unknown field":"Champ inconnu","Invalid field type":"Type de champ non valide","Field is empty":"Le champ est vide","Unable to extend string":"Impossible de prolonger le texte","Unknown characters limits category":"Catégorie de limite de caractères inconnue","Unknown items limits category":"Catégorie de limite d'éléments inconnue","Invalid media type":"Type de media non valide","Invalid app url":"Url de l'application non valide","Init failed":"L'initialisation a échoué","Theme not found":"Thème non trouvé","No response":"Aucune réponse","Invalid source":"Source non valide","Invalid Nexus data":"Données Nexus non valides",saved:"sauvegardé",status:"statut"}},l=["en","fr"],o=(0,i.XU)();null==o||s(o)||(o=null,(0,i.eG)(null));var u=null;function d(n){o||c(n)}function s(n){return(0,r.fw)(n)&&l.includes(n)}function c(n){return!(!s(n)||n==u||(u=n,function(n){o!=n&&((0,i.eG)(n),o=n)}(n),0))}function f(){return l}function h(){return u}function p(n){var e=n;return"en"!=u&&a[u][n]&&(e=a[u][n]),e}o?u=o:s(u=document.querySelector("html").lang)||(u="en")},142:(n,e,t)=>{t.d(e,{T:()=>o,w:()=>u});var r=t(75),i=t(931),a={};function l(n,e){(0,i.Po)(n,(0,r.GY)(e),50)}function o(n){if((0,r.FC)(n))for(let[n,e]of Object.entries(a))e.forEach((e=>{l(e,n)}))}function u(n,e){a[e]||(a[e]=[]),a[e].push(n)}},696:(n,e,t)=>{t.d(e,{Gd:()=>r,Ln:()=>i,m2:()=>a,SO:()=>l,WS:()=>o,og:()=>u,Q1:()=>d,bt:()=>s,Ni:()=>c});const r="https://github.com/I-is-as-I-does/Nexus-Prototype",i={data:"Object",nexus:"String",author:"Object",handle:"String",about:"String",url:"String",threads:"Array","threads.item":"Object",id:"String",title:"String",description:"String",content:"Object",timestamp:"String",main:"String",aside:"String",media:"Object",type:"String",caption:"String",linked:"Array","linked.item":"Object"},a={handle:[3,30],about:[0,400],title:[3,30],description:[0,400],main:[1,1e3],aside:[0,400],caption:[0,200]},l={threads:[1,100],linked:[0,100]},o=["page","video","image","audio","youtube","vimeo","soundcloud"],u="^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])(T(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]))?$",d="[a-zA-Z0-9-]{3,36}",s="(/|"+d+")",c="^https?://.*"},451:(n,e,t)=>{t.d(e,{Q0:()=>h,wJ:()=>v});var r=t(368),i=t(753),a=t(947),l=t(696),o=t(881);function u(n){return l.m2.hasOwnProperty(n)?l.m2[n]:((0,o.fZ)("Unknown characters limits category",n),!1)}function d(n){return l.SO.hasOwnProperty(n)?l.SO[n]:((0,o.fZ)("Unknown items limits category",n),!1)}function s(n,e){return c(n,e,!0)||(n=""),function(n,e){var t=u(e);if(!1!==t){if(n.length>=t[0])return!0;(0,o.fZ)("Invalid min length",e)}return!1}(n,e)?function(n,e){var t=u(e);if(!1!==t){if(n.length<=t[1])return!0;(0,o.fZ)("Invalid max length",e)}return!1}(n,e)||(n=function(n,e){var t=u(e);return!1!==t?(0,a.Oq)(n,t[1]):((0,o.fZ)("Unable to cut string",e),"")}(n,e)):n=function(n,e){var t=u(e);if(!1!==t){var r=t[0]-n.length;return r>0&&(n="-".repeat(r)+n),n}return(0,o.fZ)("Unable to extend string",e),null}(n,e),n}function c(n,e,t=!0){if(l.Ln.hasOwnProperty(e)){var i=l.Ln[e];if(null!=n&&n.constructor.name==i){if(!t||!(0,r.xb)(n))return!0;(0,o.fZ)("Field is empty",e)}else(0,o.fZ)("Invalid field type",e)}else(0,o.fZ)("Unknown field",e);return!1}function f(n){return c(n,"content",!0)&&function(n,e=!1){return!(!c(n,"timestamp",!0)||!(n.match(l.og)||!e&&(0,r.iX)(n)))||((0,o.fZ)("Invalid timestamp",n),!1)}(n.timestamp)&&c(n.main,"main",!0)&&(n.main=s(n.main,"main"),n.main)?(n.aside=s(n.aside,"aside"),n.media=c(e=n.media,"media",!0)&&p(e.url)&&(c(t=e.type,"type",!0)&&l.WS.includes(t)||((0,o.fZ)("Invalid media type",type),0))?(e.caption=s(e.caption,"caption"),e):{url:"",type:"",caption:""},n):null;var e,t}function h(n,e=!1){var t;return t=e?l.bt:l.Q1,!(!c(n,"id",!0)||!n.match(t))||((0,o.fZ)("Invalid thread id",n),!1)}function p(n){return!!(0,i.HH)(n)||((0,o.fZ)("Invalid url",n),!1)}function v(n){return c(n,"data",!0)&&(n.nexus=(function(n){return!(!p(n)||n!=l.Gd)||((0,o.fZ)("Invalid app url"),!1)}(e=n.url)||(e=l.Gd),e),n.author=c(t=n.author,"author",!0)&&p(t.url)&&(t.handle=s(t.handle,"handle"),t.handle)?(t.about=s(t.about,"about"),t):null,n.author&&(n.threads=function(n){if(c(n,"threads",!0)){var e=[];n=n.slice(0,d("threads")[1]);for(var t=0;t<n.length;t++){if(n[t]=c(r=n[t],"threads.item",!0)&&h(r.id)&&(r.content=f(r.content),null!=r.content)?(r.title=s(r.title,"title"),r.description=s(r.description,"description"),r.linked=function(n){n.slice(0,d("linked")[1]);for(var e,t=[],r=0;r<n.length;r++){if(c(e=n[r],"linked.item",!0)&&p(e.url)&&h(e.id,!0)||((0,o.fZ)("Invalid linked thread"),0)){var i=n[r].url+" "+n[r].id;if(!t.includes(i)){t.push(i);continue}(0,o.fZ)("Duplicate linked thread",i)}n.splice(r,1)}return n.length&&n.sort(((n,e)=>n.url<e.url?1:-1)),n}(r.linked),r):null,null!=n[t]){if(!e.includes(n[t].id)){e.push(n[t].id);continue}(0,o.fZ)("Duplicate thread id",n[t].id)}n.splice(t,1)}if(n.length)return n}var r;return(0,o.fZ)("No valid thread"),[]}(n.threads),n.threads.length))?n:null;var e,t}}}]);