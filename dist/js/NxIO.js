/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */(()=>{var t={898:(t,e,n)=>{"use strict";function i(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}function a(t){return fetch(t).then((t=>t.json()))}function r(t){return t.split(/[\\/]/).pop()}function s(t,e){if(document.styleSheets.length)for(var n=r(e),i=0;i<document.styleSheets.length;i++){var a=document.styleSheets[i].href;if(a){if(a===e||r(a)===n)return!0;if(a.startsWith(window.location.origin)&&Object.prototype.hasOwnProperty.call(document.styleSheets[i],"cssRules")){var s=document.styleSheets[i].cssRules;for(let e=0;e<s.length;e++)if(s[e].selectorText===t)return!0}}}return!1}function d(t){return t.replace(/^(https?:\/\/)?/,"")}function o(t,e=!0){var n=d(t).split("/");if(n[n.length-1]||n.pop(),t=n[0],e&&n.length>1){n.length>2&&(t+="/...");var i=n.pop();i.length>18&&(i="..."+i.substring(-15)),t+="/"+i}return t}n.r(e),n.d(e,{init:()=>Bi});
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var c=[],l=!1;function u(t,e=null){var n={msg:t};e&&(n.detail=e),c.push(n),l&&console.log("Nexus/Error: "+JSON.stringify(n))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const h="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css",g=".nx-instance",p="#Nexus";
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function I(t=null,e=null,n=null){return t||(t=h),e||(e=g),n||t===h||(n=h),function(t,e,n=null){return n||!s(t,e)?new Promise(((t,i)=>{var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.onload=t,a.onerror=i,a.href=e,n?n.append(a):document.head.append(a)})):Promise.resolve(!0)}(e,t).then((()=>Promise.resolve(t))).catch((t=>(u("Theme not found",t.message),n?I(n):Promise.reject(new Error(404)))))}function M(t){return("string"==typeof t||t instanceof String)&&t.length}function v(t=10){var e=1;t>10&&(e+=Math.ceil(t/10));for(var n="",i=0;i<e;i++)n+=Math.random().toString(36).substring(2,10);return n.substring(0,t)}function f(t){if(""===t||0===t.length)return"";for(var e={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ă:"a",ą:"a",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",ð:"e",ę:"e",Ç:"C",ç:"c",ć:"c",č:"c",Ð:"D",đ:"d",ğ:"g",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ł:"L",ł:"l",Ñ:"N",ñ:"n",ń:"n",Š:"S",š:"s",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ÿ:"Y",ÿ:"y",ý:"y",Ž:"Z",ž:"z",Ż:"Z",ż:"z",ɶ:"oe",Œ:"OE",æ:"ae",Æ:"AE",ß:"ss"},n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],r=e[a];t=t.replace(a,r)}return t}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const x="https://nexus-dock.github.io/",y={nxdata:"Object",nexus:"String",author:"Object",handle:"String",about:"String",url:"String",threads:"Array","threads.item":"Object",id:"String",title:"String",description:"String",content:"Object",timestamp:"String",main:"String",aside:"String",media:"Object",type:"String",caption:"String",linked:"Array","linked.item":"String"},m="---",N="http://...",D="---",E="---",T="0000-00-00",j="...",A="page",S={handle:[3,30],about:[0,400],title:[3,30],description:[0,400],main:[1,1e3],aside:[0,400],caption:[0,200]},C={threads:[1,100],linked:[0,100]},L=["youtube","vimeo","soundcloud"],b=["page","video","image","audio"].concat(L),z="^[0-9]{4}((-|s|.|/)(0[1-9]|1[0-2])((-|s|.|/)(0[1-9]|[1-2][0-9]|3[0-1]))?)?",O="^[a-zA-Z0-9-]{3,36}$",w="^https?://.*",U=window.location.href,k=((B=U).lastIndexOf("/")<8&&"http"===B.substring(0,4)&&(B+="/"),B.substring(0,B.lastIndexOf("/")+1));var B;const _=new URLSearchParams(window.location.search.slice(1));function P(t){return _.has(t)}function Y(t){return t.length&&"http"!==t.substring(0,4)?k+t.replace(/^\.?\/?/,""):t}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function F(t){return Object.prototype.hasOwnProperty.call(S,t)?S[t]:(u("Unknown characters limits category",t),!1)}function H(t){return Object.prototype.hasOwnProperty.call(C,t)?C[t]:(u("Unknown items limits category",t),!1)}function Z(t,e,n=!0){return(t.length||n)&&(!function(t,e){var n=F(e);if(!1!==n){if(t.length>=n[0])return!0;u("Invalid min length",e)}return!1}(t,e)?t=function(t,e){var n=F(e);if(!1!==n){var i=n[0]-t.length;return i>0&&(t="-".repeat(i)+t),t}return u("Unable to extend string",e),t}(t,e):function(t,e){var n=F(e);if(!1!==n){if(t.length<=n[1])return!0;u("Invalid max length",e)}return!1}(t,e)||(t=function(t,e){var n=F(e);if(!1!==n)return function(t,e,n=!1){if((t=t.trimEnd()).length<=e)return t;if(e<6)return"(...)";if(n||!t.match(/\s/))return t.substring(0,e-5)+"(...)";for(var i=t.split(/\s/),a=i.length-1;a>-1&&!((t=t.slice(0,-(i[a].length+1))).length+6<e);a--);return t+" (...)"}(t,n[1]);return u("Unable to cut string",e),""}(t,e))),t}function V(t,e,n=!0){if(Object.prototype.hasOwnProperty.call(y,e)){var i=y[e];if(null!=t&&t.constructor.name===i){if(!n||!("object"==typeof(a=t)?!Object.keys(a).length:!a||!a.length))return!0;u("Field is empty",e)}else u("Invalid field type",e)}else u("Unknown field",e);var a;return!1}function Q(t,e){return e?function(t){return!(!V(t,"type",!0)||!b.includes(t))||(u("Invalid media type",t),!1)}(t)?t:A:""}function R(t,e=!1){if(V(t,"media",!0)){var n=null;if($(t.url,e)&&(n=t.url),n||e){var i=Q(t.type,null!==n),a=function(t){return t&&V(t,"caption",!1)?Z(t,"caption",!1):""}(t.caption);if(i||a)return n||(n=N),{url:n,type:i,caption:a}}}return{url:"",type:"",caption:""}}function W(t,e=!1){return!(!t||!V(t,"timestamp",!0)||!t.match(z)&&(e||!M(n=t)||isNaN(new Date(n))))||(u("Invalid timestamp",t),!1);var n}function q(t,e=!1){return W(t,!1)?function(t){if(!t)return T;if(t.match(z+"$"))return t;try{t=new Date(t).toISOString().split("T")[0]}catch(e){u("Invalid timestamp",t),t=T}return t}(t):e?T:null}function X(t,e=!1){if(!V(t,"content",!0))return function(t=!1){return t?{timestamp:T,main:j,aside:"",media:{url:"",type:"",caption:""}}:null}(e);var n=q(t.timestamp,e);if(!n)return null;var i=function(t,e=!1){return V(t,"main",!0)?Z(t,"main",!0):e?j:null}(t.main,e);if(!i)return null;var a,r={};return r.timestamp=n,r.main=i,r.aside=(a=t.aside)&&V(a,"aside",!1)?Z(a,"aside",!1):"",r.media=R(t.media,e),r}function G(t){var e={url:null,id:""};if(i(t)&&(e.url=t,t.includes("#"))){var n=t.split("#"),a=n.pop();e.url=n.join("#"),a&&J(a)&&(e.id=a)}return e}function J(t){return!(!V(t,"id",!0)||!t.match(O))||(u("Invalid thread id",t),!1)}function $(t,e=!1){var n=!1;if(t&&V(t,"url",!0)){if(i(t))return!0;e&&(n=!0)}return u("Invalid url"),n}function K(t){return(e=t)&&null!==e&&"Object"===e.constructor.name&&Object.keys(e).length&&$(t.url)&&(!t.id||"/"===t.id||J(t.id));var e}function tt(t,e){if(e.includes(t)){u("Duplicate thread id",t);for(var n=2;e.includes(t+"-"+n);)n++;t+="-"+n}return t}function et(t,e=[],n=!1){if(!V(t,"threads.item",!0))return null;var i=function(t,e=[],n=!1){return J(t)?tt(t,e):n?tt(D,e):null}(t.id,e,n);if(!i)return null;var a=function(t,e=!1){return V(t,"title",!0)?Z(t,"title",!0):e?E:null}(t.title,n);if(!a)return null;var r=X(t.content,n);if(!r)return null;var s,d={};return d.id=i,d.title=a,d.description=(s=t.description)&&V(s,"description",!1)?Z(s,"description",!1):"",d.content=r,d.linked=function(t){var e,n=[];if(V(t,"linked",!1)){var i=t.length,a=H("linked")[1];i>a&&(u("Too many linked threads",i+" /"+a),i=a);for(var r=0;r<i;r++){var s=null;if((e=t[r])&&V(e,"linked.item",!0)&&$(e)||(u("Invalid linked thread"),0)){var d=G(t[r]);s=d.url,d.id&&(s+="#"+d.id)}else K(t[r])&&(s=t[r].url,t[r].id&&"/"!==t[r].id&&(s+="#"+t[r].id));s&&(n.includes(s)?u("Duplicate linked thread",s):n.push(s))}}return n}(t.linked),d}function nt(t,e=!1){if(!V(t,"author",!0))return function(t=!1){return t?{handle:m,about:"",url:N}:null}(e);var n=function(t,e=!1){return V(t,"handle",!0)?Z(t,"handle",!0):e?m:null}(t.handle,e);if(!n)return null;var i=function(t,e=!1){return $(t,e)?t:e?N:null}(t.url,e);if(!i)return null;var a,r={};return r.handle=n,r.about=(a=t.about)&&V(a,"about",!1)?Z(a,"about",!1):"",r.url=i,r}function it(t){return function(t){return!(!$(t)||t!==x)||(u("Invalid app url"),!1)}(t)||(t=x),t}function at(t,e=!1){if(V(t,"nxdata",!0)){var n={};if(n.nexus=it(t.nexus),n.author=nt(t.author,e),n.author&&(n.threads=function(t,e=!1){var n=[];if(V(t,"threads",!0)){var i=t.length,a=H("threads")[1];i>a&&(u("Too many threads",i+" /"+a),i=a);for(var r=[],s=0;s<i;s++){var d=et(t[s],r,e);null!==d&&(r.push(d.id),n.push(d))}if(n.length)return n}return u("No valid thread"),[]}(t.threads,e),e||n.threads.length))return n}return null}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const rt=G(U);function st(t,e=null,n=[],a=null){e||(e=h),a||(a="en");var r={srcdoc:null,url:"",id:"",style:e,lang:a,mode:"reader"},s=null;return t&&t.dataset&&((s=t.dataset).lang&&(r.lang=s.lang),s.srcdoc&&(r.srcdoc=s.srcdoc),function(t,e,n){if(e&&e.style&&e.style!==t.style&&!n.includes(e.style)){var a=Y(e.style);i(a)&&(t.style=a)}}(r,s,n)),function(t,e){if(e){if(e.src){var n=G(Y(e.src));n.url&&(t.url=n.url,t.id=n.id)}e.id&&J(e.id)&&(t.id=e.id)}rt.id&&(t.id=rt.id)}(r,s),function(t,e){(e&&e.mode&&"editor"===e.mode||P("edit")||P("new"))&&(t.mode="editor")}(r,s),r}function dt(t,e=!0){var n,i=(n=JSON.stringify(t),(new TextEncoder).encode(n).length);return e&&(i/=1e3),i}function ot(t){var e;try{e=window[t];var n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var ct={visit:{},data:{},linked:{},oembed:{}},lt={local:ot("localStorage")?localStorage:null,session:ot("sessionStorage")?sessionStorage:null};function ut(t){return"local"===t?lt.local:lt.session}function ht(t){return t&&Object.prototype.hasOwnProperty.call(ct,t)}function gt(t,e){return ht(t)&&Object.prototype.hasOwnProperty.call(ct[t],e)}function pt(t,e,n="session",i=null){var a=JSON.stringify(e);if(ht(i)&&(ct[i][t]=a),n){var r=ut(n);if(r){var s=dt(a,!0);if(s>2e3)return;var d=r.getItem("available");d<1e3&&(d=5e3-function(t,e=2e3){for(var n=dt(t,!0),i=0;i<t.length&&!(n<e);i++){var a=t.key(i),r=dt(t.getItem(a),!0);t.removeItem(a),n-=r}return n}(r,2e3)),d-=s,r.setItem(t,a),r.setItem("available",Math.ceil(d))}}}function It(t,e="session",n=null){if(gt(n,t))return JSON.parse(ct[n][t]);if(e){var i=ut(e);if(i){var a=i.getItem(t);if(a)return ht(n)&&(ct[n][t]=a),JSON.parse(a)}}return null}function Mt(t){var e=ut("local");if(e&&e.length)for(var n=0;n<e.length;n++){var i=e.key(n);t(e,i)}}Object.values(lt).forEach((t=>{t&&!t.getItem("available")&&t.setItem("available",5e3)}));
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const vt="nx-edit#";function ft(t,e){pt(vt+t,e,"local")}function xt(t,e){pt(t,e,null,"data")}function yt(t){pt("nx-lang",t,"local")}function mt(){!function(t=[]){Object.keys(ct).forEach((e=>{t.includes(e)||(ct[e]={})}))}(),function(t=null){Object.keys(lt).forEach((e=>{lt[e]&&t!==e&&lt[e].clear()}))}("local"),Mt((function(t,e){0!==e.indexOf(vt)&&t.removeItem(e)}))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function Nt(t){var e=[];return t.threads.forEach((t=>{e.push(t.id)})),e}function Dt(t,e=!1){var n=null;try{if((n=JSON.parse(t))&&(n=at(n,e)),!n)throw new Error("Invalid Nexus data")}catch(t){u("Invalid source",t.message)}return n}function Et(t,e=!1){var n=function(t){return It(t,null,"data")}(t);return null!==n?Number.isInteger(n)?Promise.reject(new Error(n)):Promise.resolve(n):function(t,e=!1){return a(t).then((n=>(n=at(n,e))?(e||xt(t,n),n):(u("Invalid source",t),Promise.reject(new Error(400))))).catch((e=>{var n=400;return 400!==e.message&&(n=404,u("No response",e.message)),xt(t,n),Promise.reject(new Error(n))}))}(t,e)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const Tt={customSelector:null,forceLog:!1,forceStyle:null,customSignatureRule:null,appDefaultCss:null,appDefaultCssAliases:[],appDefaultLang:null};function jt(){P("clear")&&mt(),P("erase")&&Mt((function(t,e){0===e.indexOf(vt)&&t.removeItem(e)}))}function At(t=!1){(t||P("log"))&&function(t=!0){l=t}(!0)}function St(t=null){var e,n=[p];t&&t!==p&&n.unshift(t);for(var i=0;i<2;i++)if(e=document.querySelector(n[i]))return e;return(e=document.createElement("DIV")).id=p,e}function Ct(t={}){var e={};return e.options=Object.assign({},Tt,t),jt(),document.cookie="Nx=Instance; SameSite=None; Secure",At(e.options.forceLog),e.nxelm=St(e.options.customSelector),e.request=st(e.nxelm,e.options.appDefaultCss,e.options.appDefaultCssAliases,e.options.appDefaultLang),function(t,e=null,n=null,i=null){var a=t.style;return n?(a=n,e&&e!==n||(e=t.style)):e===a&&(e=null),I(a,i,e)}(e.request,e.options.appDefaultCss,e.options.forceStyle,e.options.customSignatureRule).then((t=>(e.styleUrl=t,function(t){if(t.srcdoc){var e=Dt(t.srcdoc,"editor"===t.mode);if(e)return Promise.resolve(e)}return t.url?Et(t.url):Promise.reject(new Error(0))}(e.request)))).then((t=>(e.nxdata=t,e))).catch((t=>{var e=t.message;throw Number.isInteger(e)||(u("Nexus Init Failed",e),e=400),new Error(e)}))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var Lt={fr:{author:"auteur·e",handle:"pseudonyme",about:"à propos",url:"url",id:"id",title:"titre",description:"description",timestamp:"date",main:"corps",aside:"aparté",media:"média",type:"type",caption:"légende",index:"index",distant:"distant",local:"local",threads:"fils",linked:"liés",content:"contenu",history:"historique",copied:"copié",embed:"intégré",source:"source",saved:"sauvegardé","local thread":"fil local","linked threads":"fils liés","No valid thread":"Aucun fil valide","Duplicate thread id":"Identifiant du fil en double","Duplicate linked thread":"Fil lié en double","Invalid linked thread":"Fil lié non valide","Invalid url":"Url non valide","Invalid thread id":"Identifiant de fil non valide","Invalid length":"Longueur non valide","Invalid min length":"Longueur minimale non valide","Invalid max length":"Longueur maximale non valide","Unable to cut string":"Impossible de raccourcir le texte","Invalid timestamp":"Horodatage non valide","Unknown field":"Champ inconnu","Invalid field type":"Type de champ non valide","Field is empty":"Le champ est vide","Unable to extend string":"Impossible de prolonger le texte","Unknown characters limits category":"Catégorie de limite de caractères inconnue","Unknown items limits category":"Catégorie de limite d'éléments inconnue","Invalid media type":"Type de media non valide","Invalid app url":"Url de l'application non valide","Too many linked threads":"Trop de fils liés","Too many threads":"Trop de fils","Init failed":"L'initialisation a échoué","Theme not found":"Thème non trouvé","No response":"Aucune réponse","Invalid source":"Source non valide","Invalid Nexus data":"Données Nexus non valides"}},bt=Object.keys(Lt);bt.push("en");var zt=It("nx-lang","local");null==zt||wt(zt)||(zt=null,yt(null));var Ot=null;function wt(t){return M(t)&&bt.includes(t)}function Ut(t){return!(!wt(t)||t===Ot)&&(Ot=t,function(t){zt!==t&&(yt(t),zt=t)}(t),!0)}function kt(){return Ot}function Bt(t){var e=t;return"en"!==Ot&&Lt[Ot][t]&&(e=Lt[Ot][t]),e}zt?Ot=zt:wt(Ot=document.querySelector("html").lang)||(Ot="en");var _t={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},Pt={onChange:[],onSrcChange:[]};function Yt(t){var e=t.dataUrl;return"/"!==t.threadId&&(e+="#"+t.threadId),e}function Ft(t){return-1!==t.threadIndex&&t.srcData.threads&&t.threadIndex<t.srcData.threads.length?t.srcData.threads[t.threadIndex].content.timestamp:null}function Ht(t){var e=Ft(t);return!!e&&function(t,e){var n=It(t,"local","visit");return!n||!(!e||n===e)}(Yt(t),e)}function Zt(t,e,n,i=!1){n.index=Nt(n);var a={dataUrl:t,threadId:e,srcData:n,threadIndex:n.index.indexOf(e)};return-1===a.threadIndex&&(i?"/"!==a.threadId&&(a.threadId="/"):function(t){t.threadIndex=0,t.threadId=t.srcData.index[0]}(a)),a}function Vt(t,e,n=!1){return Et(t).then((i=>Zt(t,e,i,n)))}function Qt(t,e=!1){var n="onChange";e&&(n="onSrcChange"),Pt[n].push(t)}function Rt(t,e=!1,n=!1){var i,a,r=t.dataUrl!=_t.dataUrl;if(n||r||t.threadId!=_t.threadId){e||(i=Yt(_t),a=Ft(_t),gt("visit",i)||pt(i,a,"local","visit"));var s=r||n;_t=Object.assign({},t),function(t,e,n,i){var a=["onChange"];e&&a.push("onSrcChange"),a.forEach((e=>{Pt[e].length&&Pt[e].forEach((e=>{e(t,n,i)}))}))}(t,s,e,n)}}function Wt(t,e,n){var i=Object.assign({},t);return i.threadId=e,i.threadIndex=n,i}const qt={spacing:["padding-top","padding-bottom","margin-top","margin-bottom"],transitions:["transition-duration","transition-timing-function","transition-property"],heights:["height","overflow"]},Xt={target:"height, margin, padding",toReset:["height"].concat(qt.spacing),removeInFirst:qt.spacing,removeInThen:qt.heights.concat(qt.transitions),removeOut:qt.heights.concat(qt.spacing,qt.transitions)},Gt={target:"opacity",toReset:["opacity"],removeInFirst:["opacity"],removeInThen:qt.transitions,removeOut:["opacity"].concat(qt.transitions)},Jt={slide:Xt,fade:Gt,ease:{target:Xt.target+", "+Gt.target,toReset:["opacity"].concat(Xt.toReset),removeInFirst:qt.spacing.concat(["opacity"]),removeInThen:Xt.removeInThen,removeOut:["opacity"].concat(Xt.removeOut)}},$t="ease",Kt=300,te="ease-in-out",ee=1e3;function ne(t){t.style.removeProperty("display");let e=window.getComputedStyle(t).display;"none"===e&&(e="block"),t.style.display=e}function ie(t,e,n,i){t.style.setProperty("transition-property",Jt[e].target),t.style.setProperty("transition-timing-function",i),t.style.setProperty("transition-duration",n+"ms")}function ae(t,e){Jt[e].toReset.forEach((e=>{t.style.setProperty(e,0)}))}function re(t,e,n){Jt[e][n].forEach((e=>{t.style.removeProperty(e)}))}function se(t,e,n,i){t instanceof Element||(t=document.body);var a="m"+Math.random().toString(20).substring(2);return e.classList.add(a),new Promise((r=>{var s=new MutationObserver((()=>{t.querySelector("."+a)&&(e.classList.remove(a),s.disconnect(),i(),r(!0))}));s.observe(t,{childList:!0}),n()}))}function de(t,e=$t,n=Kt,i=null,a=te){ie(t,e,n,a),"fade"!==e&&(t.style.setProperty("box-sizing","border-box"),t.style.setProperty("height",t.offsetHeight+"px"),t.offsetHeight,t.style.setProperty("overflow","hidden")),ae(t,e),window.setTimeout((()=>{t.style.setProperty("display","none"),re(t,e,"removeOut"),"function"==typeof i&&i()}),n)}function oe(t,e=$t,n=Kt,i=null,a=te){if("fade"===e)ae(t,"fade"),ne(t),ie(t,"fade",n,a);else{ne(t);var r=t.offsetHeight;t.style.setProperty("overflow","hidden"),ae(t,e),t.offsetHeight,t.style.setProperty("box-sizing","border-box"),ie(t,e,n,a),t.style.setProperty("height",r+"px")}re(t,e,"removeInFirst"),window.setTimeout((()=>{re(t,e,"removeInThen"),"function"==typeof i&&i()}),n)}function ce(t,e=$t,n=ee,i=Kt,a=null,r=te){var s=[de,oe];(function(t){if(!t)return!1;do{if(t instanceof Element){if(t.hidden||!t.offsetHeight)return!0;var e=window.getComputedStyle(t);if("0"===e.width||"0"===e.height||"0"===e.opacity||"none"===e.display||"hidden"===e.visibility)return!0}}while(t=t.parentNode);return!1})(t)&&s.reverse();s[0](t,e,i,(function(){"function"==typeof a&&a(),window.setTimeout((()=>{s[1](t,e,i,a,r)}),n)}),r)}function le(t,e,n=!1,i=$t,a=Kt,r=null,s=te){var d;e.style.setProperty("display","none"),d=n?function(){t.prepend(e)}:function(){t.append(e)};se(t,e,d,(function(){oe(e,i,a,r,s)}))}function ue(t,e,n=Kt,i=null,a=te){e.style.opacity=0;var r=t.parentNode,s=t.offsetHeight,d=function(){t.replaceWith(e)},o=function(){!function(t,e,n=Kt,i=null,a=te){var r="ease";t.offsetHeight===e&&(r="fade");oe(t,r,n,i,a)}(e,s,n,i,a)};de(t,"fade",n,(function(){se(r,e,d,o)}),a)}function he(t,e,n=20){var i,a,r,s=t.textContent.split(""),d=e.split(""),o=s.length,c=d.length;o>c?(i=o,a=0,r=function(){i>c?s.pop():s[i-1]=d[i-1],i--}):(i=0,a=c,r=function(){i<o?s[i]=d[i]:s.push(d[i]),i++});var l=setInterval((function(){r(),t.textContent=s.join(""),i===a&&clearInterval(l)}),n)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var ge={};function pe(t,e){he(t,Bt(e),50)}function Ie(t,e){ge[e]||(ge[e]=[]),ge[e].push(t)}function Me(t){var e="/";return t&&-1!==t.threadIndex&&t.srcData.threads[t.threadIndex]&&(e=t.srcData.threads[t.threadIndex].title),e}function ve(t,e,n){n.dataUrl&&e.dataUrl===n.dataUrl&&e.threadId==n.threadId?t.classList.add("nx-on-display"):t.classList.remove("nx-on-display")}function fe(){var t=ye("P");return t.textContent=kt(),Se(bt,t,(function(t){!function(t){if(Ut(t))for(const[t,e]of Object.entries(ge))e.forEach((e=>{pe(e,t)}))}(t)}),"nx-lang-switch")}function xe(){var t,e=ye("HEADER");return e.append(((t=ye("A","nx-app-link nx-external-link")).target="_blank",t.href=x,t.title="Nexus",t.textContent="Nexus",t)),e}function ye(t,e){var n=document.createElement(t);return e&&(n.className=e),n}function me(t,e){var n=ye("DIV","nx-instance");return n.append(t,function(t){var e=ye("MAIN");return e.append(...t),e}(e)),n}function Ne(t,e,n=[],i="reader"){var a=ye("DIV","nx-"+i),r=ye("NAV");r.append(...t);var s=ye("SECTION");if(s.append(...e),a.append(r,s),n.length){var d=ye("FOOTER");d.append(...n),a.append(d)}return a}function De(t,e=null,n=null){var i=ye("DIV","nx-"+t+" nx-block");return n&&i.append(n),e&&i.append(...e),i}function Ee(t){var e=ye("SPAN","nx-landmark nx-landmark-"+t.replace(" ","-"));return e.textContent=Bt(t),Ie(e,t),e}function Te(){var t=ye("P");return!function(t=null,e=null){return t||(t=h),e||(e=g),s(e,h)}()?(t.style.margin="2vh auto",t.style.fontFamily='"Courier New", Courier, monospace',t.style.fontSize="13px"):t.className="nx-error",t.textContent="—/ — ",t}function je(t){t.position>0?t.ctrls.prev.elm.classList.remove("nx-nav-end"):t.ctrls.prev.elm.classList.add("nx-nav-end"),t.position<t.count-1?t.ctrls.next.elm.classList.remove("nx-nav-end"):t.ctrls.next.elm.classList.add("nx-nav-end")}function Ae(t,e,n=!1){Object.keys(t.ctrls).forEach((i=>{t.ctrls[i].elm=ye("A","nx-nav-ctrl nx-nav-end"),n?t.ctrls[i].elm.append(Oe(t.ctrls[i].symbol)):t.ctrls[i].elm.textContent=t.ctrls[i].symbol,t.ctrls[i].elm.addEventListener("click",(function(){t.ctrls[i].elm.classList.contains("nx-nav-end")||("next"===i?t.position++:t.position--,e(i,t.position),je(t))}))}))}function Se(t,e,n=null,i=null){var a="nx-selected";e.classList.add("nx-select-toggle");var r,s="INPUT"==e.tagName;s?(e.setAttribute("autocomplete","off"),r=e.value):r=e.textContent;var d=ye("UL","nx-select-list"),o=ye("DIV","nx-select");return i&&o.classList.add(i),o.append(e,d),e.addEventListener("click",(()=>{var t="none";d.style.display==t&&(t="block"),d.style.display=t})),t.forEach((t=>{var i=ye("LI");i.textContent=t,i.dataset.item=t,t==r&&i.classList.add(a),d.append(i),i.addEventListener("click",(()=>{var t=i.textContent;if((s?e.value:e.textContent)!=t){if(!i.classList.contains(a)){var r=d.querySelector(".nx-selected");r&&r.classList.remove(a),i.classList.add(a)}s?e.value=t:e.textContent=t,e.dispatchEvent(new window.Event("change")),"function"==typeof n&&n(t)}d.style.display="none"}))})),d.style.display="none",o}function Ce(t,e){ve(t,e,_t),Qt((function(n){ve(t,e,n)}))}function Le(t,e=!1){var n=ye("A","nx-view-link");return n.append(be(t,e)),n}function be(t,e=!1){var n=ye("SPAN","nx-thread-title");return n.textContent=Me(t),e&&Qt((function(t){var e=Me(t);he(n,e,15)})),n}function ze(t){var e=ye("DIV","nx-lines");if(t){var n=t.split(/(\r\n|\n|\r)/gm),i=[];n.forEach((t=>{var e=ye("P");e.textContent=t,i.push(e)})),e.append(...i)}return e}function Oe(t,e=20){var n=new Image(e,e);return n.className="nx-icon",n.src=t,n}var we={};function Ue(t){return we[t]||(we[t]=function(t){for(var e=t.replace(/^(https?:\/\/)?(www.)?/,"").split(":")[0].split("/")[0].split("."),n=0;n<e.length;n++)if(e[n].includes("-"))e[n]=e[n].split("-").map((t=>t[0])).join("-");else{for(var i=e[n].split(""),a=0,r=0;r<i.length;r++)["a","e","i","o","u","y"].includes(i[r])&&(0!==a&&r!==a+1?i[r]="":a=r);e[n]=i.join("")}return e.join(".")}(t)),we[t]}function ke(t,e){t.classList.contains("nx-on-display")?(t.classList.remove("nx-unseen"),t.lastChild.textContent=""):Ht(e)&&(t.classList.add("nx-unseen"),t.lastChild.textContent="*")}function Be(t,e=!1){var n=ye("SPAN","nx-handle");return t.srcData&&(n.textContent=t.srcData.author.handle),e&&Qt((function(t){he(n,t.srcData.author.handle,25)}),!0),n}function _e(t,e=!1){var n=ye("SPAN","nx-author-url"),i=[];["[","]"].forEach((t=>{var e=ye("SPAN","nx-author-url-brackets");e.textContent=t,i.push(e)}));var a=ye("A","nx-external-link");a.target="_blank";var r="";return t.srcData&&(r=t.srcData.author.url),a.href=r,t.srcData&&(a.textContent=Ue(t.srcData.author.url)),n.append(i[0],a,i[1]),e&&Qt((function(t){a.href=t.srcData.author.url,he(a,Ue(t.srcData.author.url),25)}),!0),n}function Pe(t,e=!1){var n=Le(t,e);return"/"!==t.threadId&&(Ce(n,t),function(t,e){t.append(ye("SPAN","nx-new-tag")),ke(t,e),Qt((function(){ke(t,e)}))}(n,t)),n.addEventListener("click",(()=>{Rt(t)})),n}function Ye(t,e=!1){var n=ye("A","nx-author-link");n.append(Be(t,e));var i=Wt(t,"/",-1);return Ce(n,i),n.addEventListener("click",(function(){Rt(i,"/")})),n}function Fe(t){t.scrollIntoView({block:"end",behavior:"smooth"})}var He=!1,Ze=null,Ve=null,Qe={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},Re={ctrls:{prev:{symbol:"<",elm:null},next:{symbol:">",elm:null}},position:0,count:1};function We(){var t,e=ye("DIV","nx-history-nav");return Ae(Re,(function(t,e){Ze.children[e+1].querySelector(".nx-thread-title").click()})),e.append(Re.ctrls.prev.elm,((t=ye("A","nx-history-toggle")).textContent="≚",t.addEventListener("click",(()=>{"≙"==t.textContent?(t.textContent="≚",t.classList.remove("nx-active"),de(Ve,"ease",200)):(t.textContent="≙",t.classList.add("nx-active"),oe(Ve,"ease",200),Fe(Ze))})),t),Re.ctrls.next.elm),e}function qe(t){Ze=ye("UL","nx-history-list");var e=ye("LI");e.textContent="...",Ze.append(e),t&&t.srcData&&(Qe=t,Ze.append(Xe(t,0))),(Ve=ye("DIV","nx-history-drawer")).append(Ze),Ve.style.display="none",Qt((function(t,e){!function(t,e){if(!(e||He||t.dataUrl===Qe.dataUrl&&t.threadId===Qe.threadId)){Qe=t,Re.count>100?Ze.children[1].remove():Re.count++,Re.position=Re.count-1;var n=Xe(t,Re.position);le(Ze,n,!1,"ease",200,(function(){Fe(Ze)})),je(Re)}}(t,e)}))}function Xe(t,e){var n=document.createElement("LI");return n.append(...function(t,e){return[Ye(t,!1),_e(t,!1),Ge(t,e)]}(t,e)),n}function Ge(t,e){var n=Le(t,!1);return Ce(n,t),n.addEventListener("click",(()=>{He=!0,Rt(t,!0),Re.position=e,He=!1})),n}var Je=null;function $e(t){var e=null;return t.srcData&&t.srcData.author.about&&(e=t.srcData.author.about),ze(e)}function Ke(t){if(Je=ye("UL"),t.srcData){var e=t.srcData.index;if(e.length)for(var n=0;n<e.length;n++)Je.append(tn(t,e[n],n))}Qt((function(t){!function(t){var e=Je.childNodes,n=t.srcData.index,i=n.length,a=e.length,r=0;if(a)for(var s=function(t){de(t,"ease",200,(function(){t.remove()}))},d=0;d<a;d++)if(i>d){var o=tn(t,n[d],d);ue(e[d],o,200),r++}else s(e[d]);if(r<i)for(var c=r;c<i;c++)le(Je,tn(t,n[c],c),!1,"ease",200)}(t)}),!0)}function tn(t,e,n){var i=Wt(t,e,n),a=ye("LI");return a.append(Pe(i,!1)),a}function en(t){var e=ye("DIV","nx-index-header");return e.append(Be(t,!0),_e(t,!0),function(t){var e=ye("DIV","nx-about-author");return e.append($e(t)),Qt((function(t){ue(e.firstChild,$e(t),200)}),!0),e}(t)),e}function nn(t){return Ke(t),De("threads-list",[Je])}function an(t){var e=ye("DIV","nx-main-block nx-index"),n=[en(t),nn(t)];return e.append(...n),e}const rn="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css",sn=["https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NexusI.min.css"],dn="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA4IEMgNy42NjQwNjMgOCAxLjI1IDE1LjM0Mzc1IDEuMjUgMTUuMzQzNzUgTCAwLjY1NjI1IDE2IEwgMS4yNSAxNi42NTYyNSBDIDEuMjUgMTYuNjU2MjUgNy4wOTc2NTYgMjMuMzI0MjE5IDE0Ljg3NSAyMy45Mzc1IEMgMTUuMjQ2MDk0IDIzLjk4NDM3NSAxNS42MTcxODggMjQgMTYgMjQgQyAxNi4zODI4MTMgMjQgMTYuNzUzOTA2IDIzLjk4NDM3NSAxNy4xMjUgMjMuOTM3NSBDIDI0LjkwMjM0NCAyMy4zMjQyMTkgMzAuNzUgMTYuNjU2MjUgMzAuNzUgMTYuNjU2MjUgTCAzMS4zNDM3NSAxNiBMIDMwLjc1IDE1LjM0Mzc1IEMgMzAuNzUgMTUuMzQzNzUgMjQuMzM1OTM4IDggMTYgOCBaIE0gMTYgMTAgQyAxOC4yMDMxMjUgMTAgMjAuMjM0Mzc1IDEwLjYwMTU2MyAyMiAxMS40MDYyNSBDIDIyLjYzNjcxOSAxMi40NjA5MzggMjMgMTMuNjc1NzgxIDIzIDE1IEMgMjMgMTguNjEzMjgxIDIwLjI4OTA2MyAyMS41ODIwMzEgMTYuNzgxMjUgMjEuOTY4NzUgQyAxNi43NjE3MTkgMjEuOTcyNjU2IDE2LjczODI4MSAyMS45NjQ4NDQgMTYuNzE4NzUgMjEuOTY4NzUgQyAxNi40ODA0NjkgMjEuOTgwNDY5IDE2LjI0MjE4OCAyMiAxNiAyMiBDIDE1LjczNDM3NSAyMiAxNS40NzY1NjMgMjEuOTg0Mzc1IDE1LjIxODc1IDIxLjk2ODc1IEMgMTEuNzEwOTM4IDIxLjU4MjAzMSA5IDE4LjYxMzI4MSA5IDE1IEMgOSAxMy42OTUzMTMgOS4zNTE1NjMgMTIuNDgwNDY5IDkuOTY4NzUgMTEuNDM3NSBMIDkuOTM3NSAxMS40Mzc1IEMgMTEuNzE4NzUgMTAuNjE3MTg4IDEzLjc3MzQzOCAxMCAxNiAxMCBaIE0gMTYgMTIgQyAxNC4zNDM3NSAxMiAxMyAxMy4zNDM3NSAxMyAxNSBDIDEzIDE2LjY1NjI1IDE0LjM0Mzc1IDE4IDE2IDE4IEMgMTcuNjU2MjUgMTggMTkgMTYuNjU2MjUgMTkgMTUgQyAxOSAxMy4zNDM3NSAxNy42NTYyNSAxMiAxNiAxMiBaIE0gNy4yNSAxMi45Mzc1IEMgNy4wOTM3NSAxMy42MDkzNzUgNyAxNC4yODUxNTYgNyAxNSBDIDcgMTYuNzUzOTA2IDcuNSAxOC4zOTQ1MzEgOC4zNzUgMTkuNzgxMjUgQyA1Ljg1NTQ2OSAxOC4zMjQyMTkgNC4xMDU0NjkgMTYuNTg1OTM4IDMuNTMxMjUgMTYgQyA0LjAxMTcxOSAxNS41MDc4MTMgNS4zNTE1NjMgMTQuMjAzMTI1IDcuMjUgMTIuOTM3NSBaIE0gMjQuNzUgMTIuOTM3NSBDIDI2LjY0ODQzOCAxNC4yMDMxMjUgMjcuOTg4MjgxIDE1LjUwNzgxMyAyOC40Njg3NSAxNiBDIDI3Ljg5NDUzMSAxNi41ODU5MzggMjYuMTQ0NTMxIDE4LjMyNDIxOSAyMy42MjUgMTkuNzgxMjUgQyAyNC41IDE4LjM5NDUzMSAyNSAxNi43NTM5MDYgMjUgMTUgQyAyNSAxNC4yODUxNTYgMjQuOTA2MjUgMTMuNjAxNTYzIDI0Ljc1IDEyLjkzNzUgWiIvPjwvc3ZnPg==",on="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA3LjIxODc1IDUuNzgxMjUgTCA1Ljc4MTI1IDcuMjE4NzUgTCAxNC41NjI1IDE2IEwgNS43ODEyNSAyNC43ODEyNSBMIDcuMjE4NzUgMjYuMjE4NzUgTCAxNiAxNy40Mzc1IEwgMjQuNzgxMjUgMjYuMjE4NzUgTCAyNi4yMTg3NSAyNC43ODEyNSBMIDE3LjQzNzUgMTYgTCAyNi4yMTg3NSA3LjIxODc1IEwgMjQuNzgxMjUgNS43ODEyNSBMIDE2IDE0LjU2MjUgWiIvPjwvc3ZnPg==";var cn=null,ln=!1,un=null;function hn(t){return ln?"#editing":Yt(t)}function gn(t){return t.dataUrl?hn(t):""}function pn(){var t="< />",e=function(t,e){var n=ye("A","nx-source-"+t);return n.textContent=e,n}("snippets","</>");return e.addEventListener("click",(()=>{e.textContent==t?(e.textContent="</>",e.classList.remove("nx-active"),de(cn,"ease",200)):(e.textContent=t,e.classList.add("nx-active"),oe(cn,"ease",100,(function(){cn.scrollIntoView({block:"end",behavior:"smooth",inline:"nearest"})})))})),e}function In(t){(cn=ye("DIV","nx-source-drawer")).append(function(t){return fn("json",Mn(t,gn))}(t),function(t){return fn("embed",Mn(t,xn))}(t)),cn.style.display="none";var e=ye("DIV","nx-source-toggle"),n=pn();return e.append(n),[e,cn]}function Mn(t,e){var n=ye("TEXTAREA");return n.spellcheck=!1,n.textContent=e(t),Qt((function(t){n.textContent=e(t)})),n}function vn(t){var e=ye("A","nx-source-link"),n=Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA0IDQgTCA0IDI0IEwgMTEgMjQgTCAxMSAyMiBMIDYgMjIgTCA2IDYgTCAxOCA2IEwgMTggNyBMIDIwIDcgTCAyMCA0IFogTSAxMiA4IEwgMTIgMjggTCAyOCAyOCBMIDI4IDggWiBNIDE0IDEwIEwgMjYgMTAgTCAyNiAyNiBMIDE0IDI2IFoiLz48L3N2Zz4=",16);e.append(n);var i,a,r=(i="c/c",(a=ye("SPAN","nx-source-copy-tooltip")).textContent=i,a.style.opacity=0,a.hidden=!0,Ie(a,i),a);return e.append(r),e.addEventListener("click",(()=>{return e=t.textContent,n=()=>{ce(r,"fade",1e3,200)},void navigator.clipboard.writeText(e).then((()=>n()));var e,n})),e}function fn(t,e){var n=ye("DIV","nx-"+t+"-snippet");return n.append(e,vn(e)),n}function xn(t){return ln?"#editing":t.dataUrl?
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function(t,e=null,n=null,i=null){var a="";i&&(a=' data-lang="'+i+'"');var r="";return e&&(r=' data-style="'+e+'"'),n||(n="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js"),`<div id="Nexus" data-src="${t}"${r}${a}></div>\n<script src="${n}"><\/script>`}(hn(t),un,"https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js",kt()):""}function yn(t,e=null,n=!1){return n&&(ln=!0),e?e!==rn&&(un=e):e=rn,De("source",In(t),!1)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const mn=new Event("mediaReady");function Nn(t,e){(function(t,e=null){return e&&e instanceof Element||(e=document.body),new Promise((n=>{var i=e.querySelector(t);if(i)return n(i);var a=new MutationObserver((()=>{(i=e.querySelector(t))&&(a.disconnect(),n(i))}));a.observe(e,{childList:!0,subtree:!0})}))})(t.tagName,e).then((()=>{e.dispatchEvent(mn)}))}function Dn(t,e,n){if("A"!==n.tagName){var i="load",a=n;["VIDEO","AUDIO"].includes(n.tagName)&&(i="loadedmetadata","VIDEO "===n.tagName&&(a=n.firstChild)),n.addEventListener(i,(function(){Nn(n,e)})),a.addEventListener("error",(function(){u("Unable to load requested media",t);var i=Tn(t);n.replaceWith(i),Nn(i,e)})),a.src=t}else n.textContent||(n.textContent=o(t,!0)),Nn(n,e),n.href=t;e.append(n)}function En(t,e="src",n=null){n&&t.setAttribute(e,n)}function Tn(t=null){var e=document.createElement("A");return e.target="_blank",t&&(e.textContent=o(t,!0),e.setAttribute("href",t)),e}function jn(t=null){var e=document.createElement("VIDEO");e.setAttribute("controls",!0);var n=document.createElement("SOURCE");return e.append(n),En(n,"src",t),e}function An(t=null){var e=document.createElement("AUDIO");return e.setAttribute("controls",!0),En(e,"src",t),e}function Sn(t=null){var e=document.createElement("IMG");return En(e,"src",t),e}function Cn(t=null){var e=document.createElement("IFRAME");return e.scrolling="no",e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",e.allowfullscreen=!0,En(e,"src",t),e}function Ln(t,e=null){var n;switch(L.includes(t)&&(t="iframe"),t){case"image":n=Sn;break;case"video":n=jn;break;case"audio":n=An;break;case"iframe":n=Cn;break;default:n=Tn}return n(e)}function bn(t,e){var n=It(t,"local","oembed"),i=function(){return{type:e,url:n}},r=function(){return{type:"page",url:t}};if(n)return Promise.resolve(i());var s=function(t,e,n=null,i=null){e=e.toLowerCase();var a={youtube:"https://youtube.com/oembed?url=",vimeo:"https://vimeo.com/api/oembed.json?url=",soundcloud:"https://soundcloud.com/oembed?format=json&url="};return!!Object.prototype.hasOwnProperty.call(a,e)&&(t=a[e]+encodeURIComponent(t),null!=n&&(t+="&maxwidth="+n),null!=i&&(t+="&maxheight="+i),t)}(t,e,720);return s?function(t){return a(t).then((t=>{if(t&&Object.prototype.hasOwnProperty.call(t,"html"))return t;throw new Error("invalid oembed response")}))}(s).then((e=>(n=e.html.split('src="')[1].split('"')[0],function(t,e){pt(t,e,"local","oembed")}(t,n),i()))).catch((e=>(u("Failed to resolved oembed media",{url:t,err:e.message}),r()))):Promise.resolve(r())}function zn(t,e,n){L.includes(e)?function(t,e,n){bn(t,e).then((t=>{Dn(t.url,n,Ln(t.type))}))}(t,e,n):Dn(t,n,Ln(e))}function On(t,e=null){var n=ye("DIV","nx-content-media");return n.append(function(t,e){var n=ye("DIV","nx-media"),i=ye("DIV");n.append(i);var a=null;return t.content.media.caption&&(a=gi(t,["content","media","caption"]),n.append(a)),i.addEventListener("mediaReady",(function(){"A"===i.firstChild.tagName&&"page"!==t.content.media.type&&(t.content.media.type="page"),i.className="nx-"+t.content.media.type+"-media",null!==e&&e()})),zn(t.content.media.url,t.content.media.type,i),n}(t,e)),n}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
class wn{constructor(t,e=[],n=100){this.spinContainer=t,e.length?""!==e[0]&&e.unshift(""):e=["","/","–","\\","|"],this.spinStates=e,this.speed=n,this.spinPosition=-1}endSpin(){this.spinPosition=-1}startSpin(){this.spinPosition=0;var t=window.setInterval(function(){-1===this.spinPosition?(this.spinContainer.textContent="",clearInterval(t)):(this.spinContainer.textContent=this.spinStates[this.spinPosition],this.spinPosition===this.spinStates.length-1?this.spinPosition=1:this.spinPosition++)}.bind(this),this.speed)}}function Un(t,e,n=[],i=!1){var a={instances:null,register:!1};return i||(a.instances=function(t){return It(t+":linked",null,"linked")}(t)),null===a.instances&&(a.instances=
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function(t,e=[]){for(var n={},i=0;i<t.linked.length;i++)if(!e.includes(t.linked[i])){var a=G(t.linked[i]);e.includes(a.url)||(Object.prototype.hasOwnProperty.call(n,a.url)||(n[a.url]=[]),a.id&&n[a.url].push(a.id))}return n}(e,n),a.register=!0),a}var kn,Bn,_n,Pn,Yn,Fn,Hn,Zn,Vn,Qn=!1,Rn=!1,Wn=[],qn=0,Xn={ctrls:{prev:{symbol:"⊼",elm:null},next:{symbol:"⊻",elm:null}},position:0,count:0};function Gn(){Hn=ye("DIV","nx-loading"),Zn=new wn(Hn)}function Jn(){2===++qn&&(Zn.endSpin(),Hn.style.display="none",Wn.length&&(Xn.count=Wn.length,je(Xn),function(t=!1){di(!0),t&&(Yn.style.visibility="visible");Bn.append(Wn[0])}(Wn.length>1)),oe(kn,"ease",200))}function $n(t){var e=Kn(t);de(kn,"ease",200,(function(){var n,i;e&&(Zn.startSpin(),qn=0,Hn.style.display="block"),n=t.dataUrl,i=e,ni(),di(!1),ai(!1),Wn=[],Xn.position=0,Xn.count=0,je(Xn),ii(n,i);var a=oi(e,!1),r=gi(e,["description"]);_n.firstChild.replaceWith(r),Pn.firstChild.replaceWith(a)}))}function Kn(t){var e=null;return t&&t.threadIndex>-1&&(e=t.srcData.threads[t.threadIndex]),e}function ti(t,e){return(Vn=Ee("distant")).style.display="none",Fn=ye("DIV"),Bn=ye("DIV","nx-distant-link"),Ae(Xn,ri),je(Xn),Fn.append(((Yn=ye("NAV","nx-distant-nav")).append(Xn.ctrls.prev.elm,Bn,Xn.ctrls.next.elm),ni(),Yn),Bn),ii(t,e),De("distant",[Fn],Vn)}function ei(t){return function(t){(Pn=ye("DIV","nx-local-content")).append(oi(t,!1))}(t),De("local",[Pn],Ee("local"))}function ni(){Yn.style.visibility="hidden"}function ii(t,e){e&&e.linked.length?function(t,e){var n=t+"#"+e.id,i=Un(n,e,[],function(){if(Qn||Rn)return!0;return!1}()),a=i.register,r={},s=[];const d=[];for(let[t,e]of Object.entries(i.instances)){var o=Vt(t,"/",!0).then((n=>{r[t]=[],e.length&&e.forEach((e=>{var i=n.srcData.index.indexOf(e);if(-1!==i){r[t].push(e);var s=Wt(n,e,i);Wn.push(si(s))}else a=!0,u("Linked thread could not be resolved",e)})),r[t].length||s.push(si(n))})).catch((()=>{a=!0,u("Linked source could not be resolved",t)}));d.push(o)}Promise.all(d).then((()=>{a&&pt(n+":linked",r,null,"linked"),s.length&&(Wn=Wn.concat(s)),Jn()}))}(t,e):Jn()}function ai(t=!1){var e=Bn.firstChild;e&&(t?de(e,"ease",200,(function(){e.remove()})):e.remove())}function ri(){if(Wn.length){var t=Wn[Xn.position];Bn.firstChild?ue(Bn.firstChild,t,200):le(Bn,t,!1,"ease",200,callb)}else ai(!0)}function si(t){var e=[Ye(t,!1),_e(t,!1)];"/"!==t.threadId&&e.push(Pe(t,!1),oi(Kn(t),!0));var n=ye("DIV");return n.append(...e),n}function di(t){var e="none"===Vn.style.display;t&&e?Vn.style.display="block":t||e||(Vn.style.display="none")}function oi(t,e=!1){var n=ye("DIV","nx-content"),i=null;e||(i=Jn);var a=!1;if(t){var r=[li(t),ci(t)];t.content.media&&t.content.media.url&&t.content.media.url.length&&(a=!0,r.push(On(t,i))),n.append(...r)}return a||null===i||i(),n}function ci(t){var e=ye("DIV","nx-content-body");return e.append(gi(t,["content","main"]),gi(t,["content","aside"])),e}function li(t){var e=ye("DIV","nx-content-meta"),n=gi(t,["content","timestamp"]);return e.append(n),e}function ui(t,e){var n=ye("DIV","nx-thread-header");return n.append(be(t,!0),function(t){return(_n=ye("DIV","nx-thread-description")).append(gi(t,["description"])),_n}(e)),n}function hi(t,e){return(kn=ye("DIV","nx-thread-blocks")).style.display="none",kn.append(ei(e),ti(t,e)),kn}function gi(t,e){var n=ye("DIV","nx-"+e.join("-"));return n.append(function(t,e=[]){if(t){for(var n=Object.assign({},t),i=0;i<e.length;i++)n=n[e[i]];if(M(n))return["description","main","aside","caption"].includes(e[e.length-1])&&(n=ze(n)),n}return""}(t,e)),n}function pi(t,e){Qn=e;var n=Kn(t),i=ye("DIV","nx-main-block nx-thread");Gn(),n&&Zn.startSpin();var a=[ui(t,n),Hn,hi(t.dataUrl,n)];return i.append(...a),Qt((function(t,e,n){Rn=n,$n(t)})),i}function Ii(t){return me(xe(),[Ne([(e=t.state,qe(e),De("history",[We(),Ve],!1))],[an(t.state),pi(t.state,t.editMode)],[yn(t.state,t.styleUrl,t.editMode)],"reader")]);var e}function Mi(){var t=ye("BUTTON","nx-add-link");return t.type="button",t.textContent="+",t}function vi(t,e,n){var i=!1;C[n][1]<=e.length&&(i=!0),t.disabled!==i&&(t.classList.toggle("nx-disabled"),t.disabled=i)}const fi={image:["jpg","jpeg","gif","svg","png","webp"],video:["mp4","webm"],audio:["mp3"]},xi=new CustomEvent("AutoUpdate"),yi=new CustomEvent("StateChange"),mi=new CustomEvent("ThreadChange"),Ni=new CustomEvent("IndexChange");function Di(t,e=!1){var n=t.classList.contains("nx-disabled");!e&&n?t.classList.remove("nx-disabled"):e&&!n&&t.classList.add("nx-disabled")}function Ei(t,e,n){if(-1!==t.indexOf(e))for(var i=0;i<t.length;i++)if(i!==n&&t[i]===e)return!1;return!0}function Ti(t,e,n){if(!Ei(t,e=f(e).trim().replace(/[^A-Za-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),n)){var i,a=e.split("-"),r=a.pop();for(isNaN(r)?(a.push(r),i=1):(i=parseInt(r),i++),e=a.join("-");t.includes(e+"-"+i);)i++;e+="-"+i}return e}function ji(t,e="nexus.json",n="/",i=-1){return{dataUrl:e,srcData:t,threadId:n,threadIndex:i}}function Ai(){var t,e,n=v(10);return{nexus:x,author:{handle:"Anonymous-"+(t=100,e=999,Math.floor(Math.random()*(e-t+1)+t)),about:"",url:"http://"},threads:[Si(n)],index:[n]}}function Si(t){return{id:t,title:t,description:"...",content:{timestamp:(new Date).toISOString().split("T")[0],main:"...",aside:"",media:{url:"",type:"",caption:""}},linked:[]}}class Ci{constructor(t){this.EditState=t,this._setMenu()}getMenuElms(){return this.menu}setLastAction(t,e=!1){this.resetting&&!e||(this.lastAction.act=t,this.actCtrls.count=2,this.actCtrls.position=1,je(this.actCtrls),this.toggleSaveBtn(!1))}setResetting(t){this.resetting=t}toggleSaveBtn(t=!1){Di(this.saveBtn,t)}_displayFeedback(t){var e=Bt(t);this.feedbackrun&&clearTimeout(this.feedbackrun),he(this.actionFdbck,e,25),this.feedbackrun=setTimeout(function(){he(this.actionFdbck,"",25)}.bind(this),1500+20*e.length)}_resetData(t,e){var n=this.EditState.getJsonState();null===t&&(t=Ai());var i=ji(t,e);i.srcData.threads.length&&(i.threadIndex=0,i.threadId=i.srcData.threads[0].id);var a=JSON.stringify(i),r=function(t){var e;this.resetting=!0,e=t?a:n,this.EditState.setNewState(e),this.menu.dispatchEvent(yi),this.filename=this.EditState.resolveFilename(),this.resetting=!1}.bind(this);r(!0),this.setLastAction(r,!0)}_setActionFeedback(){this.feedbackrun=null,this.actionFdbck=ye("SPAN","nx-action-feedback")}_setDownloadBtn(){this.filename="nexus.json",this.dlBtn=ye("A","nx-download"),this.dlBtn.append(Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjAuNTYyNSBMIDkuNzE4NzUgMTUuMjgxMjUgTCA4LjI4MTI1IDE2LjcxODc1IEwgMTUuMjgxMjUgMjMuNzE4NzUgTCAxNiAyNC40MDYyNSBMIDE2LjcxODc1IDIzLjcxODc1IEwgMjMuNzE4NzUgMTYuNzE4NzUgTCAyMi4yODEyNSAxNS4yODEyNSBMIDE3IDIwLjU2MjUgTCAxNyA0IFogTSA3IDI2IEwgNyAyOCBMIDI1IDI4IEwgMjUgMjYgWiIvPjwvc3ZnPg==",20)),this.dlBtn.addEventListener("click",function(){var t=Object.assign({},this.EditState.state.srcData);delete t.index,at(t)||this._displayFeedback("Invalid Nexus data"),t=JSON.stringify(t,void 0,2);var e="data:text/json;charset=utf-8,"+encodeURIComponent(t),n=ye("A");n.setAttribute("href",e),n.setAttribute("download","nexus.json"),document.body.appendChild(n),n.click(),n.remove()}.bind(this))}_setNewDocumenBtn(){this.newBtn=ye("A","nx-new"),this.newBtn.append(Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA2IDMgTCA2IDI5IEwgMjYgMjkgTCAyNiA5LjU5Mzc1IEwgMjUuNzE4NzUgOS4yODEyNSBMIDE5LjcxODc1IDMuMjgxMjUgTCAxOS40MDYyNSAzIFogTSA4IDUgTCAxOCA1IEwgMTggMTEgTCAyNCAxMSBMIDI0IDI3IEwgOCAyNyBaIE0gMjAgNi40Mzc1IEwgMjIuNTYyNSA5IEwgMjAgOSBaIi8+PC9zdmc+",20)),this.newBtn.addEventListener("click",function(){this._resetData(Ai(),"nexus.json")}.bind(this))}_setOpenBtn(){this._setFileInput(),this.openBtn=ye("A","nx-open-file"),this.openBtn.append(Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDMgTCA1IDI3LjgxMjUgTCA1Ljc4MTI1IDI3Ljk2ODc1IEwgMTcuNzgxMjUgMzAuNDY4NzUgTCAxOSAzMC43MTg3NSBMIDE5IDI4IEwgMjUgMjggTCAyNSAxNS40Mzc1IEwgMjYuNzE4NzUgMTMuNzE4NzUgTCAyNyAxMy40MDYyNSBMIDI3IDMgWiBNIDE0LjEyNSA1IEwgMjUgNSBMIDI1IDEyLjU2MjUgTCAyMy4yODEyNSAxNC4yODEyNSBMIDIzIDE0LjU5Mzc1IEwgMjMgMjYgTCAxOSAyNiBMIDE5IDE3LjA5Mzc1IEwgMTguNzE4NzUgMTYuNzgxMjUgTCAxNyAxNS4wNjI1IEwgMTcgNS43MTg3NSBaIE0gNyA1LjI4MTI1IEwgMTUgNy4yODEyNSBMIDE1IDE1LjkwNjI1IEwgMTUuMjgxMjUgMTYuMjE4NzUgTCAxNyAxNy45Mzc1IEwgMTcgMjguMjgxMjUgTCA3IDI2LjE4NzUgWiIvPjwvc3ZnPg==",20)),this.openBtn.addEventListener("click",function(){this.fileInput.click()}.bind(this)),this.openWrap=ye("SPAN"),this.openWrap.append(this.fileInput,this.openBtn)}_setFileInput(){this.fileInput=ye("INPUT"),this.fileInput.type="file",this.fileInput.accept="application/json",this.fileInput.addEventListener("change",function(t){var e=t.target.files[0].name;(function(t,e=!1){return t.target.files.length?"application/json"===t.target.files[0].type?new Promise(((n,i)=>{var a=new FileReader;return a.onload=function(t){var a=Dt(t.target.result,e);a?n(a):i(new Error(400))},a.readAsText(t.target.files[0])})):(u("Invalid file type",t.target.files[0]),Promise.reject(new Error(400))):(u("No file selected"),Promise.reject(new Error(400)))})(t,!0).then((t=>{t.index=Nt(t),this._resetData(t,e)})).catch((t=>{u(t.message),this._displayFeedback("Invalid source")})),this.fileInput.value=""}.bind(this)),this.fileInput.style.display="none"}_setSaveBtn(){this.saveBtn=ye("A","nx-save"),this.saveBtn.append(Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDUgTCA1IDI3IEwgMjcgMjcgTCAyNyA5LjU5Mzc1IEwgMjYuNzE4NzUgOS4yODEyNSBMIDIyLjcxODc1IDUuMjgxMjUgTCAyMi40MDYyNSA1IFogTSA3IDcgTCAxMCA3IEwgMTAgMTMgTCAyMiAxMyBMIDIyIDcuNDM3NSBMIDI1IDEwLjQzNzUgTCAyNSAyNSBMIDIzIDI1IEwgMjMgMTYgTCA5IDE2IEwgOSAyNSBMIDcgMjUgWiBNIDEyIDcgTCAxNiA3IEwgMTYgOSBMIDE4IDkgTCAxOCA3IEwgMjAgNyBMIDIwIDExIEwgMTIgMTEgWiBNIDExIDE4IEwgMjEgMTggTCAyMSAyNSBMIDExIDI1IFoiLz48L3N2Zz4=",20)),this.toggleSaveBtn(!0),this.saveBtn.addEventListener("click",function(){this.saveBtn.classList.contains("nx-disabled")||(ft(this.EditState.cacheName,this.EditState.state.srcData),this._displayFeedback("saved"),this.toggleSaveBtn(!0),this._setResetStatus())}.bind(this))}_setResetStatus(){var t=!0;this.EditState.originData!==JSON.stringify(this.EditState.state.srcData)&&(t=!1),Di(this.resetBtn,t)}_setResetBtn(){this.resetBtn=ye("A","nx-reset"),this.resetBtn.append(Oe("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiAzIEMgMTIgMyA4LjQgNC43OTkyMTg3IDYgNy42OTkyMTg4IEwgNiA0IEwgNCA0IEwgNCAxMiBMIDEyIDEyIEwgMTIgMTAgTCA2LjgwMDc4MTIgMTAgQyA4LjgwMDc4MTIgNyAxMi4xIDUgMTYgNSBDIDIyLjEgNSAyNyA5LjkgMjcgMTYgQyAyNyAyMi4xIDIyLjEgMjcgMTYgMjcgQyA5LjkgMjcgNSAyMi4xIDUgMTYgTCAzIDE2IEMgMyAyMy4yIDguOCAyOSAxNiAyOSBDIDIzLjIgMjkgMjkgMjMuMiAyOSAxNiBDIDI5IDguOCAyMy4yIDMgMTYgMyB6Ii8+PC9zdmc+",20)),this._setResetStatus(),this.resetBtn.addEventListener("click",function(){this.resetBtn.classList.contains("nx-disabled")||(this._resetData(JSON.parse(this.EditState.originData),this.EditState.originUrl),Di(this.resetBtn,!0))}.bind(this))}_setEditNav(){this._setActionFeedback(),this._setResetBtn(),this._setNewDocumenBtn(),this._setOpenBtn(),this._setSaveBtn(),this._setDownloadBtn(),this.editLinks=ye("DIV"),this.editLinks.append(this.resetBtn,this.newBtn,this.openWrap,this.saveBtn,this.dlBtn),this.editNav=ye("DIV","nx-edit-nav"),this.editNav.append(this.actionFdbck,this.editLinks)}_setEditActions(){this.resetting=!1,this.lastAction={act:null},this.actCtrls={ctrls:{prev:{symbol:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxMi43ODEyNSA1LjI4MTI1IEwgNC43ODEyNSAxMy4yODEyNSBMIDQuMDkzNzUgMTQgTCA0Ljc4MTI1IDE0LjcxODc1IEwgMTIuNzgxMjUgMjIuNzE4NzUgTCAxNC4yMTg3NSAyMS4yODEyNSBMIDcuOTM3NSAxNSBMIDIxIDE1IEMgMjMuNzUzOTA2IDE1IDI2IDE3LjI0NjA5NCAyNiAyMCBMIDI2IDI3IEwgMjggMjcgTCAyOCAyMCBDIDI4IDE2LjE1NjI1IDI0Ljg0Mzc1IDEzIDIxIDEzIEwgNy45Mzc1IDEzIEwgMTQuMjE4NzUgNi43MTg3NSBaIi8+PC9zdmc+",elm:null},next:{symbol:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxOS4yMTg3NSA1LjI4MTI1IEwgMTcuNzgxMjUgNi43MTg3NSBMIDI0LjA2MjUgMTMgTCAxMSAxMyBDIDcuMTU2MjUgMTMgNCAxNi4xNTYyNSA0IDIwIEwgNCAyNyBMIDYgMjcgTCA2IDIwIEMgNiAxNy4yNDYwOTQgOC4yNDYwOTQgMTUgMTEgMTUgTCAyNC4wNjI1IDE1IEwgMTcuNzgxMjUgMjEuMjgxMjUgTCAxOS4yMTg3NSAyMi43MTg3NSBMIDI3LjIxODc1IDE0LjcxODc1IEwgMjcuOTA2MjUgMTQgTCAyNy4yMTg3NSAxMy4yODEyNSBaIi8+PC9zdmc+",elm:null}},position:0,count:1},this.editActions=ye("DIV","nx-edit-actions nx-history-nav"),Ae(this.actCtrls,this._triggerUndoRedo.bind(this),!0),this.editActions.append(this.actCtrls.ctrls.prev.elm,this.actCtrls.ctrls.next.elm)}_triggerUndoRedo(t){this.lastAction.act("next"===t),this.toggleSaveBtn(!1)}_setMenu(){this._setEditNav(),this._setEditActions(),this.menu=ye("DIV","nx-edit-menu"),this.menu.append(this.editNav,this.editActions)}}class Li{constructor(t,e){this.EditState=t,this.EditMenu=e}inputElm(t,e=null,n=null){var i=this._fieldIdents(t),a=this._resolveInput(i,t),r=this._baseLabel(i.alias),s=ye("SPAN","nx-edit-indication"),d=this._invalidSp();r.append(s,d),this._setConditions(i,a,s),n&&(n[i.field]=a);var o=this._wrapInput(i,a,r);return this._setInputEvt(t,a,d,e),this._inputEvtHandler(t,a,d,e),o}_setConditions(t,e,n){switch(t.field){case"url":case"linked":n.textContent="[http]",e.pattern=w;break;case"id":n.textContent="[A-Za-z0-9-][3-36]",e.pattern=O;break;case"type":e.pattern="("+b.join("|")+")";break;case"timestamp":break;default:var i=S[t.field];n.textContent="["+i[0]+"-"+i[1]+"]",e.setAttribute("maxlength",i[1]),e.setAttribute("minlength",i[0])}}_wrapInput(t,e,n){var i=ye("DIV","nx-edit-input nx-edit-"+t.parent+"-"+t.field);return i.append(n),"type"===t.field?i.append(this._typeDropDown(e)):i.append(e),i}_typeDropDown(t){return Se(b,t,null,"nx-edit-media-type-select")}_fieldIdents(t){var e={},n=t.length-1;return"linked"===t[n-1]&&n--,e.field=t[n],"threads"===t[--n-1]&&n--,e.parent=t[n],e.alias=e.field,"linked"===e.field&&(e.alias="url"),e}_isLongTextInput(t){return["about","description","main","aside","caption"].includes(t.field)}_isRequired(t){return["handle","title","main","id","url","type","timestamp","linked"].includes(t.field)}_resolveInput(t,e){var n,i=this.EditState.getValue(e);(n=this._isLongTextInput(t)?this._textareaInput(i):"timestamp"==t.field?this._dateInput(i):this._textInput(i)).classList.add("nx-edit-input");var a=e.join("-");return n.id=a,n.name=a,this._isRequired(t)&&(n.required=!0),n}_textInput(t){var e=ye("INPUT","nx-edit-text");return e.type="text",e.value=t,e}_textareaInput(t){var e=ye("TEXTAREA","nx-edit-textarea");return e.textContent=t,e}_dateInput(t){var e=ye("INPUT","nx-edit-date");return e.type="datetime-local",e.value=t,e}_baseLabel(t){var e=ye("LABEL","nx-edit-label");e.for=t;var n=ye("SPAN","nx-edit-title");return n.textContent=Bt(t),Ie(n,t),e.append(n),e}_invalidSp(){var t=ye("SPAN","nx-edit-feedback");return t.append(Oe(on)),t}_inputEvtHandler(t,e,n,i){var a=e.checkValidity(),r=null;if(a&&t.includes("url")||t.includes("linked"))(a=$(e.value))&&t.includes("linked")&&(a=Ei(this.EditState.getLinkedUrls(t[1]),e.value,this.EditState.getLinkedThreadIdx(t[1],t[3])))&&(r=Et(e.value).then((()=>!0)).catch((()=>!1)));else if(t.includes("id")){var s=Ti(this.EditState.getIdsList(),e.value,this.EditState.getThreadIdx(t[1]));s!==e.value&&(e.value=s),a=!0}null===r&&(r=Promise.resolve(a)),r.then((a=>{this.EditState.setNewValue(t,e.value),this._setFeedbackIcon(n,a),"function"==typeof i&&i(e,a)}))}_setFeedbackIcon(t,e){var n=on;e&&(n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyOC4yODEyNSA2LjI4MTI1IEwgMTEgMjMuNTYyNSBMIDMuNzE4NzUgMTYuMjgxMjUgTCAyLjI4MTI1IDE3LjcxODc1IEwgMTAuMjgxMjUgMjUuNzE4NzUgTCAxMSAyNi40MDYyNSBMIDExLjcxODc1IDI1LjcxODc1IEwgMjkuNzE4NzUgNy43MTg3NSBaIi8+PC9zdmc+"),t.firstChild.src=n}_setInputEvt(t,e,n,i){var a="",r=e.value;e.addEventListener("focus",(function(){r=e.value})),e.addEventListener("AutoUpdate",function(){this._inputEvtHandler(t,e,n,i)}.bind(this)),e.addEventListener("change",function(){this._inputEvtHandler(t,e,n,i);var s=function(s){s?e.value=a:(a=e.value,e.value=r),this._inputEvtHandler(t,e,n,i)}.bind(this);this.EditMenu.setLastAction(s)}.bind(this))}}class bi{constructor(t){this.InputsFactory=t}newThreadLocalForm(t,e){var n=ye("FORM","nx-thread-local-form"),i=this._localFieldSet1(t,e),a=this._localFieldSet2(t),r=this._localFieldSet3(t);return n.append(Ee("local thread"),i,Ee("content"),a,Ee("media"),r),n}_localFieldSet1(t,e){var n=ye("FIELDSET");return n.append(this.InputsFactory.inputElm(["threads",t,"id"])),n.append(this.InputsFactory.inputElm(["threads",t,"title"],(function(t){var n=e.querySelector(".nx-thread-title");n.textContent!==t.value&&(n.textContent=t.value)}))),n.append(this.InputsFactory.inputElm(["threads",t,"description"])),n}_localFieldSet2(t){var e=ye("FIELDSET");return["timestamp","main","aside"].forEach((n=>{e.append(this.InputsFactory.inputElm(["threads",t,"content",n]))})),e}_localFieldSet3(t){var e=ye("FIELDSET"),n={type:null},i=this.InputsFactory.inputElm(["threads",t,"content","media","type"],null,n),a=function(t,e){if(e){var a=function(t){for(var e=0;e<L.length;e++)if(t.includes(L[e]))return L[e];var n=t.split(".").pop();for(let[t,e]of Object.entries(fi))if(e.includes(n))return t;return"page"}(t.value);if(n.type.value!==a){n.type.value=a;var r=i.querySelector(".nx-selected");r&&r.classList.remove("nx-selected"),i.querySelector("[data-item="+a+"]").classList.add("nx-selected"),n.type.dispatchEvent(xi)}}}.bind(this);return e.append(this.InputsFactory.inputElm(["threads",t,"content","media","url"],a)),e.append(i),e.append(this.InputsFactory.inputElm(["threads",t,"content","media","caption"])),e}}class zi{constructor(t){this.EditState=t,this._setContainers(),this._setBtnSrc(),this._setMenu(),this._setFactories(),this._setAddThreadBtn(),this._setFormsInputs(),this._setFormBlocks(),this._setServiceElms()}getInstanceElms(){return this.instanceElms}_setBtnSrc(){this.btnSrc={up:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA0LjA5Mzc1IEwgMTUuMjgxMjUgNC43ODEyNSBMIDYuNzgxMjUgMTMuMjgxMjUgTCA4LjIxODc1IDE0LjcxODc1IEwgMTUgNy45Mzc1IEwgMTUgMjggTCAxNyAyOCBMIDE3IDcuOTM3NSBMIDIzLjc4MTI1IDE0LjcxODc1IEwgMjUuMjE4NzUgMTMuMjgxMjUgTCAxNi43MTg3NSA0Ljc4MTI1IFoiLz48L3N2Zz4=",down:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjQuMDYyNSBMIDguMjE4NzUgMTcuMjgxMjUgTCA2Ljc4MTI1IDE4LjcxODc1IEwgMTUuMjgxMjUgMjcuMjE4NzUgTCAxNiAyNy45MDYyNSBMIDE2LjcxODc1IDI3LjIxODc1IEwgMjUuMjE4NzUgMTguNzE4NzUgTCAyMy43ODEyNSAxNy4yODEyNSBMIDE3IDI0LjA2MjUgTCAxNyA0IFoiLz48L3N2Zz4="}}_setContainers(){this.containers={author:ye("FORM","nx-edit-author"),index:ye("UL","nx-edit-index"),local:ye("UL","nx-edit-local"),distant:ye("UL","nx-edit-distant")}}_setMenu(){this.EditMenu=new Ci(this.EditState),this.menu=this.EditMenu.getMenuElms(),this.menu.addEventListener("StateChange",this._resetFormCallback.bind(this))}_setFactories(){this.InputsFactory=new Li(this.EditState,this.EditMenu),this.LocalFormFactory=new bi(this.InputsFactory)}_setAddThreadBtn(){this.addThreadBtn=Mi(),vi(this.addThreadBtn,this.EditState.getIdsList(),"threads"),this.addThreadBtn.addEventListener("click",this._addThreadHandler.bind(this))}_setServiceElms(){var t=ye("DIV","nx-main-block nx-index");t.append(this.formBlocks.author,this.formBlocks.index);var e,n=ye("DIV","nx-main-block nx-thread");n.append(this.formBlocks.local,this.formBlocks.distant),this.instanceElms=me(((e=xe()).append(fe()),e),[Ne([this.menu],[t,n],[],"edit")])}_setFormBlocks(){this.formBlocks={author:De("author",[this.containers.author],Ee("author")),index:De("threads-list",[this.containers.index,this.addThreadBtn],Ee("threads")),local:De("local",[this.containers.local],!1),distant:De("distant",[this.containers.distant],!1)}}_resetFormCallback(){Object.values(this.containers).forEach(((t,e)=>{var n=Array.from(t.childNodes),i=3===e,a=n.length-1;n.forEach(((t,e)=>{de(t,"fade",200,function(){t.remove(),i&&e===a&&this._setFormsInputs()}.bind(this))}))}))}_setFormsInputs(){this._setAuthorInputs(),this._setThreadsInputs()}_setAuthorInputs(){["handle","url","about"].forEach((t=>{var e=this.InputsFactory.inputElm(["author",t]);e.style.display="none",this.containers.author.append(e),oe(e,"fade",200)}))}_setThreadsInputs(){var t=this.EditState.getIdsList();if(t.length)for(var e=!1,n=0;n<t.length;n++)n===t.length-1&&(e=!0),this._setThread(t[n],n,e)}_setThread(t,e,n=!1){var i=this.EditState.newIdent(t,e),a=this._newThreadLis(i);for(let[t,i]of Object.entries(a)){if("none"!==i.style.display){i.style.display="none";var r="ease";"local"===t&&(r="fade"),le(this.containers[t],i,!1,r,200)}else this.containers[t].append(i);n&&"index"===t&&e-1!=-1&&this.containers.index.childNodes[e-1].dispatchEvent(Ni)}}_newThreadLis(t){var e={};return e.distant=this._threadLi(t),e.local=this._threadLi(t),e.index=this._indexLi(t),e.distant.append(this._threadDistantForm(t)),e.local.append(this.LocalFormFactory.newThreadLocalForm(t,e.index)),this._setdeleteThreadElm(e,t),e}_addThreadHandler(){if(!this.addThreadBtn.disabled){var t=v(10),e=this.EditState.getThreadsCount();this.EditState.pushThread(Si(t)),this._setThread(t,e,!0),this.EditMenu.toggleSaveBtn(!1),vi(this.addThreadBtn,this.EditState.getIdsList(),"threads")}}_linkInput(t,e,n,i){var a=this.EditState.registerLinkedThread(n,i),r=ye("DIV","nx-edit-distant-link"),s={linked:null},d=this.InputsFactory.inputElm(["threads",n,"linked",a],null,s),o=this._baseDeleteLinkBtn(),c=ye("DIV","nx-distant-link-action");return c.append(o),o.addEventListener("click",(()=>{var i=function(i){var d=this.EditState.getLinkedUrls(n);if(i)de(r,"ease",200,(function(){r.remove()})),this.EditState.removeLinkedThread(n,a);else{var o=this.EditState.getLinkedThreadIdx(n,a),c=o===d.length;if(this.EditState.insertLinkedThread(n,a,s.linked.value),c)le(e,r,!1,"ease",200);else{var l=e.childNodes[o];e.insertBefore(r,l),oe(r,"ease",200)}}vi(t,d,"linked")}.bind(this);this.EditMenu.setLastAction(i),i(!0)})),r.append(d,c),r}_threadDistantForm(t){var e=ye("FORM","nx-thread-distant-form"),n=Mi();vi(n,this.EditState.getLinkedUrls(t),"linked"),n.addEventListener("click",(()=>{n.disabled||(this.EditState.pushLinkedThread(t,""),le(e,this._linkInput(n,e,t,this.EditState.getLinkedUrlsCount(t)-1),!1,"ease",200),vi(n,this.EditState.getLinkedUrls(t),"linked"))}));var i=this.EditState.getLinkedUrlsCount(t);if(i){for(var a=[],r=0;r<i;r++){var s=this._linkInput(n,e,t,r);a.push(s)}e.append(...a)}var d=ye("DIV");return d.append(Ee("linked threads"),e,n),d}_threadLi(t){var e=ye("LI");return this.EditState.isCurrentId(t)||(e.style.display="none"),e.addEventListener("ThreadChange",function(){this.EditState.isCurrentId(t)?setTimeout((function(){oe(e,"ease",200)}),200):de(e,"ease",200)}.bind(this)),e}_setdeleteThreadElm(t,e){var n=ye("BUTTON","nx-delete-thread");n.type="button",n.textContent="-",n.addEventListener("click",function(){this._deleteEvent(t,e)}.bind(this)),t.index.append(n)}_deleteEvent(t,e){var n=Object.assign({},this.EditState.getThreadData(e)),i=function(i){var a=this.EditState.getThreadIdx(e),r=this.EditState.getThreadsCount();if(i){if(this.EditState.removeThread(e),Object.values(t).forEach((t=>{de(t,"ease",200,(function(){t.remove()}))})),r>1){var s=null;0===a?s=t.index.nextSibling:a===r-1&&(s=t.index.previousSibling),s&&s.dispatchEvent(Ni)}this.EditState.isCurrentId(e)&&(t.distant.dispatchEvent(mi),t.local.dispatchEvent(mi))}else{if(this.EditState.insertThread(e,n),a<=r-1){var d=this.containers.index.childNodes[a];this.containers.index.insertBefore(t.index,d),0===a&&d.dispatchEvent(Ni)}else this.containers.index.append(t.index),r>1&&t.index.previousSibling.dispatchEvent(Ni);this.containers.local.append(t.local),this.containers.distant.append(t.distant),oe(t.index,"ease",200),t.index.firstChild.click()}vi(this.addThreadBtn,this.EditState.getIdsList(),"threads")}.bind(this);this.EditMenu.setLastAction(i),i(!0)}_indexLi(t){var e=ye("LI");return e.dataset.ident=t,e.append(this._indexLink(t)),this._setMoveBtns(e,t),e}_indexLink(t){var e=Le(this.EditState.getAltEditState(t),!1);return this.EditState.isCurrentId(t)&&e.classList.add("nx-on-display"),e.addEventListener("click",(()=>{if(!this.EditState.isCurrentId(t)){this.EditState.changeCurrentThread(t);var n=this.containers.index.querySelector(".nx-on-display");n&&n.classList.remove("nx-on-display"),e.classList.add("nx-on-display"),this.containers.local.childNodes.forEach((t=>{t.dispatchEvent(mi)})),this.containers.distant.childNodes.forEach((t=>{t.dispatchEvent(mi)}))}})),e}_toggleActiveBtn(t,e){this.EditState.isFirstThread(t)?Di(e.up,!0):Di(e.up,!1),this.EditState.isLastThread(t)?Di(e.down,!0):Di(e.down,!1)}_permuteThread(t,e){this.containers.index.removeChild(t),this.containers.index.insertBefore(t,e),e.dispatchEvent(Ni),t.dispatchEvent(Ni)}_moveItemHandler(t,e,n){var i=function(i){var a,r="up"==e;i||(r=!r),r&&!this.EditState.isFirstThread(n)?(a=t.previousSibling,this.EditState.moveThread(n,a.dataset.ident,!0),this._permuteThread(t,a)):r||this.EditState.isLastThread(n)||(a=t.nextSibling,this.EditState.moveThread(n,a.dataset.ident,!1),this._permuteThread(a,t))}.bind(this);this.EditMenu.setLastAction(i),i(!0)}_setMoveBtns(t,e){var n=ye("DIV","nx-edit-move"),i={up:null,down:null};t.addEventListener("IndexChange",function(){this._toggleActiveBtn(e,i)}.bind(this)),Object.keys(i).forEach((a=>{i[a]=ye("A","nx-edit-move-"+a),i[a].append(Oe(this.btnSrc[a],16)),n.append(i[a]),i[a].addEventListener("click",function(){this._moveItemHandler(t,a,e)}.bind(this))})),this._toggleActiveBtn(e,i),t.append(n)}_baseDeleteLinkBtn(){var t=ye("BUTTON","nx-delete-link");return t.type="button",t.textContent="-",t}}class Oi{constructor(t,e,n){this.editInst=t,this.readerInst=e,this.readerUpdatePromise=n,this.previewOn=!1,this._setSwitchBtn()}getSwitchBtn(){return this.switchBtn}_instanceSwitch(){this.previewOn=!this.previewOn,this.previewOn?de(this.editInst,"fade",200,function(){this.readerUpdatePromise().then((()=>{this.switchBtn.firstChild.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyMy45MDYyNSAzLjk2ODc1IEMgMjIuODU5Mzc1IDMuOTY4NzUgMjEuODEyNSA0LjM3NSAyMSA1LjE4NzUgTCA1LjE4NzUgMjEgTCA1LjEyNSAyMS4zMTI1IEwgNC4wMzEyNSAyNi44MTI1IEwgMy43MTg3NSAyOC4yODEyNSBMIDUuMTg3NSAyNy45Njg3NSBMIDEwLjY4NzUgMjYuODc1IEwgMTEgMjYuODEyNSBMIDI2LjgxMjUgMTEgQyAyOC40Mzc1IDkuMzc1IDI4LjQzNzUgNi44MTI1IDI2LjgxMjUgNS4xODc1IEMgMjYgNC4zNzUgMjQuOTUzMTI1IDMuOTY4NzUgMjMuOTA2MjUgMy45Njg3NSBaIE0gMjMuOTA2MjUgNS44NzUgQyAyNC40MTAxNTYgNS44NzUgMjQuOTE3OTY5IDYuMTA1NDY5IDI1LjQwNjI1IDYuNTkzNzUgQyAyNi4zNzg5MDYgNy41NjY0MDYgMjYuMzc4OTA2IDguNjIxMDk0IDI1LjQwNjI1IDkuNTkzNzUgTCAyNC42ODc1IDEwLjI4MTI1IEwgMjEuNzE4NzUgNy4zMTI1IEwgMjIuNDA2MjUgNi41OTM3NSBDIDIyLjg5NDUzMSA2LjEwNTQ2OSAyMy40MDIzNDQgNS44NzUgMjMuOTA2MjUgNS44NzUgWiBNIDIwLjMxMjUgOC43MTg3NSBMIDIzLjI4MTI1IDExLjY4NzUgTCAxMS4xODc1IDIzLjc4MTI1IEMgMTAuNTMxMjUgMjIuNSA5LjUgMjEuNDY4NzUgOC4yMTg3NSAyMC44MTI1IFogTSA2LjkzNzUgMjIuNDM3NSBDIDguMTM2NzE5IDIyLjkyMTg3NSA5LjA3ODEyNSAyMy44NjMyODEgOS41NjI1IDI1LjA2MjUgTCA2LjI4MTI1IDI1LjcxODc1IFoiLz48L3N2Zz4=",oe(this.readerInst,"fade",200)}))}.bind(this)):de(this.readerInst,"fade",200,function(){this.switchBtn.firstChild.src=dn,oe(this.editInst,"fade",200)}.bind(this))}_setSwitchBtn(){this.switchBtn=ye("A","nx-edit-switch"),this.switchBtn.append(Oe(dn,25)),this.switchBtn.addEventListener("click",this._instanceSwitch.bind(this))}}class wi{constructor(t){var e="new",n="nexus.json",i=!1;P("edit")&&(e="current",t&&(t.dataUrl&&(n=t.dataUrl),t.srcData&&(i=!0))),this.cacheName=e+"#"+n,this.originUrl=n;var a=function(t){return It(vt+t,"local")}(this.cacheName),r=!1;null===a&&(r=!0,a=i?t.srcData:Ai()),a.index||(r=!0,a.index=Nt(a)),r&&ft(this.cacheName,a);var s=a;i&&(s=t.srcData),this.originData=JSON.stringify(s);var d="/",o=-1;i&&"/"!==t.threadId&&a.index.includes(t.threadId)?(d=t.threadId,o=a.index.indexOf(t.threadId)):a.threads.length&&(d=a.threads[0].id,o=0),this.state=ji(a,n,d,o),this.threadsMap={}}getState(){return this.state}getOriginData(){return this.originData}getJsonState(){return JSON.stringify(this.state)}getAltEditState(t){return Wt(this.state,this.getThreadId(t),this.getThreadIdx(t))}setNewState(t){this.state=Object.assign({},JSON.parse(t))}setAuthorValue(t,e){this.state.srcData.author||(this.state.srcData.author={}),this.state.srcData.author[t[1]]=e}setThreadIndex(t){if(this.state.srcData.threads){var e=this.getThreadIdx(t);void 0===this.state.srcData.threads[e]&&(this.state.srcData.threads[e]={})}else this.state.srcData.threads=[]}setThreadId(t,e){this.threadsMap[t[1]].id=e;var n=this.getThreadIdx(t[1]);this.state.srcData.index[n]=e,this.state.srcData.threads[n].id=e}setThreadInfo(t,e){var n=this.getThreadIdx(t[1]);this.state.srcData.threads[n][t[2]]=e}setContentValue(t,e){var n=this.getThreadIdx(t[1]);this.state.srcData.threads[n].content||(this.state.srcData.threads[n].content={}),"media"===t[3]?(this.state.srcData.threads[n].content.media||(this.state.srcData.threads[n].content.media={}),this.state.srcData.threads[n].content.media[t[4]]=e):this.state.srcData.threads[n].content[t[3]]=e}setLinkedValue(t,e){var n=this.getThreadIdx(t[1]);if(this.state.srcData.threads[n].linked){var i=this.getLinkedThreadIdx(t[1],t[3]);this.state.srcData.threads[n].linked[i]=e}else this.state.srcData.threads[n].linked=[e]}setNewValue(t,e){return null===this.state.srcData&&(this.state.srcData={},this.state.srcData.index=[]),"author"===t[0]?this.setAuthorValue(t,e):(this.setThreadIndex(t[1]),"id"===t[2]?this.setThreadId(t,e):["linked","content"].includes(t[2])?"content"===t[2]?this.setContentValue(t,e):void this.setLinkedValue(t,e):this.setThreadInfo(t,e))}getValue(t){if(this.state.srcData){if("author"===t[0])return this.state.srcData.author[t[1]];var e=this.getThreadIdx(t[1]);if(!["linked","content"].includes(t[2]))return this.state.srcData.threads[e][t[2]];if("content"===t[2])return"media"!==t[3]?this.state.srcData.threads[e].content[t[3]]:this.state.srcData.threads[e].content.media[t[4]];var n=this.getLinkedThreadIdx(t[1],t[3]);return this.state.srcData.threads[e].linked[n]}return""}getThreadId(t){return this.threadsMap[t].id}getThreadIdx(t){var e=this.threadsMap[t].idx,n=this.getThreadsCount();return e>=n&&(e=n-1,this.threadsMap[t].idx=e,this.isCurrentId(t)&&(this.state.threadIndex=e)),e}getIdsList(){return this.state.srcData.index}getThreadsCount(){return this.state.srcData.index.length}getCurrentThreadId(){return this.state.threadId}getCurrentThreadIdx(){return this.state.threadIndex}isCurrentId(t){return this.threadsMap[t].id===this.state.threadId}resolveFilename(){var t="nexus.json";if(this.state.dataUrl&&this.state.dataUrl!==t){var e=this.state.dataUrl.split("/").filter((t=>t));e.length&&(".json"!==(t=e.pop()).slice(-5)&&(t+=".json"),t=f(t))}return t}unsetCurrentThread(){this.state.threadId="/",this.state.threadIndex=-1}isFirstThread(t){return 0===this.getThreadIdx(t)}isLastThread(t){return this.getThreadIdx(t)+1===this.getThreadsCount()}getThreadData(t){var e=this.getThreadIdx(t),n=this.state.srcData.threads[e];return n||(this.state.srcData.threads[e]={}),n}removeThread(t){var e=this.getThreadIdx(t);if(this.state.srcData.index.splice(e,1),this.state.srcData.threads.splice(e,1),!this.isLastThread(t))for(let[t,n]of Object.entries(this.threadsMap))n.idx>e&&(this.threadsMap[t].idx=n.idx-1);this.isCurrentId(t)?this.unsetCurrentThread():this.state.threadIndex>e&&this.state.threadIndex--}insertThread(t,e){if(this.isLastThread(t))this.pushThread(e);else{var n=this.getThreadIdx(t);this.state.srcData.index.splice(n,0,e.id),this.state.srcData.threads.splice(n,0,e);for(let[t,i]of Object.entries(this.threadsMap))i.id!==e.id&&i.idx>=n&&(this.threadsMap[t].idx=i.idx+1);this.state.threadIndex>=n&&this.state.threadIndex++}}newIdent(t,e){var n=v(21);return this.threadsMap[n]={id:t,idx:e,linked:{}},n}changeCurrentThread(t){this.state.threadId=this.getThreadId(t),this.state.threadIndex=this.getThreadIdx(t)}moveThread(t,e,n=!1){var i=this.getThreadIdx(t),a=i+1;n&&(a=i-1),this.state.srcData.index.splice(a,0,this.state.srcData.index.splice(i,1)[0]),this.state.srcData.threads.splice(a,0,this.state.srcData.threads.splice(i,1)[0]),this.threadsMap[t].idx=a,this.threadsMap[e].idx=i,this.isCurrentId(t)?this.state.threadIndex=a:this.isCurrentId(e)&&(this.state.threadIndex=i)}pushThread(t){this.state.srcData.threads.push(t),this.state.srcData.index.push(t.id)}getLinkedThreadIdx(t,e){var n=this.threadsMap[t].linked[e].idx,i=this.getLinkedUrlsCount(t);return n>=i&&(n=i-1,this.threadsMap[t].linked[e].idx=n),n}getLinkedUrls(t){var e=this.getThreadData(t);if(!Object.prototype.hasOwnProperty.call(e,"linked")){var n=this.getThreadIdx(t);return this.state.srcData.threads[n].linked=[],[]}return e.linked}getLinkedUrlsCount(t){return this.getLinkedUrls(t).length}registerLinkedThread(t,e){var n=v(21);return this.threadsMap[t].linked[n]={idx:e},n}isLastLinkedThread(t,e){return this.getLinkedThreadIdx(t,e)===this.getLinkedUrlsCount(t)-1}removeLinkedThread(t,e){var n=this.getThreadIdx(t),i=this.getLinkedThreadIdx(t,e);if(i===this.getLinkedUrlsCount(t)-1)this.state.srcData.threads[n].linked.pop();else{this.state.srcData.threads[n].linked.splice(i,1);for(let[e,n]of Object.entries(this.threadsMap[t].linked))n.idx>i&&(this.threadsMap[t].linked[e].idx=n.idx-1)}}pushLinkedThread(t,e){var n=this.getThreadIdx(t);this.state.srcData.threads[n].linked||(this.state.srcData.threads[n].linked=[]),this.state.srcData.threads[n].linked.push(e)}insertLinkedThread(t,e,n){if(this.isLastLinkedThread(t,e))this.pushLinkedThread(t,n);else{var i=this.getThreadIdx(t),a=this.getLinkedThreadIdx(t,e);this.state.srcData.threads[i].linked.splice(a,0,n);for(let[n,i]of Object.entries(this.threadsMap[t].linked))i.idx>=a&&n!==e&&(this.threadsMap[t].linked[n].idx=i.idx+1)}}}function Ui(t,e){var n=document.createElement("DIV");return n.className="nx",n.append(e),t.append(n),n}function ki(t,e){de(t,"ease",200,(function(){t.textContent="",t.append(e),oe(t,"ease",200)}))}function Bi(){var t=Te();t.classList.add("nx-instance"),Ct({appDefaultLang:"en",appDefaultCss:rn,appDefaultCssAliases:sn}).then((e=>{var n,i,a;n=e.request.lang,zt||Ut(n),e.state=Zt(e.request.url,e.request.id,e.nxdata),i=e.state,!_t.dataUrl&&(_t=i),e.editMode=!1,P("edit")||P("new")?(e.editMode=!0,a=function(t){var e=new wi(t.state),n=new zi(e).getInstanceElms(),i=Ii({editMode:!0,state:Object.assign({},e.getState())});i.style.display="none";var a=new Oi(n,i,(function(){return Rt(e.state,!0,!0),new Promise((function(t){setTimeout(t,100)}))})).getSwitchBtn(),r=ye("DIV","nx-editor");return r.append(n,i,a),r}(e)):a=Ii(e);var r=Ui(e.nxelm,a),s=!0;e.nxelm.addEventListener("change",(function(){if(e.nxelm.dataset.srcdoc){var n=Dt(e.nxelm.dataset.srcdoc,"editor"===e.request.mode);n?(e.nxdata=n,e.state=Zt(e.request.url,e.request.id,e.nxdata),Rt(e.state,!0,!0),s||(s=!0,ki(r,a))):s&&(s=!1,ki(r,t))}}))})).catch((e=>{u(e.message),Ui(St(),t)}))}}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},Promise.resolve().then(n.bind(n,898)).then((t=>{t.init()}))})();