/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */(()=>{var t={898:(t,e,n)=>{"use strict";function i(t){let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}function a(t){return fetch(t).then((t=>t.json()))}function r(t){return t.split(/[\\/]/).pop()}function s(t,e){if(document.styleSheets.length)for(var n=r(e),i=0;i<document.styleSheets.length;i++){var a=document.styleSheets[i].href;if(a){if(a===e||r(a)===n)return!0;if(a.startsWith(window.location.origin)&&Object.prototype.hasOwnProperty.call(document.styleSheets[i],"cssRules")){var s=document.styleSheets[i].cssRules;for(let e=0;e<s.length;e++)if(s[e].selectorText===t)return!0}}}return!1}function d(t){return t.replace(/^(https?:\/\/)?/,"")}function o(t,e=!0){var n=d(t).split("/");if(n[n.length-1]||n.pop(),t=n[0],e&&n.length>1){n.length>2&&(t+="/...");var i=n.pop();i.length>18&&(i="..."+i.substring(-15)),t+="/"+i}return t}n.r(e),n.d(e,{init:()=>Oi});
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var c=[],l=!1;function u(t,e=null){var n={msg:t};e&&(n.detail=e),c.push(n),l&&console.log("Nexus/Error: "+JSON.stringify(n))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const h="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css",g=".nx-instance",p="#Nexus";
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function I(t=null,e=null,n=null){return t||(t=h),e||(e=g),n||t===h||(n=h),function(t,e,n=null){return n||!s(t,e)?new Promise(((t,i)=>{var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.onload=t,a.onerror=i,a.href=e,n?n.append(a):document.head.append(a)})):Promise.resolve(!0)}(e,t).then((()=>Promise.resolve(t))).catch((t=>(u("Theme not found",t.message),n?I(n):Promise.reject(new Error(404)))))}function M(t){return("string"==typeof t||t instanceof String)&&t.length}function v(t=10){var e=1;t>10&&(e+=Math.ceil(t/10));for(var n="",i=0;i<e;i++)n+=Math.random().toString(36).substring(2,10);return n.substring(0,t)}function f(t){if(""===t||0===t.length)return"";for(var e={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ă:"a",ą:"a",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",ð:"e",ę:"e",Ç:"C",ç:"c",ć:"c",č:"c",Ð:"D",đ:"d",ğ:"g",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ł:"L",ł:"l",Ñ:"N",ñ:"n",ń:"n",Š:"S",š:"s",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ÿ:"Y",ÿ:"y",ý:"y",Ž:"Z",ž:"z",Ż:"Z",ż:"z",ɶ:"oe",Œ:"OE",æ:"ae",Æ:"AE",ß:"ss"},n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],r=e[a];t=t.replace(a,r)}return t}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const x="https://nexus-dock.github.io/",y={nxdata:"Object",nexus:"String",author:"Object",handle:"String",about:"String",url:"String",threads:"Array","threads.item":"Object",id:"String",title:"String",description:"String",content:"Object",timestamp:"String",main:"String",aside:"String",media:"Object",type:"String",caption:"String",linked:"Array","linked.item":"String"},m="---",N="http://...",D="---",E="---",T="0000-00-00",j="...",A="page",S={handle:[3,30],about:[0,400],title:[3,30],description:[0,400],main:[1,1e3],aside:[0,400],caption:[0,200]},C={threads:[1,100],linked:[0,100]},L=["youtube","vimeo","soundcloud"],b=["page","video","image","audio"].concat(L),z="^[a-zA-Z0-9-]{3,36}$",O="^https?://.*",w=window.location.href,U=((k=w).lastIndexOf("/")<8&&"http"===k.substring(0,4)&&(k+="/"),k.substring(0,k.lastIndexOf("/")+1));var k;const B=new URLSearchParams(window.location.search.slice(1));function _(t){return B.has(t)}function P(t){return t.length&&"http"!==t.substring(0,4)?U+t.replace(/^\.?\/?/,""):t}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function Y(t){return Object.prototype.hasOwnProperty.call(S,t)?S[t]:(u("Unknown characters limits category",t),!1)}function F(t){return Object.prototype.hasOwnProperty.call(C,t)?C[t]:(u("Unknown items limits category",t),!1)}function H(t,e,n=!0){return(t.length||n)&&(!function(t,e){var n=Y(e);if(!1!==n){if(t.length>=n[0])return!0;u("Invalid min length",e)}return!1}(t,e)?t=function(t,e){var n=Y(e);if(!1!==n){var i=n[0]-t.length;return i>0&&(t="-".repeat(i)+t),t}return u("Unable to extend string",e),t}(t,e):function(t,e){var n=Y(e);if(!1!==n){if(t.length<=n[1])return!0;u("Invalid max length",e)}return!1}(t,e)||(t=function(t,e){var n=Y(e);if(!1!==n)return function(t,e,n=!1){if((t=t.trimEnd()).length<=e)return t;if(e<6)return"(...)";if(n||!t.match(/\s/))return t.substring(0,e-5)+"(...)";for(var i=t.split(/\s/),a=i.length-1;a>-1&&!((t=t.slice(0,-(i[a].length+1))).length+6<e);a--);return t+" (...)"}(t,n[1]);return u("Unable to cut string",e),""}(t,e))),t}function Z(t,e,n=!0){if(Object.prototype.hasOwnProperty.call(y,e)){var i=y[e];if(null!=t&&t.constructor.name===i){if(!n||!("object"==typeof(a=t)?!Object.keys(a).length:!a||!a.length))return!0;u("Field is empty",e)}else u("Invalid field type",e)}else u("Unknown field",e);var a;return!1}function V(t,e){return e?function(t){return!(!Z(t,"type",!0)||!b.includes(t))||(u("Invalid media type",t),!1)}(t)?t:A:""}function Q(t,e=!1){if(Z(t,"media",!0)){var n=null;if(G(t.url,e)&&(n=t.url),n||e){var i=V(t.type,null!==n),a=function(t){return t&&Z(t,"caption",!1)?H(t,"caption",!1):""}(t.caption);if(i||a)return n||(n=N),{url:n,type:i,caption:a}}}return{url:"",type:"",caption:""}}function R(t,e=!1){return!(!t||!Z(t,"timestamp",!0)||!t.match("^[0-9]{4}(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2][0-9]|3[0-1]))?((T|s)(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]))?)?$")&&(e||!M(n=t)||isNaN(new Date(n))))||(u("Invalid timestamp",t),!1);var n}function W(t,e=!1){if(!Z(t,"content",!0))return function(t=!1){return t?{timestamp:T,main:j,aside:"",media:{url:"",type:"",caption:""}}:null}(e);var n=function(t,e=!1){return R(t,!1)?t:e?T:null}(t.timestamp,e);if(!n)return null;var i=function(t,e=!1){return Z(t,"main",!0)?H(t,"main",!0):e?j:null}(t.main,e);if(!i)return null;var a,r={};return r.timestamp=n,r.main=i,r.aside=(a=t.aside)&&Z(a,"aside",!1)?H(a,"aside",!1):"",r.media=Q(t.media,e),r}function q(t){var e={url:null,id:""};if(i(t)&&(e.url=t,t.includes("#"))){var n=t.split("#"),a=n.pop();e.url=n.join("#"),a&&X(a)&&(e.id=a)}return e}function X(t){return!(!Z(t,"id",!0)||!t.match(z))||(u("Invalid thread id",t),!1)}function G(t,e=!1){var n=!1;if(t&&Z(t,"url",!0)){if(i(t))return!0;e&&(n=!0)}return u("Invalid url"),n}function J(t){return(e=t)&&null!==e&&"Object"===e.constructor.name&&Object.keys(e).length&&G(t.url)&&(!t.id||"/"===t.id||X(t.id));var e}function $(t,e){if(e.includes(t)){u("Duplicate thread id",t);for(var n=2;e.includes(t+"-"+n);)n++;t+="-"+n}return t}function K(t,e=[],n=!1){if(!Z(t,"threads.item",!0))return null;var i=function(t,e=[],n=!1){return X(t)?$(t,e):n?$(D,e):null}(t.id,e,n);if(!i)return null;var a=function(t,e=!1){return Z(t,"title",!0)?H(t,"title",!0):e?E:null}(t.title,n);if(!a)return null;var r=W(t.content,n);if(!r)return null;var s,d={};return d.id=i,d.title=a,d.description=(s=t.description)&&Z(s,"description",!1)?H(s,"description",!1):"",d.content=r,d.linked=function(t){var e,n=[];if(Z(t,"linked",!1)){var i=t.length,a=F("linked")[1];i>a&&(u("Too many linked threads",i+" /"+a),i=a);for(var r=0;r<i;r++){var s=null;if((e=t[r])&&Z(e,"linked.item",!0)&&G(e)||(u("Invalid linked thread"),0)){var d=q(t[r]);s=d.url,d.id&&(s+="#"+d.id)}else J(t[r])&&(s=t[r].url,t[r].id&&"/"!==t[r].id&&(s+="#"+t[r].id));s&&(n.includes(s)?u("Duplicate linked thread",s):n.push(s))}}return n}(t.linked),d}function tt(t,e=!1){if(!Z(t,"author",!0))return function(t=!1){return t?{handle:m,about:"",url:N}:null}(e);var n=function(t,e=!1){return Z(t,"handle",!0)?H(t,"handle",!0):e?m:null}(t.handle,e);if(!n)return null;var i=function(t,e=!1){return G(t,e)?t:e?N:null}(t.url,e);if(!i)return null;var a,r={};return r.handle=n,r.about=(a=t.about)&&Z(a,"about",!1)?H(a,"about",!1):"",r.url=i,r}function et(t){return function(t){return!(!G(t)||t!==x)||(u("Invalid app url"),!1)}(t)||(t=x),t}function nt(t,e=!1){if(Z(t,"nxdata",!0)){var n={};if(n.nexus=et(t.nexus),n.author=tt(t.author,e),n.author&&(n.threads=function(t,e=!1){var n=[];if(Z(t,"threads",!0)){var i=t.length,a=F("threads")[1];i>a&&(u("Too many threads",i+" /"+a),i=a);for(var r=[],s=0;s<i;s++){var d=K(t[s],r,e);null!==d&&(r.push(d.id),n.push(d))}if(n.length)return n}return u("No valid thread"),[]}(t.threads,e),e||n.threads.length))return n}return null}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const it=q(w);function at(t,e=null,n=[],a=null){e||(e=h),a||(a="en");var r={srcdoc:null,url:"",id:"",style:e,lang:a,mode:"reader"},s=null;return t&&t.dataset&&((s=t.dataset).lang&&(r.lang=s.lang),s.srcdoc&&(r.srcdoc=s.srcdoc),function(t,e,n){if(e&&e.style&&e.style!==t.style&&!n.includes(e.style)){var a=P(e.style);i(a)&&(t.style=a)}}(r,s,n)),function(t,e){if(e){if(e.src){var n=q(P(e.src));n.url&&(t.url=n.url,t.id=n.id)}e.id&&X(e.id)&&(t.id=e.id)}it.id&&(t.id=it.id)}(r,s),function(t,e){(e&&e.mode&&"editor"===e.mode||_("edit")||_("new"))&&(t.mode="editor")}(r,s),r}function rt(t,e=!0){var n,i=(n=JSON.stringify(t),(new TextEncoder).encode(n).length);return e&&(i/=1e3),i}function st(t){var e;try{e=window[t];var n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&e&&0!==e.length}}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var dt={visit:{},data:{},linked:{},oembed:{}},ot={local:st("localStorage")?localStorage:null,session:st("sessionStorage")?sessionStorage:null};function ct(t){return"local"===t?ot.local:ot.session}function lt(t){return t&&Object.prototype.hasOwnProperty.call(dt,t)}function ut(t,e){return lt(t)&&Object.prototype.hasOwnProperty.call(dt[t],e)}function ht(t,e,n="session",i=null){var a=JSON.stringify(e);lt(i)&&(dt[i][t]=a);var r=ct(n);if(r){var s=rt(a,!0);if(s>2e3)return;var d=r.getItem("available");d<1e3&&(d=5e3-function(t,e=2e3){for(var n=rt(t,!0),i=0;i<t.length&&!(n<e);i++){var a=t.key(i),r=rt(t.getItem(a),!0);t.removeItem(a),n-=r}return n}(r,2e3)),d-=s,r.setItem(t,a),r.setItem("available",Math.ceil(d))}}function gt(t,e="session",n=null){if(ut(n,t))return JSON.parse(dt[n][t]);var i=ct(e);if(i){var a=i.getItem(t);if(a)return lt(n)&&(dt[n][t]=a),JSON.parse(a)}return null}function pt(t){var e=ct("local");if(e&&e.length)for(var n=0;n<e.length;n++){var i=e.key(n);t(e,i)}}Object.values(ot).forEach((t=>{t&&!t.getItem("available")&&t.setItem("available",5e3)}));
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const It="nx-edit#";function Mt(t,e){ht(It+t,e,"local")}function vt(t,e){ht(t,e,"session","data")}function ft(t){ht("nx-lang",t,"local")}function xt(){!function(t=[]){Object.keys(dt).forEach((e=>{t.includes(e)||(dt[e]={})}))}(),function(t=null){Object.keys(ot).forEach((e=>{ot[e]&&t!==e&&ot[e].clear()}))}("local"),pt((function(t,e){0!==e.indexOf(It)&&t.removeItem(e)}))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function yt(t){var e=[];return t.threads.forEach((t=>{e.push(t.id)})),e}function mt(t,e=!1){var n=null;try{if((n=JSON.parse(t))&&(n=nt(n,e)),!n)throw new Error("Invalid Nexus data")}catch(t){u("Invalid source",t.message)}return n}function Nt(t,e=!1){var n=function(t){return gt(t,"session","data")}(t);return null!==n?Number.isInteger(n)?Promise.reject(new Error(n)):Promise.resolve(n):function(t,e=!1){return a(t).then((n=>(n=nt(n,e))?(e||vt(t,n),n):(u("Invalid source",t),Promise.reject(new Error(400))))).catch((e=>{var n=400;return 400!==e.message&&(n=404,u("No response",e.message)),vt(t,n),Promise.reject(new Error(n))}))}(t,e)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const Dt={customSelector:null,forceLog:!1,forceStyle:null,customSignatureRule:null,appDefaultCss:null,appDefaultCssAliases:[],appDefaultLang:null};function Et(){_("clear")&&xt(),_("erase")&&pt((function(t,e){0===e.indexOf(It)&&t.removeItem(e)}))}function Tt(t=!1){(t||_("log"))&&function(t=!0){l=t}(!0)}function jt(t=null){var e,n=[p];t&&t!==p&&n.unshift(t);for(var i=0;i<2;i++)if(e=document.querySelector(n[i]))return e;return(e=document.createElement("DIV")).id=p,e}function At(t={}){var e={};return e.options=Object.assign({},Dt,t),Et(),document.cookie="Nx=Instance; SameSite=None; Secure",Tt(e.options.forceLog),e.nxelm=jt(e.options.customSelector),e.request=at(e.nxelm,e.options.appDefaultCss,e.options.appDefaultCssAliases,e.options.appDefaultLang),function(t,e=null,n=null,i=null){var a=t.style;return n?(a=n,e&&e!==n||(e=t.style)):e===a&&(e=null),I(a,i,e)}(e.request,e.options.appDefaultCss,e.options.forceStyle,e.options.customSignatureRule).then((t=>(e.styleUrl=t,function(t){if(t.srcdoc){var e=mt(t.srcdoc,"editor"===t.mode);if(e)return Promise.resolve(e)}return t.url?Nt(t.url):Promise.reject(new Error(0))}(e.request)))).then((t=>(e.nxdata=t,e))).catch((t=>{var e=t.message;throw Number.isInteger(e)||(u("Nexus Init Failed",e),e=400),new Error(e)}))}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var St={fr:{author:"auteur·e",handle:"pseudonyme",about:"à propos",url:"url",id:"id",title:"titre",description:"description",timestamp:"date",main:"corps",aside:"aparté",media:"média",type:"type",caption:"légende",index:"index",distant:"distant",local:"local",threads:"fils",linked:"liés",content:"contenu",history:"historique",copied:"copié",embed:"intégré",source:"source",saved:"sauvegardé","local thread":"fil local","linked threads":"fils liés","No valid thread":"Aucun fil valide","Duplicate thread id":"Identifiant du fil en double","Duplicate linked thread":"Fil lié en double","Invalid linked thread":"Fil lié non valide","Invalid url":"Url non valide","Invalid thread id":"Identifiant de fil non valide","Invalid length":"Longueur non valide","Invalid min length":"Longueur minimale non valide","Invalid max length":"Longueur maximale non valide","Unable to cut string":"Impossible de raccourcir le texte","Invalid timestamp":"Horodatage non valide","Unknown field":"Champ inconnu","Invalid field type":"Type de champ non valide","Field is empty":"Le champ est vide","Unable to extend string":"Impossible de prolonger le texte","Unknown characters limits category":"Catégorie de limite de caractères inconnue","Unknown items limits category":"Catégorie de limite d'éléments inconnue","Invalid media type":"Type de media non valide","Invalid app url":"Url de l'application non valide","Too many linked threads":"Trop de fils liés","Too many threads":"Trop de fils","Init failed":"L'initialisation a échoué","Theme not found":"Thème non trouvé","No response":"Aucune réponse","Invalid source":"Source non valide","Invalid Nexus data":"Données Nexus non valides"}},Ct=Object.keys(St);Ct.push("en");var Lt=gt("nx-lang","local");null==Lt||zt(Lt)||(Lt=null,ft(null));var bt=null;function zt(t){return M(t)&&Ct.includes(t)}function Ot(t){return!(!zt(t)||t===bt)&&(bt=t,function(t){Lt!==t&&(ft(t),Lt=t)}(t),!0)}function wt(){return bt}function Ut(t){var e=t;return"en"!==bt&&St[bt][t]&&(e=St[bt][t]),e}Lt?bt=Lt:zt(bt=document.querySelector("html").lang)||(bt="en");var kt={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},Bt={onChange:[],onSrcChange:[]};function _t(t){var e=t.dataUrl;return"/"!==t.threadId&&(e+="#"+t.threadId),e}function Pt(t){return-1!==t.threadIndex&&t.srcData.threads&&t.threadIndex<t.srcData.threads.length?t.srcData.threads[t.threadIndex].content.timestamp:null}function Yt(t){var e=Pt(t);return!!e&&function(t,e){var n=gt(t,"local","visit");return!n||!(!e||n===e)}(_t(t),e)}function Ft(t,e,n,i=!1){n.index=yt(n);var a={dataUrl:t,threadId:e,srcData:n,threadIndex:n.index.indexOf(e)};return-1===a.threadIndex&&(i?"/"!==a.threadId&&(a.threadId="/"):function(t){t.threadIndex=0,t.threadId=t.srcData.index[0]}(a)),a}function Ht(t,e,n=!1){return Nt(t).then((i=>Ft(t,e,i,n)))}function Zt(t,e=!1){var n="onChange";e&&(n="onSrcChange"),Bt[n].push(t)}function Vt(t,e=!1,n=!1){var i,a,r=t.dataUrl!=kt.dataUrl;if(n||r||t.threadId!=kt.threadId){e||(i=_t(kt),a=Pt(kt),ut("visit",i)||ht(i,a,"local","visit"));var s=r||n;kt=Object.assign({},t),function(t,e,n){var i=["onChange"];e&&i.push("onSrcChange"),i.forEach((e=>{Bt[e].length&&Bt[e].forEach((e=>{e(t,n)}))}))}(t,s,e)}}function Qt(t,e,n){var i=Object.assign({},t);return i.threadId=e,i.threadIndex=n,i}const Rt={spacing:["padding-top","padding-bottom","margin-top","margin-bottom"],transitions:["transition-duration","transition-timing-function","transition-property"],heights:["height","overflow"]},Wt={target:"height, margin, padding",toReset:["height"].concat(Rt.spacing),removeInFirst:Rt.spacing,removeInThen:Rt.heights.concat(Rt.transitions),removeOut:Rt.heights.concat(Rt.spacing,Rt.transitions)},qt={target:"opacity",toReset:["opacity"],removeInFirst:["opacity"],removeInThen:Rt.transitions,removeOut:["opacity"].concat(Rt.transitions)},Xt={slide:Wt,fade:qt,ease:{target:Wt.target+", "+qt.target,toReset:["opacity"].concat(Wt.toReset),removeInFirst:Rt.spacing.concat(["opacity"]),removeInThen:Wt.removeInThen,removeOut:["opacity"].concat(Wt.removeOut)}},Gt="ease",Jt=300,$t="ease-in-out",Kt=1e3;function te(t){t.style.removeProperty("display");let e=window.getComputedStyle(t).display;"none"===e&&(e="block"),t.style.display=e}function ee(t,e,n,i){t.style.setProperty("transition-property",Xt[e].target),t.style.setProperty("transition-timing-function",i),t.style.setProperty("transition-duration",n+"ms")}function ne(t,e){Xt[e].toReset.forEach((e=>{t.style.setProperty(e,0)}))}function ie(t,e,n){Xt[e][n].forEach((e=>{t.style.removeProperty(e)}))}function ae(t,e,n,i){t instanceof Element||(t=document.body);var a="m"+Math.random().toString(20).substring(2);return e.classList.add(a),new Promise((r=>{var s=new MutationObserver((()=>{t.querySelector("."+a)&&(e.classList.remove(a),s.disconnect(),i(),r(!0))}));s.observe(t,{childList:!0}),n()}))}function re(t,e=Gt,n=Jt,i=null,a=$t){ee(t,e,n,a),"fade"!==e&&(t.style.setProperty("box-sizing","border-box"),t.style.setProperty("height",t.offsetHeight+"px"),t.offsetHeight,t.style.setProperty("overflow","hidden")),ne(t,e),window.setTimeout((()=>{t.style.setProperty("display","none"),ie(t,e,"removeOut"),"function"==typeof i&&i()}),n)}function se(t,e=Gt,n=Jt,i=null,a=$t){if("fade"===e)ne(t,"fade"),te(t),ee(t,"fade",n,a);else{te(t);var r=t.offsetHeight;t.style.setProperty("overflow","hidden"),ne(t,e),t.offsetHeight,t.style.setProperty("box-sizing","border-box"),ee(t,e,n,a),t.style.setProperty("height",r+"px")}ie(t,e,"removeInFirst"),window.setTimeout((()=>{ie(t,e,"removeInThen"),"function"==typeof i&&i()}),n)}function de(t,e=Gt,n=Kt,i=Jt,a=null,r=$t){var s=[re,se];(function(t){if(!t)return!1;do{if(t instanceof Element){if(t.hidden||!t.offsetHeight)return!0;var e=window.getComputedStyle(t);if("0"===e.width||"0"===e.height||"0"===e.opacity||"none"===e.display||"hidden"===e.visibility)return!0}}while(t=t.parentNode);return!1})(t)&&s.reverse();s[0](t,e,i,(function(){"function"==typeof a&&a(),window.setTimeout((()=>{s[1](t,e,i,a,r)}),n)}),r)}function oe(t,e,n=!1,i=Gt,a=Jt,r=null,s=$t){var d;e.style.setProperty("display","none"),d=n?function(){t.prepend(e)}:function(){t.append(e)};ae(t,e,d,(function(){se(e,i,a,r,s)}))}function ce(t,e,n=Jt,i=null,a=$t){e.style.opacity=0;var r=t.parentNode,s=t.offsetHeight,d=function(){t.replaceWith(e)},o=function(){!function(t,e,n=Jt,i=null,a=$t){var r="ease";t.offsetHeight===e&&(r="fade");se(t,r,n,i,a)}(e,s,n,i,a)};re(t,"fade",n,(function(){ae(r,e,d,o)}),a)}function le(t,e,n=20){var i,a,r,s=t.textContent.split(""),d=e.split(""),o=s.length,c=d.length;o>c?(i=o,a=0,r=function(){i>c?s.pop():s[i-1]=d[i-1],i--}):(i=0,a=c,r=function(){i<o?s[i]=d[i]:s.push(d[i]),i++});var l=setInterval((function(){r(),t.textContent=s.join(""),i===a&&clearInterval(l)}),n)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
var ue={};function he(t,e){le(t,Ut(e),50)}function ge(t,e){ue[e]||(ue[e]=[]),ue[e].push(t)}function pe(t){var e="/";return t&&-1!==t.threadIndex&&t.srcData.threads[t.threadIndex]&&(e=t.srcData.threads[t.threadIndex].title),e}function Ie(t,e,n){n.dataUrl&&e.dataUrl===n.dataUrl&&e.threadId==n.threadId?t.classList.add("nx-on-display"):t.classList.remove("nx-on-display")}function Me(){var t=fe("P");return t.textContent=wt(),je(Ct,t,(function(t){!function(t){if(Ot(t))for(const[t,e]of Object.entries(ue))e.forEach((e=>{he(e,t)}))}(t)}),"nx-lang-switch")}function ve(){var t,e=fe("HEADER");return e.append(((t=fe("A","nx-app-link nx-external-link")).target="_blank",t.href=x,t.title="Nexus",t.textContent="Nexus",t)),e}function fe(t,e){var n=document.createElement(t);return e&&(n.className=e),n}function xe(t,e){var n=fe("DIV","nx-instance");return n.append(t,function(t){var e=fe("MAIN");return e.append(...t),e}(e)),n}function ye(t,e,n=[],i="reader"){var a=fe("DIV","nx-"+i),r=fe("NAV");r.append(...t);var s=fe("SECTION");if(s.append(...e),a.append(r,s),n.length){var d=fe("FOOTER");d.append(...n),a.append(d)}return a}function me(t,e=null,n=null){var i=fe("DIV","nx-"+t+" nx-block");return n&&i.append(n),e&&i.append(...e),i}function Ne(t){var e=fe("SPAN","nx-landmark nx-landmark-"+t.replace(" ","-"));return e.textContent=Ut(t),ge(e,t),e}function De(){var t=fe("P");return!function(t=null,e=null){return t||(t=h),e||(e=g),s(e,h)}()?(t.style.margin="2vh auto",t.style.fontFamily='"Courier New", Courier, monospace',t.style.fontSize="13px"):t.className="nx-error",t.textContent="—/ — ",t}function Ee(t){t.position>0?t.ctrls.prev.elm.classList.remove("nx-nav-end"):t.ctrls.prev.elm.classList.add("nx-nav-end"),t.position<t.count-1?t.ctrls.next.elm.classList.remove("nx-nav-end"):t.ctrls.next.elm.classList.add("nx-nav-end")}function Te(t,e,n=!1){Object.keys(t.ctrls).forEach((i=>{t.ctrls[i].elm=fe("A","nx-nav-ctrl nx-nav-end"),n?t.ctrls[i].elm.append(be(t.ctrls[i].symbol)):t.ctrls[i].elm.textContent=t.ctrls[i].symbol,t.ctrls[i].elm.addEventListener("click",(function(){t.ctrls[i].elm.classList.contains("nx-nav-end")||("next"===i?t.position++:t.position--,e(i,t.position),Ee(t))}))}))}function je(t,e,n=null,i=null){var a="nx-selected";e.classList.add("nx-select-toggle");var r,s="INPUT"==e.tagName;s?(e.setAttribute("autocomplete","off"),r=e.value):r=e.textContent;var d=fe("UL","nx-select-list"),o=fe("DIV","nx-select");return i&&o.classList.add(i),o.append(e,d),e.addEventListener("click",(()=>{var t="none";d.style.display==t&&(t="block"),d.style.display=t})),t.forEach((t=>{var i=fe("LI");i.textContent=t,i.dataset.item=t,t==r&&i.classList.add(a),d.append(i),i.addEventListener("click",(()=>{var t=i.textContent;if((s?e.value:e.textContent)!=t){if(!i.classList.contains(a)){var r=d.querySelector(".nx-selected");r&&r.classList.remove(a),i.classList.add(a)}s?e.value=t:e.textContent=t,e.dispatchEvent(new window.Event("change")),"function"==typeof n&&n(t)}d.style.display="none"}))})),d.style.display="none",o}function Ae(t,e){Ie(t,e,kt),Zt((function(n){Ie(t,e,n)}))}function Se(t,e=!1){var n=fe("A","nx-view-link");return n.append(Ce(t,e)),n}function Ce(t,e=!1){var n=fe("SPAN","nx-thread-title");return n.textContent=pe(t),e&&Zt((function(t){var e=pe(t);le(n,e,15)})),n}function Le(t){var e=fe("DIV","nx-lines");if(t){var n=t.split(/(\r\n|\n|\r)/gm),i=[];n.forEach((t=>{var e=fe("P");e.textContent=t,i.push(e)})),e.append(...i)}return e}function be(t,e=20){var n=new Image(e,e);return n.className="nx-icon",n.src=t,n}var ze={};function Oe(t){var e=gt(t,"local",ze);return e||ht(t,e=function(t){for(var e=t.replace(/^(https?:\/\/)?(www.)?/,"").split(":")[0].split("/")[0].split("."),n=0;n<e.length;n++)if(e[n].includes("-"))e[n]=e[n].split("-").map((t=>t[0])).join("-");else{for(var i=e[n].split(""),a=0,r=0;r<i.length;r++)["a","e","i","o","u","y"].includes(i[r])&&(0!==a&&r!==a+1?i[r]="":a=r);e[n]=i.join("")}return e.join(".")}(t),"local",ze),e}function we(t,e){t.classList.contains("nx-on-display")?(t.classList.remove("nx-unseen"),t.lastChild.textContent=""):Yt(e)&&(t.classList.add("nx-unseen"),t.lastChild.textContent="*")}function Ue(t,e=!1){var n=fe("SPAN","nx-handle");return t.srcData&&(n.textContent=t.srcData.author.handle),e&&Zt((function(t){le(n,t.srcData.author.handle,25)}),!0),n}function ke(t,e=!1){var n=fe("SPAN","nx-author-url"),i=[];["[","]"].forEach((t=>{var e=fe("SPAN","nx-author-url-brackets");e.textContent=t,i.push(e)}));var a=fe("A","nx-external-link");a.target="_blank";var r="";return t.srcData&&(r=t.srcData.author.url),a.href=r,t.srcData&&(a.textContent=Oe(t.srcData.author.url)),n.append(i[0],a,i[1]),e&&Zt((function(t){a.href=t.srcData.author.url,le(a,Oe(t.srcData.author.url),25)}),!0),n}function Be(t,e=!1){var n=Se(t,e);return"/"!==t.threadId&&(Ae(n,t),function(t,e){t.append(fe("SPAN","nx-new-tag")),we(t,e),Zt((function(){we(t,e)}))}(n,t)),n.addEventListener("click",(()=>{Vt(t)})),n}function _e(t,e=!1){var n=fe("A","nx-author-link");n.append(Ue(t,e));var i=Qt(t,"/",-1);return Ae(n,i),n.addEventListener("click",(function(){Vt(i,"/")})),n}function Pe(t){t.scrollIntoView({block:"end",behavior:"smooth"})}var Ye=!1,Fe=null,He=null,Ze={dataUrl:null,srcData:null,threadId:"/",threadIndex:-1},Ve={ctrls:{prev:{symbol:"<",elm:null},next:{symbol:">",elm:null}},position:0,count:1};function Qe(){var t,e=fe("DIV","nx-history-nav");return Te(Ve,(function(t,e){Fe.children[e+1].querySelector(".nx-thread-title").click()})),e.append(Ve.ctrls.prev.elm,((t=fe("A","nx-history-toggle")).textContent="≚",t.addEventListener("click",(()=>{"≙"==t.textContent?(t.textContent="≚",t.classList.remove("nx-active"),re(He,"ease",200)):(t.textContent="≙",t.classList.add("nx-active"),se(He,"ease",200),Pe(Fe))})),t),Ve.ctrls.next.elm),e}function Re(t){Fe=fe("UL","nx-history-list");var e=fe("LI");e.textContent="...",Fe.append(e),t&&t.srcData&&(Ze=t,Fe.append(We(t,0))),(He=fe("DIV","nx-history-drawer")).append(Fe),He.style.display="none",Zt((function(t,e){!function(t,e){if(!(e||Ye||t.dataUrl===Ze.dataUrl&&t.threadId===Ze.threadId)){Ze=t,Ve.count>100?Fe.children[1].remove():Ve.count++,Ve.position=Ve.count-1;var n=We(t,Ve.position);oe(Fe,n,!1,"ease",200,(function(){Pe(Fe)})),Ee(Ve)}}(t,e)}))}function We(t,e){var n=document.createElement("LI");return n.append(...function(t,e){return[_e(t,!1),ke(t,!1),qe(t,e)]}(t,e)),n}function qe(t,e){var n=Se(t,!1);return Ae(n,t),n.addEventListener("click",(()=>{Ye=!0,Vt(t,!0),Ve.position=e,Ye=!1})),n}var Xe=null;function Ge(t){var e=null;return t.srcData&&t.srcData.author.about&&(e=t.srcData.author.about),Le(e)}function Je(t){if(Xe=fe("UL"),t.srcData){var e=t.srcData.index;if(e.length)for(var n=0;n<e.length;n++)Xe.append($e(t,e[n],n))}Zt((function(t){!function(t){var e=Xe.childNodes,n=t.srcData.index,i=n.length,a=e.length,r=0;if(a)for(var s=function(t){re(t,"ease",200,(function(){t.remove()}))},d=0;d<a;d++)if(i>d){var o=$e(t,n[d],d);ce(e[d],o,200),r++}else s(e[d]);if(r<i)for(var c=r;c<i;c++)oe(Xe,$e(t,n[c],c),!1,"ease",200)}(t)}),!0)}function $e(t,e,n){var i=Qt(t,e,n),a=fe("LI");return a.append(Be(i,!1)),a}function Ke(t){var e=fe("DIV","nx-index-header");return e.append(Ue(t,!0),ke(t,!0),function(t){var e=fe("DIV","nx-about-author");return e.append(Ge(t)),Zt((function(t){ce(e.firstChild,Ge(t),200)}),!0),e}(t)),e}function tn(t){return Je(t),me("threads-list",[Xe])}function en(t){var e=fe("DIV","nx-main-block nx-index"),n=[Ke(t),tn(t)];return e.append(...n),e}const nn="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NxIO.min.css",an=["https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/css/NexusI.min.css"],rn="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA4IEMgNy42NjQwNjMgOCAxLjI1IDE1LjM0Mzc1IDEuMjUgMTUuMzQzNzUgTCAwLjY1NjI1IDE2IEwgMS4yNSAxNi42NTYyNSBDIDEuMjUgMTYuNjU2MjUgNy4wOTc2NTYgMjMuMzI0MjE5IDE0Ljg3NSAyMy45Mzc1IEMgMTUuMjQ2MDk0IDIzLjk4NDM3NSAxNS42MTcxODggMjQgMTYgMjQgQyAxNi4zODI4MTMgMjQgMTYuNzUzOTA2IDIzLjk4NDM3NSAxNy4xMjUgMjMuOTM3NSBDIDI0LjkwMjM0NCAyMy4zMjQyMTkgMzAuNzUgMTYuNjU2MjUgMzAuNzUgMTYuNjU2MjUgTCAzMS4zNDM3NSAxNiBMIDMwLjc1IDE1LjM0Mzc1IEMgMzAuNzUgMTUuMzQzNzUgMjQuMzM1OTM4IDggMTYgOCBaIE0gMTYgMTAgQyAxOC4yMDMxMjUgMTAgMjAuMjM0Mzc1IDEwLjYwMTU2MyAyMiAxMS40MDYyNSBDIDIyLjYzNjcxOSAxMi40NjA5MzggMjMgMTMuNjc1NzgxIDIzIDE1IEMgMjMgMTguNjEzMjgxIDIwLjI4OTA2MyAyMS41ODIwMzEgMTYuNzgxMjUgMjEuOTY4NzUgQyAxNi43NjE3MTkgMjEuOTcyNjU2IDE2LjczODI4MSAyMS45NjQ4NDQgMTYuNzE4NzUgMjEuOTY4NzUgQyAxNi40ODA0NjkgMjEuOTgwNDY5IDE2LjI0MjE4OCAyMiAxNiAyMiBDIDE1LjczNDM3NSAyMiAxNS40NzY1NjMgMjEuOTg0Mzc1IDE1LjIxODc1IDIxLjk2ODc1IEMgMTEuNzEwOTM4IDIxLjU4MjAzMSA5IDE4LjYxMzI4MSA5IDE1IEMgOSAxMy42OTUzMTMgOS4zNTE1NjMgMTIuNDgwNDY5IDkuOTY4NzUgMTEuNDM3NSBMIDkuOTM3NSAxMS40Mzc1IEMgMTEuNzE4NzUgMTAuNjE3MTg4IDEzLjc3MzQzOCAxMCAxNiAxMCBaIE0gMTYgMTIgQyAxNC4zNDM3NSAxMiAxMyAxMy4zNDM3NSAxMyAxNSBDIDEzIDE2LjY1NjI1IDE0LjM0Mzc1IDE4IDE2IDE4IEMgMTcuNjU2MjUgMTggMTkgMTYuNjU2MjUgMTkgMTUgQyAxOSAxMy4zNDM3NSAxNy42NTYyNSAxMiAxNiAxMiBaIE0gNy4yNSAxMi45Mzc1IEMgNy4wOTM3NSAxMy42MDkzNzUgNyAxNC4yODUxNTYgNyAxNSBDIDcgMTYuNzUzOTA2IDcuNSAxOC4zOTQ1MzEgOC4zNzUgMTkuNzgxMjUgQyA1Ljg1NTQ2OSAxOC4zMjQyMTkgNC4xMDU0NjkgMTYuNTg1OTM4IDMuNTMxMjUgMTYgQyA0LjAxMTcxOSAxNS41MDc4MTMgNS4zNTE1NjMgMTQuMjAzMTI1IDcuMjUgMTIuOTM3NSBaIE0gMjQuNzUgMTIuOTM3NSBDIDI2LjY0ODQzOCAxNC4yMDMxMjUgMjcuOTg4MjgxIDE1LjUwNzgxMyAyOC40Njg3NSAxNiBDIDI3Ljg5NDUzMSAxNi41ODU5MzggMjYuMTQ0NTMxIDE4LjMyNDIxOSAyMy42MjUgMTkuNzgxMjUgQyAyNC41IDE4LjM5NDUzMSAyNSAxNi43NTM5MDYgMjUgMTUgQyAyNSAxNC4yODUxNTYgMjQuOTA2MjUgMTMuNjAxNTYzIDI0Ljc1IDEyLjkzNzUgWiIvPjwvc3ZnPg==",sn="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA3LjIxODc1IDUuNzgxMjUgTCA1Ljc4MTI1IDcuMjE4NzUgTCAxNC41NjI1IDE2IEwgNS43ODEyNSAyNC43ODEyNSBMIDcuMjE4NzUgMjYuMjE4NzUgTCAxNiAxNy40Mzc1IEwgMjQuNzgxMjUgMjYuMjE4NzUgTCAyNi4yMTg3NSAyNC43ODEyNSBMIDE3LjQzNzUgMTYgTCAyNi4yMTg3NSA3LjIxODc1IEwgMjQuNzgxMjUgNS43ODEyNSBMIDE2IDE0LjU2MjUgWiIvPjwvc3ZnPg==";var dn=null,on=!1,cn=null;function ln(t){return on?"#editing":_t(t)}function un(t){return t.dataUrl?ln(t):""}function hn(){var t="< />",e=function(t,e){var n=fe("A","nx-source-"+t);return n.textContent=e,n}("snippets","</>");return e.addEventListener("click",(()=>{e.textContent==t?(e.textContent="</>",e.classList.remove("nx-active"),re(dn,"ease",200)):(e.textContent=t,e.classList.add("nx-active"),se(dn,"ease",100,(function(){dn.scrollIntoView({block:"end",behavior:"smooth",inline:"nearest"})})))})),e}function gn(t){(dn=fe("DIV","nx-source-drawer")).append(function(t){return Mn("json",pn(t,un))}(t),function(t){return Mn("embed",pn(t,vn))}(t)),dn.style.display="none";var e=fe("DIV","nx-source-toggle"),n=hn();return e.append(n),[e,dn]}function pn(t,e){var n=fe("TEXTAREA");return n.spellcheck=!1,n.textContent=e(t),Zt((function(t){n.textContent=e(t)})),n}function In(t){var e=fe("A","nx-source-link"),n=be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA0IDQgTCA0IDI0IEwgMTEgMjQgTCAxMSAyMiBMIDYgMjIgTCA2IDYgTCAxOCA2IEwgMTggNyBMIDIwIDcgTCAyMCA0IFogTSAxMiA4IEwgMTIgMjggTCAyOCAyOCBMIDI4IDggWiBNIDE0IDEwIEwgMjYgMTAgTCAyNiAyNiBMIDE0IDI2IFoiLz48L3N2Zz4=",16);e.append(n);var i,a,r=(i="c/c",(a=fe("SPAN","nx-source-copy-tooltip")).textContent=i,a.style.opacity=0,a.hidden=!0,ge(a,i),a);return e.append(r),e.addEventListener("click",(()=>{return e=t.textContent,n=()=>{de(r,"fade",1e3,200)},void navigator.clipboard.writeText(e).then((()=>n()));var e,n})),e}function Mn(t,e){var n=fe("DIV","nx-"+t+"-snippet");return n.append(e,In(e)),n}function vn(t){return on?"#editing":t.dataUrl?
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function(t,e=null,n=null,i=null){var a="";i&&(a=' data-lang="'+i+'"');var r="";return e&&(r=' data-style="'+e+'"'),n||(n="https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js"),`<div id="Nexus" data-src="${t}"${r}${a}></div>\n<script src="${n}"><\/script>`}(ln(t),cn,"https://cdn.jsdelivr.net/gh/I-is-as-I-does/Nexus@latest/dist/js/NxIO.js",wt()):""}function fn(t,e=null,n=!1){return n&&(on=!0),e?e!==nn&&(cn=e):e=nn,me("source",gn(t),!1)}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
const xn=new Event("mediaReady");function yn(t,e){(function(t,e=null){return e&&e instanceof Element||(e=document.body),new Promise((n=>{var i=e.querySelector(t);if(i)return n(i);var a=new MutationObserver((()=>{(i=e.querySelector(t))&&(a.disconnect(),n(i))}));a.observe(e,{childList:!0,subtree:!0})}))})(t.tagName,e).then((()=>{e.dispatchEvent(xn)}))}function mn(t,e,n){if("A"!==n.tagName){var i="load",a=n;["VIDEO","AUDIO"].includes(n.tagName)&&(i="loadedmetadata","VIDEO "===n.tagName&&(a=n.firstChild)),n.addEventListener(i,(function(){yn(n,e)})),a.addEventListener("error",(function(){u("Unable to load requested media",t);var i=Dn(t);n.replaceWith(i),yn(i,e)})),a.src=t}else n.textContent||(n.textContent=o(t,!0)),yn(n,e),n.href=t;e.append(n)}function Nn(t,e="src",n=null){n&&t.setAttribute(e,n)}function Dn(t=null){var e=document.createElement("A");return e.target="_blank",t&&(e.textContent=o(t,!0),e.setAttribute("href",t)),e}function En(t=null){var e=document.createElement("VIDEO");e.setAttribute("controls",!0);var n=document.createElement("SOURCE");return e.append(n),Nn(n,"src",t),e}function Tn(t=null){var e=document.createElement("AUDIO");return e.setAttribute("controls",!0),Nn(e,"src",t),e}function jn(t=null){var e=document.createElement("IMG");return Nn(e,"src",t),e}function An(t=null){var e=document.createElement("IFRAME");return e.scrolling="no",e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",e.allowfullscreen=!0,Nn(e,"src",t),e}function Sn(t,e=null){var n;switch(L.includes(t)&&(t="iframe"),t){case"image":n=jn;break;case"video":n=En;break;case"audio":n=Tn;break;case"iframe":n=An;break;default:n=Dn}return n(e)}function Cn(t,e){var n=gt(t,"local","oembed"),i=function(){return{type:e,url:n}},r=function(){return{type:"page",url:t}};if(n)return Promise.resolve(i());var s=function(t,e,n=null,i=null){e=e.toLowerCase();var a={youtube:"https://youtube.com/oembed?url=",vimeo:"https://vimeo.com/api/oembed.json?url=",soundcloud:"https://soundcloud.com/oembed?format=json&url="};return!!Object.prototype.hasOwnProperty.call(a,e)&&(t=a[e]+encodeURIComponent(t),null!=n&&(t+="&maxwidth="+n),null!=i&&(t+="&maxheight="+i),t)}(t,e,720);return s?function(t){return a(t).then((t=>{if(t&&Object.prototype.hasOwnProperty.call(t,"html"))return t;throw new Error("invalid oembed response")}))}(s).then((e=>(n=e.html.split('src="')[1].split('"')[0],function(t,e){ht(t,e,"local","oembed")}(t,n),i()))).catch((e=>(u("Failed to resolved oembed media",{url:t,err:e.message}),r()))):Promise.resolve(r())}function Ln(t,e,n){L.includes(e)?function(t,e,n){Cn(t,e).then((t=>{mn(t.url,n,Sn(t.type))}))}(t,e,n):mn(t,n,Sn(e))}function bn(t,e=null){var n=fe("DIV","nx-content-media");return n.append(function(t,e){var n=fe("DIV","nx-media"),i=fe("DIV");n.append(i);var a=null;return t.content.media.caption&&(a=ci(t,["content","media","caption"]),n.append(a)),i.addEventListener("mediaReady",(function(){"A"===i.firstChild.tagName&&"page"!==t.content.media.type&&(t.content.media.type="page"),i.className="nx-"+t.content.media.type+"-media",null!==e&&e()})),Ln(t.content.media.url,t.content.media.type,i),n}(t,e)),n}
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
class zn{constructor(t,e=[],n=100){this.spinContainer=t,e.length?""!==e[0]&&e.unshift(""):e=["","/","–","\\","|"],this.spinStates=e,this.speed=n,this.spinPosition=-1}endSpin(){this.spinPosition=-1}startSpin(){this.spinPosition=0;var t=window.setInterval(function(){-1===this.spinPosition?(this.spinContainer.textContent="",clearInterval(t)):(this.spinContainer.textContent=this.spinStates[this.spinPosition],this.spinPosition===this.spinStates.length-1?this.spinPosition=1:this.spinPosition++)}.bind(this),this.speed)}}function On(t,e,n=[],i=!1){var a={instances:null,register:!1};return i||(a.instances=function(t){return gt(t+":linked","session","linked")}(t)),null===a.instances&&(a.instances=
/*! Nexus | (c) 2021-22 I-is-as-I-does | AGPLv3 license */
function(t,e=[]){for(var n={},i=0;i<t.linked.length;i++)if(!e.includes(t.linked[i])){var a=q(t.linked[i]);e.includes(a.url)||(Object.prototype.hasOwnProperty.call(n,a.url)||(n[a.url]=[]),a.id&&n[a.url].push(a.id))}return n}(e,n),a.register=!0),a}var wn,Un,kn,Bn,_n,Pn,Yn,Fn,Hn,Zn=[],Vn=0,Qn={ctrls:{prev:{symbol:"⊼",elm:null},next:{symbol:"⊻",elm:null}},position:0,count:0};function Rn(){Yn=fe("DIV","nx-loading"),Fn=new zn(Yn)}function Wn(){2===++Vn&&(Fn.endSpin(),Yn.style.display="none",Zn.length&&(Qn.count=Zn.length,Ee(Qn),function(t=!1){ii(!0),t&&(_n.style.visibility="visible");Un.append(Zn[0])}(Zn.length>1)),se(wn,"ease",200))}function qn(t){var e=Xn(t);re(wn,"ease",200,(function(){var n,i;e&&(Fn.startSpin(),Vn=0,Yn.style.display="block"),n=t.dataUrl,i=e,$n(),ii(!1),ti(!1),Zn=[],Qn.position=0,Qn.count=0,Ee(Qn),Kn(n,i);var a=ai(e,!1),r=ci(e,["description"]);kn.firstChild.replaceWith(r),Bn.firstChild.replaceWith(a)}))}function Xn(t){var e=null;return t&&t.threadIndex>-1&&(e=t.srcData.threads[t.threadIndex]),e}function Gn(t,e){return(Hn=Ne("distant")).style.display="none",Pn=fe("DIV"),Un=fe("DIV","nx-distant-link"),Te(Qn,ei),Ee(Qn),Pn.append(((_n=fe("NAV","nx-distant-nav")).append(Qn.ctrls.prev.elm,Un,Qn.ctrls.next.elm),$n(),_n),Un),Kn(t,e),me("distant",[Pn],Hn)}function Jn(t){return function(t){(Bn=fe("DIV","nx-local-content")).append(ai(t,!1))}(t),me("local",[Bn],Ne("local"))}function $n(){_n.style.visibility="hidden"}function Kn(t,e){e&&e.linked.length?function(t,e){var n=t+"#"+e.id,i=On(n,e),a=i.register,r={},s=[];const d=[];for(let[t,e]of Object.entries(i.instances)){var o=Ht(t,"/",!0).then((n=>{r[t]=[],e.length&&e.forEach((e=>{var i=n.srcData.index.indexOf(e);if(-1!==i){r[t].push(e);var s=Qt(n,e,i);Zn.push(ni(s))}else a=!0,u("Linked thread could not be resolved",e)})),r[t].length||s.push(ni(n))})).catch((()=>{a=!0,u("Linked source could not be resolved",t)}));d.push(o)}Promise.all(d).then((()=>{a&&ht(n+":linked",r,"session","linked"),s.length&&(Zn=Zn.concat(s)),Wn()}))}(t,e):Wn()}function ti(t=!1){var e=Un.firstChild;e&&(t?re(e,"ease",200,(function(){e.remove()})):e.remove())}function ei(){if(Zn.length){var t=Zn[Qn.position];Un.firstChild?ce(Un.firstChild,t,200):oe(Un,t,!1,"ease",200,callb)}else ti(!0)}function ni(t){var e=[_e(t,!1),ke(t,!1)];"/"!==t.threadId&&e.push(Be(t,!1),ai(Xn(t),!0));var n=fe("DIV");return n.append(...e),n}function ii(t){var e="none"===Hn.style.display;t&&e?Hn.style.display="block":t||e||(Hn.style.display="none")}function ai(t,e=!1){var n=fe("DIV","nx-content"),i=null;e||(i=Wn);var a=!1;if(t){var r=[si(t),ri(t)];t.content.media&&t.content.media.url&&t.content.media.url.length&&(a=!0,r.push(bn(t,i))),n.append(...r)}return a||null===i||i(),n}function ri(t){var e=fe("DIV","nx-content-body");return e.append(ci(t,["content","main"]),ci(t,["content","aside"])),e}function si(t){var e=fe("DIV","nx-content-meta"),n=ci(t,["content","timestamp"]);return e.append(n),e}function di(t,e){var n=fe("DIV","nx-thread-header");return n.append(Ce(t,!0),function(t){return(kn=fe("DIV","nx-thread-description")).append(ci(t,["description"])),kn}(e)),n}function oi(t,e){return(wn=fe("DIV","nx-thread-blocks")).style.display="none",wn.append(Jn(e),Gn(t,e)),wn}function ci(t,e){var n=fe("DIV","nx-"+e.join("-"));return n.append(function(t,e=[]){if(t){for(var n=Object.assign({},t),i=0;i<e.length;i++)n=n[e[i]];if(M(n))return e.includes("timestamp")?n=new Date(n).toISOString().split("T")[0]:["description","main","aside","caption"].includes(e[e.length-1])&&(n=Le(n)),n}return""}(t,e)),n}function li(t){var e=Xn(t),n=fe("DIV","nx-main-block nx-thread");Rn(),e&&Fn.startSpin();var i=[di(t,e),Yn,oi(t.dataUrl,e)];return n.append(...i),Zt((function(t){qn(t)})),n}function ui(t){return xe(ve(),[ye([(e=t.state,Re(e),me("history",[Qe(),He],!1))],[en(t.state),li(t.state)],[fn(t.state,t.styleUrl,t.editMode)],"reader")]);var e}function hi(){var t=fe("BUTTON","nx-add-link");return t.type="button",t.textContent="+",t}function gi(t,e,n){var i=!1;C[n][1]<=e.length&&(i=!0),t.disabled!==i&&(t.classList.toggle("nx-disabled"),t.disabled=i)}const pi={image:["jpg","jpeg","gif","svg","png","webp"],video:["mp4","webm"],audio:["mp3"]},Ii=new CustomEvent("AutoUpdate"),Mi=new CustomEvent("StateChange"),vi=new CustomEvent("ThreadChange"),fi=new CustomEvent("IndexChange");function xi(t,e=!1){var n=t.classList.contains("nx-disabled");!e&&n?t.classList.remove("nx-disabled"):e&&!n&&t.classList.add("nx-disabled")}function yi(t,e,n){if(-1!==t.indexOf(e))for(var i=0;i<t.length;i++)if(i!==n&&t[i]===e)return!1;return!0}function mi(t,e,n){if(!yi(t,e=f(e).trim().replace(/[^A-Za-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),n)){var i,a=e.split("-"),r=a.pop();for(isNaN(r)?(a.push(r),i=1):(i=parseInt(r),i++),e=a.join("-");t.includes(e+"-"+i);)i++;e+="-"+i}return e}function Ni(t,e="nexus.json",n="/",i=-1){return{dataUrl:e,srcData:t,threadId:n,threadIndex:i}}function Di(){var t,e,n=v(10);return{nexus:x,author:{handle:"Anonymous-"+(t=100,e=999,Math.floor(Math.random()*(e-t+1)+t)),about:"",url:"http://"},threads:[Ei(n)],index:[n]}}function Ei(t){return{id:t,title:t,description:"...",content:{timestamp:(new Date).toISOString().substring(0,16),main:"...",aside:"",media:{url:"",type:"",caption:""}},linked:[]}}class Ti{constructor(t){this.EditState=t,this._setMenu()}getMenuElms(){return this.menu}setLastAction(t,e=!1){this.resetting&&!e||(this.lastAction.act=t,this.actCtrls.count=2,this.actCtrls.position=1,Ee(this.actCtrls),this.toggleSaveBtn(!1))}setResetting(t){this.resetting=t}toggleSaveBtn(t=!1){xi(this.saveBtn,t)}_displayFeedback(t){var e=Ut(t);this.feedbackrun&&clearTimeout(this.feedbackrun),le(this.actionFdbck,e,25),this.feedbackrun=setTimeout(function(){le(this.actionFdbck,"",25)}.bind(this),1500+20*e.length)}_resetData(t,e){var n=this.EditState.getJsonState();null===t&&(t=Di());var i=Ni(t,e);i.srcData.threads.length&&(i.threadIndex=0,i.threadId=i.srcData.threads[0].id);var a=JSON.stringify(i),r=function(t){var e;this.resetting=!0,e=t?a:n,this.EditState.setNewState(e),this.menu.dispatchEvent(Mi),this.filename=this.EditState.resolveFilename(),this.resetting=!1}.bind(this);r(!0),this.setLastAction(r,!0)}_setActionFeedback(){this.feedbackrun=null,this.actionFdbck=fe("SPAN","nx-action-feedback")}_setDownloadBtn(){this.filename="nexus.json",this.dlBtn=fe("A","nx-download"),this.dlBtn.append(be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjAuNTYyNSBMIDkuNzE4NzUgMTUuMjgxMjUgTCA4LjI4MTI1IDE2LjcxODc1IEwgMTUuMjgxMjUgMjMuNzE4NzUgTCAxNiAyNC40MDYyNSBMIDE2LjcxODc1IDIzLjcxODc1IEwgMjMuNzE4NzUgMTYuNzE4NzUgTCAyMi4yODEyNSAxNS4yODEyNSBMIDE3IDIwLjU2MjUgTCAxNyA0IFogTSA3IDI2IEwgNyAyOCBMIDI1IDI4IEwgMjUgMjYgWiIvPjwvc3ZnPg==",20)),this.dlBtn.addEventListener("click",function(){var t=Object.assign({},this.EditState.state.srcData);delete t.index,nt(t)||this._displayFeedback("Invalid Nexus data"),t=JSON.stringify(t,void 0,2);var e="data:text/json;charset=utf-8,"+encodeURIComponent(t),n=fe("A");n.setAttribute("href",e),n.setAttribute("download","nexus.json"),document.body.appendChild(n),n.click(),n.remove()}.bind(this))}_setNewDocumenBtn(){this.newBtn=fe("A","nx-new"),this.newBtn.append(be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA2IDMgTCA2IDI5IEwgMjYgMjkgTCAyNiA5LjU5Mzc1IEwgMjUuNzE4NzUgOS4yODEyNSBMIDE5LjcxODc1IDMuMjgxMjUgTCAxOS40MDYyNSAzIFogTSA4IDUgTCAxOCA1IEwgMTggMTEgTCAyNCAxMSBMIDI0IDI3IEwgOCAyNyBaIE0gMjAgNi40Mzc1IEwgMjIuNTYyNSA5IEwgMjAgOSBaIi8+PC9zdmc+",20)),this.newBtn.addEventListener("click",function(){this._resetData(Di(),"nexus.json")}.bind(this))}_setOpenBtn(){this._setFileInput(),this.openBtn=fe("A","nx-open-file"),this.openBtn.append(be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDMgTCA1IDI3LjgxMjUgTCA1Ljc4MTI1IDI3Ljk2ODc1IEwgMTcuNzgxMjUgMzAuNDY4NzUgTCAxOSAzMC43MTg3NSBMIDE5IDI4IEwgMjUgMjggTCAyNSAxNS40Mzc1IEwgMjYuNzE4NzUgMTMuNzE4NzUgTCAyNyAxMy40MDYyNSBMIDI3IDMgWiBNIDE0LjEyNSA1IEwgMjUgNSBMIDI1IDEyLjU2MjUgTCAyMy4yODEyNSAxNC4yODEyNSBMIDIzIDE0LjU5Mzc1IEwgMjMgMjYgTCAxOSAyNiBMIDE5IDE3LjA5Mzc1IEwgMTguNzE4NzUgMTYuNzgxMjUgTCAxNyAxNS4wNjI1IEwgMTcgNS43MTg3NSBaIE0gNyA1LjI4MTI1IEwgMTUgNy4yODEyNSBMIDE1IDE1LjkwNjI1IEwgMTUuMjgxMjUgMTYuMjE4NzUgTCAxNyAxNy45Mzc1IEwgMTcgMjguMjgxMjUgTCA3IDI2LjE4NzUgWiIvPjwvc3ZnPg==",20)),this.openBtn.addEventListener("click",function(){this.fileInput.click()}.bind(this)),this.openWrap=fe("SPAN"),this.openWrap.append(this.fileInput,this.openBtn)}_setFileInput(){this.fileInput=fe("INPUT"),this.fileInput.type="file",this.fileInput.accept="application/json",this.fileInput.addEventListener("change",function(t){var e=t.target.files[0].name;(function(t,e=!1){return t.target.files.length?"application/json"===t.target.files[0].type?new Promise(((n,i)=>{var a=new FileReader;return a.onload=function(t){var a=mt(t.target.result,e);a?n(a):i(new Error(400))},a.readAsText(t.target.files[0])})):(u("Invalid file type",t.target.files[0]),Promise.reject(new Error(400))):(u("No file selected"),Promise.reject(new Error(400)))})(t,!0).then((t=>{t.index=yt(t),this._resetData(t,e)})).catch((t=>{u(t.message),this._displayFeedback("Invalid source")})),this.fileInput.value=""}.bind(this)),this.fileInput.style.display="none"}_setSaveBtn(){this.saveBtn=fe("A","nx-save"),this.saveBtn.append(be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSA1IDUgTCA1IDI3IEwgMjcgMjcgTCAyNyA5LjU5Mzc1IEwgMjYuNzE4NzUgOS4yODEyNSBMIDIyLjcxODc1IDUuMjgxMjUgTCAyMi40MDYyNSA1IFogTSA3IDcgTCAxMCA3IEwgMTAgMTMgTCAyMiAxMyBMIDIyIDcuNDM3NSBMIDI1IDEwLjQzNzUgTCAyNSAyNSBMIDIzIDI1IEwgMjMgMTYgTCA5IDE2IEwgOSAyNSBMIDcgMjUgWiBNIDEyIDcgTCAxNiA3IEwgMTYgOSBMIDE4IDkgTCAxOCA3IEwgMjAgNyBMIDIwIDExIEwgMTIgMTEgWiBNIDExIDE4IEwgMjEgMTggTCAyMSAyNSBMIDExIDI1IFoiLz48L3N2Zz4=",20)),this.toggleSaveBtn(!0),this.saveBtn.addEventListener("click",function(){this.saveBtn.classList.contains("nx-disabled")||(Mt(this.EditState.cacheName,this.EditState.state.srcData),this._displayFeedback("saved"),this.toggleSaveBtn(!0),this._setResetStatus())}.bind(this))}_setResetStatus(){var t=!0;this.EditState.originData!==JSON.stringify(this.EditState.state.srcData)&&(t=!1),xi(this.resetBtn,t)}_setResetBtn(){this.resetBtn=fe("A","nx-reset"),this.resetBtn.append(be("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiAzIEMgMTIgMyA4LjQgNC43OTkyMTg3IDYgNy42OTkyMTg4IEwgNiA0IEwgNCA0IEwgNCAxMiBMIDEyIDEyIEwgMTIgMTAgTCA2LjgwMDc4MTIgMTAgQyA4LjgwMDc4MTIgNyAxMi4xIDUgMTYgNSBDIDIyLjEgNSAyNyA5LjkgMjcgMTYgQyAyNyAyMi4xIDIyLjEgMjcgMTYgMjcgQyA5LjkgMjcgNSAyMi4xIDUgMTYgTCAzIDE2IEMgMyAyMy4yIDguOCAyOSAxNiAyOSBDIDIzLjIgMjkgMjkgMjMuMiAyOSAxNiBDIDI5IDguOCAyMy4yIDMgMTYgMyB6Ii8+PC9zdmc+",20)),this._setResetStatus(),this.resetBtn.addEventListener("click",function(){this.resetBtn.classList.contains("nx-disabled")||(this._resetData(JSON.parse(this.EditState.originData),this.EditState.originUrl),xi(this.resetBtn,!0))}.bind(this))}_setEditNav(){this._setActionFeedback(),this._setResetBtn(),this._setNewDocumenBtn(),this._setOpenBtn(),this._setSaveBtn(),this._setDownloadBtn(),this.editLinks=fe("DIV"),this.editLinks.append(this.resetBtn,this.newBtn,this.openWrap,this.saveBtn,this.dlBtn),this.editNav=fe("DIV","nx-edit-nav"),this.editNav.append(this.actionFdbck,this.editLinks)}_setEditActions(){this.resetting=!1,this.lastAction={act:null},this.actCtrls={ctrls:{prev:{symbol:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxMi43ODEyNSA1LjI4MTI1IEwgNC43ODEyNSAxMy4yODEyNSBMIDQuMDkzNzUgMTQgTCA0Ljc4MTI1IDE0LjcxODc1IEwgMTIuNzgxMjUgMjIuNzE4NzUgTCAxNC4yMTg3NSAyMS4yODEyNSBMIDcuOTM3NSAxNSBMIDIxIDE1IEMgMjMuNzUzOTA2IDE1IDI2IDE3LjI0NjA5NCAyNiAyMCBMIDI2IDI3IEwgMjggMjcgTCAyOCAyMCBDIDI4IDE2LjE1NjI1IDI0Ljg0Mzc1IDEzIDIxIDEzIEwgNy45Mzc1IDEzIEwgMTQuMjE4NzUgNi43MTg3NSBaIi8+PC9zdmc+",elm:null},next:{symbol:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxOS4yMTg3NSA1LjI4MTI1IEwgMTcuNzgxMjUgNi43MTg3NSBMIDI0LjA2MjUgMTMgTCAxMSAxMyBDIDcuMTU2MjUgMTMgNCAxNi4xNTYyNSA0IDIwIEwgNCAyNyBMIDYgMjcgTCA2IDIwIEMgNiAxNy4yNDYwOTQgOC4yNDYwOTQgMTUgMTEgMTUgTCAyNC4wNjI1IDE1IEwgMTcuNzgxMjUgMjEuMjgxMjUgTCAxOS4yMTg3NSAyMi43MTg3NSBMIDI3LjIxODc1IDE0LjcxODc1IEwgMjcuOTA2MjUgMTQgTCAyNy4yMTg3NSAxMy4yODEyNSBaIi8+PC9zdmc+",elm:null}},position:0,count:1},this.editActions=fe("DIV","nx-edit-actions nx-history-nav"),Te(this.actCtrls,this._triggerUndoRedo.bind(this),!0),this.editActions.append(this.actCtrls.ctrls.prev.elm,this.actCtrls.ctrls.next.elm)}_triggerUndoRedo(t){this.lastAction.act("next"===t),this.toggleSaveBtn(!1)}_setMenu(){this._setEditNav(),this._setEditActions(),this.menu=fe("DIV","nx-edit-menu"),this.menu.append(this.editNav,this.editActions)}}class ji{constructor(t,e){this.EditState=t,this.EditMenu=e}inputElm(t,e=null,n=null){var i=this._fieldIdents(t),a=this._resolveInput(i,t),r=this._baseLabel(i.alias),s=fe("SPAN","nx-edit-indication"),d=this._invalidSp();r.append(s,d),this._setConditions(i,a,s),n&&(n[i.field]=a);var o=this._wrapInput(i,a,r);return this._setInputEvt(t,a,d,e),this._inputEvtHandler(t,a,d,e),o}_setConditions(t,e,n){switch(t.field){case"url":case"linked":n.textContent="[http]",e.pattern=O;break;case"id":n.textContent="[A-Za-z0-9-][3-36]",e.pattern=z;break;case"type":e.pattern="("+b.join("|")+")";break;case"timestamp":break;default:var i=S[t.field];n.textContent="["+i[0]+"-"+i[1]+"]",e.setAttribute("maxlength",i[1]),e.setAttribute("minlength",i[0])}}_wrapInput(t,e,n){var i=fe("DIV","nx-edit-input nx-edit-"+t.parent+"-"+t.field);return i.append(n),"type"===t.field?i.append(this._typeDropDown(e)):i.append(e),i}_typeDropDown(t){return je(b,t,null,"nx-edit-media-type-select")}_fieldIdents(t){var e={},n=t.length-1;return"linked"===t[n-1]&&n--,e.field=t[n],"threads"===t[--n-1]&&n--,e.parent=t[n],e.alias=e.field,"linked"===e.field&&(e.alias="url"),e}_isLongTextInput(t){return["about","description","main","aside","caption"].includes(t.field)}_isRequired(t){return["handle","title","main","id","url","type","timestamp","linked"].includes(t.field)}_resolveInput(t,e){var n,i=this.EditState.getValue(e);(n=this._isLongTextInput(t)?this._textareaInput(i):"timestamp"==t.field?this._dateInput(i):this._textInput(i)).classList.add("nx-edit-input");var a=e.join("-");return n.id=a,n.name=a,this._isRequired(t)&&(n.required=!0),n}_textInput(t){var e=fe("INPUT","nx-edit-text");return e.type="text",e.value=t,e}_textareaInput(t){var e=fe("TEXTAREA","nx-edit-textarea");return e.textContent=t,e}_dateInput(t){var e=fe("INPUT","nx-edit-date");return e.type="datetime-local",e.value=t,e}_baseLabel(t){var e=fe("LABEL","nx-edit-label");e.for=t;var n=fe("SPAN","nx-edit-title");return n.textContent=Ut(t),ge(n,t),e.append(n),e}_invalidSp(){var t=fe("SPAN","nx-edit-feedback");return t.append(be(sn)),t}_inputEvtHandler(t,e,n,i){var a=e.checkValidity(),r=null;if(a&&t.includes("url")||t.includes("linked"))(a=G(e.value))&&t.includes("linked")&&(a=yi(this.EditState.getLinkedUrls(t[1]),e.value,this.EditState.getLinkedThreadIdx(t[1],t[3])))&&(r=Nt(e.value).then((()=>!0)).catch((()=>!1)));else if(t.includes("id")){var s=mi(this.EditState.getIdsList(),e.value,this.EditState.getThreadIdx(t[1]));s!==e.value&&(e.value=s),a=!0}null===r&&(r=Promise.resolve(a)),r.then((a=>{this.EditState.setNewValue(t,e.value),this._setFeedbackIcon(n,a),"function"==typeof i&&i(e,a)}))}_setFeedbackIcon(t,e){var n=sn;e&&(n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyOC4yODEyNSA2LjI4MTI1IEwgMTEgMjMuNTYyNSBMIDMuNzE4NzUgMTYuMjgxMjUgTCAyLjI4MTI1IDE3LjcxODc1IEwgMTAuMjgxMjUgMjUuNzE4NzUgTCAxMSAyNi40MDYyNSBMIDExLjcxODc1IDI1LjcxODc1IEwgMjkuNzE4NzUgNy43MTg3NSBaIi8+PC9zdmc+"),t.firstChild.src=n}_setInputEvt(t,e,n,i){var a="",r=e.value;e.addEventListener("focus",(function(){r=e.value})),e.addEventListener("AutoUpdate",function(){this._inputEvtHandler(t,e,n,i)}.bind(this)),e.addEventListener("change",function(){this._inputEvtHandler(t,e,n,i);var s=function(s){s?e.value=a:(a=e.value,e.value=r),this._inputEvtHandler(t,e,n,i)}.bind(this);this.EditMenu.setLastAction(s)}.bind(this))}}class Ai{constructor(t){this.InputsFactory=t}newThreadLocalForm(t,e){var n=fe("FORM","nx-thread-local-form"),i=this._localFieldSet1(t,e),a=this._localFieldSet2(t),r=this._localFieldSet3(t);return n.append(Ne("local thread"),i,Ne("content"),a,Ne("media"),r),n}_localFieldSet1(t,e){var n=fe("FIELDSET");return n.append(this.InputsFactory.inputElm(["threads",t,"id"])),n.append(this.InputsFactory.inputElm(["threads",t,"title"],(function(t){var n=e.querySelector(".nx-thread-title");n.textContent!==t.value&&(n.textContent=t.value)}))),n.append(this.InputsFactory.inputElm(["threads",t,"description"])),n}_localFieldSet2(t){var e=fe("FIELDSET");return["timestamp","main","aside"].forEach((n=>{e.append(this.InputsFactory.inputElm(["threads",t,"content",n]))})),e}_localFieldSet3(t){var e=fe("FIELDSET"),n={type:null},i=this.InputsFactory.inputElm(["threads",t,"content","media","type"],null,n),a=function(t,e){if(e){var a=function(t){for(var e=0;e<L.length;e++)if(t.includes(L[e]))return L[e];var n=t.split(".").pop();for(let[t,e]of Object.entries(pi))if(e.includes(n))return t;return"page"}(t.value);if(n.type.value!==a){n.type.value=a;var r=i.querySelector(".nx-selected");r&&r.classList.remove("nx-selected"),i.querySelector("[data-item="+a+"]").classList.add("nx-selected"),n.type.dispatchEvent(Ii)}}}.bind(this);return e.append(this.InputsFactory.inputElm(["threads",t,"content","media","url"],a)),e.append(i),e.append(this.InputsFactory.inputElm(["threads",t,"content","media","caption"])),e}}class Si{constructor(t){this.EditState=t,this._setContainers(),this._setBtnSrc(),this._setMenu(),this._setFactories(),this._setAddThreadBtn(),this._setFormsInputs(),this._setFormBlocks(),this._setServiceElms()}getInstanceElms(){return this.instanceElms}_setBtnSrc(){this.btnSrc={up:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNiA0LjA5Mzc1IEwgMTUuMjgxMjUgNC43ODEyNSBMIDYuNzgxMjUgMTMuMjgxMjUgTCA4LjIxODc1IDE0LjcxODc1IEwgMTUgNy45Mzc1IEwgMTUgMjggTCAxNyAyOCBMIDE3IDcuOTM3NSBMIDIzLjc4MTI1IDE0LjcxODc1IEwgMjUuMjE4NzUgMTMuMjgxMjUgTCAxNi43MTg3NSA0Ljc4MTI1IFoiLz48L3N2Zz4=",down:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAxNSA0IEwgMTUgMjQuMDYyNSBMIDguMjE4NzUgMTcuMjgxMjUgTCA2Ljc4MTI1IDE4LjcxODc1IEwgMTUuMjgxMjUgMjcuMjE4NzUgTCAxNiAyNy45MDYyNSBMIDE2LjcxODc1IDI3LjIxODc1IEwgMjUuMjE4NzUgMTguNzE4NzUgTCAyMy43ODEyNSAxNy4yODEyNSBMIDE3IDI0LjA2MjUgTCAxNyA0IFoiLz48L3N2Zz4="}}_setContainers(){this.containers={author:fe("FORM","nx-edit-author"),index:fe("UL","nx-edit-index"),local:fe("UL","nx-edit-local"),distant:fe("UL","nx-edit-distant")}}_setMenu(){this.EditMenu=new Ti(this.EditState),this.menu=this.EditMenu.getMenuElms(),this.menu.addEventListener("StateChange",this._resetFormCallback.bind(this))}_setFactories(){this.InputsFactory=new ji(this.EditState,this.EditMenu),this.LocalFormFactory=new Ai(this.InputsFactory)}_setAddThreadBtn(){this.addThreadBtn=hi(),gi(this.addThreadBtn,this.EditState.getIdsList(),"threads"),this.addThreadBtn.addEventListener("click",this._addThreadHandler.bind(this))}_setServiceElms(){var t=fe("DIV","nx-main-block nx-index");t.append(this.formBlocks.author,this.formBlocks.index);var e,n=fe("DIV","nx-main-block nx-thread");n.append(this.formBlocks.local,this.formBlocks.distant),this.instanceElms=xe(((e=ve()).append(Me()),e),[ye([this.menu],[t,n],[],"edit")])}_setFormBlocks(){this.formBlocks={author:me("author",[this.containers.author],Ne("author")),index:me("threads-list",[this.containers.index,this.addThreadBtn],Ne("threads")),local:me("local",[this.containers.local],!1),distant:me("distant",[this.containers.distant],!1)}}_resetFormCallback(){Object.values(this.containers).forEach(((t,e)=>{var n=Array.from(t.childNodes),i=3===e,a=n.length-1;n.forEach(((t,e)=>{re(t,"fade",200,function(){t.remove(),i&&e===a&&this._setFormsInputs()}.bind(this))}))}))}_setFormsInputs(){this._setAuthorInputs(),this._setThreadsInputs()}_setAuthorInputs(){["handle","url","about"].forEach((t=>{var e=this.InputsFactory.inputElm(["author",t]);e.style.display="none",this.containers.author.append(e),se(e,"fade",200)}))}_setThreadsInputs(){var t=this.EditState.getIdsList();if(t.length)for(var e=!1,n=0;n<t.length;n++)n===t.length-1&&(e=!0),this._setThread(t[n],n,e)}_setThread(t,e,n=!1){var i=this.EditState.newIdent(t,e),a=this._newThreadLis(i);for(let[t,i]of Object.entries(a)){if("none"!==i.style.display){i.style.display="none";var r="ease";"local"===t&&(r="fade"),oe(this.containers[t],i,!1,r,200)}else this.containers[t].append(i);n&&"index"===t&&e-1!=-1&&this.containers.index.childNodes[e-1].dispatchEvent(fi)}}_newThreadLis(t){var e={};return e.distant=this._threadLi(t),e.local=this._threadLi(t),e.index=this._indexLi(t),e.distant.append(this._threadDistantForm(t)),e.local.append(this.LocalFormFactory.newThreadLocalForm(t,e.index)),this._setdeleteThreadElm(e,t),e}_addThreadHandler(){if(!this.addThreadBtn.disabled){var t=v(10),e=this.EditState.getThreadsCount();this.EditState.pushThread(Ei(t)),this._setThread(t,e,!0),this.EditMenu.toggleSaveBtn(!1),gi(this.addThreadBtn,this.EditState.getIdsList(),"threads")}}_linkInput(t,e,n,i){var a=this.EditState.registerLinkedThread(n,i),r=fe("DIV","nx-edit-distant-link"),s={linked:null},d=this.InputsFactory.inputElm(["threads",n,"linked",a],null,s),o=this._baseDeleteLinkBtn(),c=fe("DIV","nx-distant-link-action");return c.append(o),o.addEventListener("click",(()=>{var i=function(i){var d=this.EditState.getLinkedUrls(n);if(i)re(r,"ease",200,(function(){r.remove()})),this.EditState.removeLinkedThread(n,a);else{var o=this.EditState.getLinkedThreadIdx(n,a),c=o===d.length;if(this.EditState.insertLinkedThread(n,a,s.linked.value),c)oe(e,r,!1,"ease",200);else{var l=e.childNodes[o];e.insertBefore(r,l),se(r,"ease",200)}}gi(t,d,"linked")}.bind(this);this.EditMenu.setLastAction(i),i(!0)})),r.append(d,c),r}_threadDistantForm(t){var e=fe("FORM","nx-thread-distant-form"),n=hi();gi(n,this.EditState.getLinkedUrls(t),"linked"),n.addEventListener("click",(()=>{n.disabled||(this.EditState.pushLinkedThread(t,""),oe(e,this._linkInput(n,e,t,this.EditState.getLinkedUrlsCount(t)-1),!1,"ease",200),gi(n,this.EditState.getLinkedUrls(t),"linked"))}));var i=this.EditState.getLinkedUrlsCount(t);if(i){for(var a=[],r=0;r<i;r++){var s=this._linkInput(n,e,t,r);a.push(s)}e.append(...a)}var d=fe("DIV");return d.append(Ne("linked threads"),e,n),d}_threadLi(t){var e=fe("LI");return this.EditState.isCurrentId(t)||(e.style.display="none"),e.addEventListener("ThreadChange",function(){this.EditState.isCurrentId(t)?setTimeout((function(){se(e,"ease",200)}),200):re(e,"ease",200)}.bind(this)),e}_setdeleteThreadElm(t,e){var n=fe("BUTTON","nx-delete-thread");n.type="button",n.textContent="-",n.addEventListener("click",function(){this._deleteEvent(t,e)}.bind(this)),t.index.append(n)}_deleteEvent(t,e){var n=Object.assign({},this.EditState.getThreadData(e)),i=function(i){var a=this.EditState.getThreadIdx(e),r=this.EditState.getThreadsCount();if(i){if(this.EditState.removeThread(e),Object.values(t).forEach((t=>{re(t,"ease",200,(function(){t.remove()}))})),r>1){var s=null;0===a?s=t.index.nextSibling:a===r-1&&(s=t.index.previousSibling),s&&s.dispatchEvent(fi)}this.EditState.isCurrentId(e)&&(t.distant.dispatchEvent(vi),t.local.dispatchEvent(vi))}else{if(this.EditState.insertThread(e,n),a<=r-1){var d=this.containers.index.childNodes[a];this.containers.index.insertBefore(t.index,d),0===a&&d.dispatchEvent(fi)}else this.containers.index.append(t.index),r>1&&t.index.previousSibling.dispatchEvent(fi);this.containers.local.append(t.local),this.containers.distant.append(t.distant),se(t.index,"ease",200),t.index.firstChild.click()}gi(this.addThreadBtn,this.EditState.getIdsList(),"threads")}.bind(this);this.EditMenu.setLastAction(i),i(!0)}_indexLi(t){var e=fe("LI");return e.dataset.ident=t,e.append(this._indexLink(t)),this._setMoveBtns(e,t),e}_indexLink(t){var e=Se(this.EditState.getAltEditState(t),!1);return this.EditState.isCurrentId(t)&&e.classList.add("nx-on-display"),e.addEventListener("click",(()=>{if(!this.EditState.isCurrentId(t)){this.EditState.changeCurrentThread(t);var n=this.containers.index.querySelector(".nx-on-display");n&&n.classList.remove("nx-on-display"),e.classList.add("nx-on-display"),this.containers.local.childNodes.forEach((t=>{t.dispatchEvent(vi)})),this.containers.distant.childNodes.forEach((t=>{t.dispatchEvent(vi)}))}})),e}_toggleActiveBtn(t,e){this.EditState.isFirstThread(t)?xi(e.up,!0):xi(e.up,!1),this.EditState.isLastThread(t)?xi(e.down,!0):xi(e.down,!1)}_permuteThread(t,e){this.containers.index.removeChild(t),this.containers.index.insertBefore(t,e),e.dispatchEvent(fi),t.dispatchEvent(fi)}_moveItemHandler(t,e,n){var i=function(i){var a,r="up"==e;i||(r=!r),r&&!this.EditState.isFirstThread(n)?(a=t.previousSibling,this.EditState.moveThread(n,a.dataset.ident,!0),this._permuteThread(t,a)):r||this.EditState.isLastThread(n)||(a=t.nextSibling,this.EditState.moveThread(n,a.dataset.ident,!1),this._permuteThread(a,t))}.bind(this);this.EditMenu.setLastAction(i),i(!0)}_setMoveBtns(t,e){var n=fe("DIV","nx-edit-move"),i={up:null,down:null};t.addEventListener("IndexChange",function(){this._toggleActiveBtn(e,i)}.bind(this)),Object.keys(i).forEach((a=>{i[a]=fe("A","nx-edit-move-"+a),i[a].append(be(this.btnSrc[a],16)),n.append(i[a]),i[a].addEventListener("click",function(){this._moveItemHandler(t,a,e)}.bind(this))})),this._toggleActiveBtn(e,i),t.append(n)}_baseDeleteLinkBtn(){var t=fe("BUTTON","nx-delete-link");return t.type="button",t.textContent="-",t}}class Ci{constructor(t,e,n){this.editInst=t,this.readerInst=e,this.readerUpdatePromise=n,this.previewOn=!1,this._setSwitchBtn()}getSwitchBtn(){return this.switchBtn}_instanceSwitch(){this.previewOn=!this.previewOn,this.previewOn?re(this.editInst,"fade",200,function(){this.readerUpdatePromise().then((()=>{this.switchBtn.firstChild.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PHBhdGggZD0iTSAyMy45MDYyNSAzLjk2ODc1IEMgMjIuODU5Mzc1IDMuOTY4NzUgMjEuODEyNSA0LjM3NSAyMSA1LjE4NzUgTCA1LjE4NzUgMjEgTCA1LjEyNSAyMS4zMTI1IEwgNC4wMzEyNSAyNi44MTI1IEwgMy43MTg3NSAyOC4yODEyNSBMIDUuMTg3NSAyNy45Njg3NSBMIDEwLjY4NzUgMjYuODc1IEwgMTEgMjYuODEyNSBMIDI2LjgxMjUgMTEgQyAyOC40Mzc1IDkuMzc1IDI4LjQzNzUgNi44MTI1IDI2LjgxMjUgNS4xODc1IEMgMjYgNC4zNzUgMjQuOTUzMTI1IDMuOTY4NzUgMjMuOTA2MjUgMy45Njg3NSBaIE0gMjMuOTA2MjUgNS44NzUgQyAyNC40MTAxNTYgNS44NzUgMjQuOTE3OTY5IDYuMTA1NDY5IDI1LjQwNjI1IDYuNTkzNzUgQyAyNi4zNzg5MDYgNy41NjY0MDYgMjYuMzc4OTA2IDguNjIxMDk0IDI1LjQwNjI1IDkuNTkzNzUgTCAyNC42ODc1IDEwLjI4MTI1IEwgMjEuNzE4NzUgNy4zMTI1IEwgMjIuNDA2MjUgNi41OTM3NSBDIDIyLjg5NDUzMSA2LjEwNTQ2OSAyMy40MDIzNDQgNS44NzUgMjMuOTA2MjUgNS44NzUgWiBNIDIwLjMxMjUgOC43MTg3NSBMIDIzLjI4MTI1IDExLjY4NzUgTCAxMS4xODc1IDIzLjc4MTI1IEMgMTAuNTMxMjUgMjIuNSA5LjUgMjEuNDY4NzUgOC4yMTg3NSAyMC44MTI1IFogTSA2LjkzNzUgMjIuNDM3NSBDIDguMTM2NzE5IDIyLjkyMTg3NSA5LjA3ODEyNSAyMy44NjMyODEgOS41NjI1IDI1LjA2MjUgTCA2LjI4MTI1IDI1LjcxODc1IFoiLz48L3N2Zz4=",se(this.readerInst,"fade",200)}))}.bind(this)):re(this.readerInst,"fade",200,function(){this.switchBtn.firstChild.src=rn,se(this.editInst,"fade",200)}.bind(this))}_setSwitchBtn(){this.switchBtn=fe("A","nx-edit-switch"),this.switchBtn.append(be(rn,25)),this.switchBtn.addEventListener("click",this._instanceSwitch.bind(this))}}class Li{constructor(t){var e="new",n="nexus.json",i=!1;_("edit")&&(e="current",t&&(t.dataUrl&&(n=t.dataUrl),t.srcData&&(i=!0))),this.cacheName=e+"#"+n,this.originUrl=n;var a=function(t){return gt(It+t,"local")}(this.cacheName),r=!1;null===a&&(r=!0,a=i?t.srcData:Di()),a.index||(r=!0,a.index=yt(a)),r&&Mt(this.cacheName,a);var s=a;i&&(s=t.srcData),this.originData=JSON.stringify(s);var d="/",o=-1;i&&"/"!==t.threadId&&a.index.includes(t.threadId)?(d=t.threadId,o=a.index.indexOf(t.threadId)):a.threads.length&&(d=a.threads[0].id,o=0),this.state=Ni(a,n,d,o),this.threadsMap={}}getState(){return this.state}getOriginData(){return this.originData}getJsonState(){return JSON.stringify(this.state)}getAltEditState(t){return Qt(this.state,this.getThreadId(t),this.getThreadIdx(t))}setNewState(t){this.state=Object.assign({},JSON.parse(t))}setAuthorValue(t,e){this.state.srcData.author||(this.state.srcData.author={}),this.state.srcData.author[t[1]]=e}setThreadIndex(t){if(this.state.srcData.threads){var e=this.getThreadIdx(t);void 0===this.state.srcData.threads[e]&&(this.state.srcData.threads[e]={})}else this.state.srcData.threads=[]}setThreadId(t,e){this.threadsMap[t[1]].id=e;var n=this.getThreadIdx(t[1]);this.state.srcData.index[n]=e,this.state.srcData.threads[n].id=e}setThreadInfo(t,e){var n=this.getThreadIdx(t[1]);this.state.srcData.threads[n][t[2]]=e}setContentValue(t,e){var n=this.getThreadIdx(t[1]);this.state.srcData.threads[n].content||(this.state.srcData.threads[n].content={}),"media"===t[3]?(this.state.srcData.threads[n].content.media||(this.state.srcData.threads[n].content.media={}),this.state.srcData.threads[n].content.media[t[4]]=e):this.state.srcData.threads[n].content[t[3]]=e}setLinkedValue(t,e){var n=this.getThreadIdx(t[1]);if(this.state.srcData.threads[n].linked){var i=this.getLinkedThreadIdx(t[1],t[3]);this.state.srcData.threads[n].linked[i]=e}else this.state.srcData.threads[n].linked=[e]}setNewValue(t,e){return null===this.state.srcData&&(this.state.srcData={},this.state.srcData.index=[]),"author"===t[0]?this.setAuthorValue(t,e):(this.setThreadIndex(t[1]),"id"===t[2]?this.setThreadId(t,e):["linked","content"].includes(t[2])?"content"===t[2]?this.setContentValue(t,e):void this.setLinkedValue(t,e):this.setThreadInfo(t,e))}getValue(t){if(this.state.srcData){if("author"===t[0])return this.state.srcData.author[t[1]];var e=this.getThreadIdx(t[1]);if(!["linked","content"].includes(t[2]))return this.state.srcData.threads[e][t[2]];if("content"===t[2])return"media"!==t[3]?this.state.srcData.threads[e].content[t[3]]:this.state.srcData.threads[e].content.media[t[4]];var n=this.getLinkedThreadIdx(t[1],t[3]);return this.state.srcData.threads[e].linked[n]}return""}getThreadId(t){return this.threadsMap[t].id}getThreadIdx(t){var e=this.threadsMap[t].idx,n=this.getThreadsCount();return e>=n&&(e=n-1,this.threadsMap[t].idx=e,this.isCurrentId(t)&&(this.state.threadIndex=e)),e}getIdsList(){return this.state.srcData.index}getThreadsCount(){return this.state.srcData.index.length}getCurrentThreadId(){return this.state.threadId}getCurrentThreadIdx(){return this.state.threadIndex}isCurrentId(t){return this.threadsMap[t].id===this.state.threadId}resolveFilename(){var t="nexus.json";if(this.state.dataUrl&&this.state.dataUrl!==t){var e=this.state.dataUrl.split("/").filter((t=>t));e.length&&(".json"!==(t=e.pop()).slice(-5)&&(t+=".json"),t=f(t))}return t}unsetCurrentThread(){this.state.threadId="/",this.state.threadIndex=-1}isFirstThread(t){return 0===this.getThreadIdx(t)}isLastThread(t){return this.getThreadIdx(t)+1===this.getThreadsCount()}getThreadData(t){var e=this.getThreadIdx(t),n=this.state.srcData.threads[e];return n||(this.state.srcData.threads[e]={}),n}removeThread(t){var e=this.getThreadIdx(t);if(this.state.srcData.index.splice(e,1),this.state.srcData.threads.splice(e,1),!this.isLastThread(t))for(let[t,n]of Object.entries(this.threadsMap))n.idx>e&&(this.threadsMap[t].idx=n.idx-1);this.isCurrentId(t)?this.unsetCurrentThread():this.state.threadIndex>e&&this.state.threadIndex--}insertThread(t,e){if(this.isLastThread(t))this.pushThread(e);else{var n=this.getThreadIdx(t);this.state.srcData.index.splice(n,0,e.id),this.state.srcData.threads.splice(n,0,e);for(let[t,i]of Object.entries(this.threadsMap))i.id!==e.id&&i.idx>=n&&(this.threadsMap[t].idx=i.idx+1);this.state.threadIndex>=n&&this.state.threadIndex++}}newIdent(t,e){var n=v(21);return this.threadsMap[n]={id:t,idx:e,linked:{}},n}changeCurrentThread(t){this.state.threadId=this.getThreadId(t),this.state.threadIndex=this.getThreadIdx(t)}moveThread(t,e,n=!1){var i=this.getThreadIdx(t),a=i+1;n&&(a=i-1),this.state.srcData.index.splice(a,0,this.state.srcData.index.splice(i,1)[0]),this.state.srcData.threads.splice(a,0,this.state.srcData.threads.splice(i,1)[0]),this.threadsMap[t].idx=a,this.threadsMap[e].idx=i,this.isCurrentId(t)?this.state.threadIndex=a:this.isCurrentId(e)&&(this.state.threadIndex=i)}pushThread(t){this.state.srcData.threads.push(t),this.state.srcData.index.push(t.id)}getLinkedThreadIdx(t,e){var n=this.threadsMap[t].linked[e].idx,i=this.getLinkedUrlsCount(t);return n>=i&&(n=i-1,this.threadsMap[t].linked[e].idx=n),n}getLinkedUrls(t){var e=this.getThreadData(t);if(!Object.prototype.hasOwnProperty.call(e,"linked")){var n=this.getThreadIdx(t);return this.state.srcData.threads[n].linked=[],[]}return e.linked}getLinkedUrlsCount(t){return this.getLinkedUrls(t).length}registerLinkedThread(t,e){var n=v(21);return this.threadsMap[t].linked[n]={idx:e},n}isLastLinkedThread(t,e){return this.getLinkedThreadIdx(t,e)===this.getLinkedUrlsCount(t)-1}removeLinkedThread(t,e){var n=this.getThreadIdx(t),i=this.getLinkedThreadIdx(t,e);if(i===this.getLinkedUrlsCount(t)-1)this.state.srcData.threads[n].linked.pop();else{this.state.srcData.threads[n].linked.splice(i,1);for(let[e,n]of Object.entries(this.threadsMap[t].linked))n.idx>i&&(this.threadsMap[t].linked[e].idx=n.idx-1)}}pushLinkedThread(t,e){var n=this.getThreadIdx(t);this.state.srcData.threads[n].linked||(this.state.srcData.threads[n].linked=[]),this.state.srcData.threads[n].linked.push(e)}insertLinkedThread(t,e,n){if(this.isLastLinkedThread(t,e))this.pushLinkedThread(t,n);else{var i=this.getThreadIdx(t),a=this.getLinkedThreadIdx(t,e);this.state.srcData.threads[i].linked.splice(a,0,n);for(let[n,i]of Object.entries(this.threadsMap[t].linked))i.idx>=a&&n!==e&&(this.threadsMap[t].linked[n].idx=i.idx+1)}}}function bi(t,e){var n=document.createElement("DIV");return n.className="nx",n.append(e),t.append(n),n}function zi(t,e){re(t,"ease",200,(function(){t.textContent="",t.append(e),se(t,"ease",200)}))}function Oi(){var t=De();t.classList.add("nx-instance"),At({appDefaultLang:"en",appDefaultCss:nn,appDefaultCssAliases:an}).then((e=>{var n,i,a;n=e.request.lang,Lt||Ot(n),e.state=Ft(e.request.url,e.request.id,e.nxdata),i=e.state,!kt.dataUrl&&(kt=i),e.editMode=!1,_("edit")||_("new")?(e.editMode=!0,a=function(t){var e=new Li(t.state),n=new Si(e).getInstanceElms(),i=ui({editMode:!0,state:Object.assign({},e.getState())});i.style.display="none";var a=new Ci(n,i,(function(){return Vt(e.state,!0,!0),new Promise((function(t){setTimeout(t,100)}))})).getSwitchBtn(),r=fe("DIV","nx-editor");return r.append(n,i,a),r}(e)):a=ui(e);var r=bi(e.nxelm,a),s=!0;e.nxelm.addEventListener("change",(function(){if(e.nxelm.dataset.srcdoc){var n=mt(e.nxelm.dataset.srcdoc,"editor"===e.request.mode);n?(e.nxdata=n,e.state=Ft(e.request.url,e.request.id,e.nxdata),s?Vt(e.state,!0,!0):(s=!0,zi(r,a))):s&&(s=!1,zi(r,t))}}))})).catch((e=>{u(e.message),bi(jt(),t)}))}}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},Promise.resolve().then(n.bind(n,898)).then((t=>{t.init()}))})();