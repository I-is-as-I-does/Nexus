/*! Nexus | (c) 2021 I-is-as-I-does | AGPLv3 license */
"use strict";(self.webpackChunknexus=self.webpackChunknexus||[]).push([[22],{625:(t,e,n)=>{n.d(e,{N:()=>tt});var a=n(696),d=n(425),i=n(931),r=n(947),c=n(180),l=n(75),o=n(85),s=n(451),u=n(253);function p(){var t=(0,r.O1)(10);return{nexus:a.Gd,author:{handle:"Anonymous-"+(0,r.Iy)(100,999),about:"",url:""},threads:[h(t)],index:[t]}}function h(t){return{id:t,name:t,description:"...",record:{timestamp:(new Date).toISOString().substr(0,16),main:"...",aside:"",media:{url:"",type:"",caption:""}},linked:[]}}var v=n(549),f=n(142);function x(t,e){for(var n=(0,d.gd)("P","nx-edit-category"),a=0;a<e;a++){var i=(0,d.gd)("SPAN","nx-edit-category-indent");i.textContent="|",n.append(i)}var r=(0,d.gd)("SPAN");return r.textContent=(0,l.GY)(t),(0,f.w)(r,t),n.append(r),n}function g(){var t=(0,d.gd)("BUTTON","nx-add-link");return t.type="button",t.textContent="+",t}const D=["youtube","vimeo","soundcloud"],m={image:["jpg","jpeg","gif","svg","png","webp"],video:["mp4","webm"],audio:["mp3"]};function b(t){return{dataUrl:"nx-edit",srcData:t,threadId:"/",threadIndex:-1}}const k=(0,c.hb)();var E,I,y,C={dataUrl:"nx-edit",srcData:null,threadId:"/",threadIndex:-1},N=new CustomEvent("IndexChange"),O=!1,T={ctrls:{prev:{symbol:"↶",elm:null},next:{symbol:"↷",elm:null}},position:0,count:1},L=[],S=null,w=null,U=null,V={up:"↑",down:"↓"},j={handle:null,url:null,about:null};function A(t,e){C.srcData.index.splice(e,0,C.srcData.index.splice(t,1)[0]),C.srcData.threads.splice(e,0,C.srcData.threads.splice(t,1)[0])}function P(t,e){var n=C.srcData.index.indexOf(t);e.up.disabled=0==n,n+1==C.srcData.index.length?e.down.disabled=!0:e.down.disabled=!1}function B(t,e){S.removeChild(t),S.insertBefore(t,e),e.dispatchEvent(N),t.dispatchEvent(N)}function F(t,e,n){var a=(0,d.gd)("DIV","nx-distant-link"),c={url:null,id:null,list:(0,d.gd)("DIV","nx-distant-ids")},l={id:null,url:null};c.id=G(["threads",e,"linked",n,"id"],null,l),c.url=G(["threads",e,"linked",n,"url"],(function(t,e){!function(t,e,n,a){var i=function(n=[]){var a=t.id.value;a&&n.includes(a)||(t.id.value="/"),"/"!=a&&n.unshift("/"),t.id.pattern="("+n.join("|")+")";var i=(0,d.Sb)(n,t.id,null,"nx-edit-linked-id");e.id.lastChild.replaceWith(i)};n&&a?(0,v.P)(n).then((t=>{i(Array.from(t.index))})).catch((()=>{t.url.pattern=urlPattern+"(?<!"+(0,r.hr)(n)+")",t.url.dispatchEvent(new window.Event("change"))})):i()}(l,c,t,e)}),l),Object.values(c).forEach((t=>{t&&(0,i.am)(a,t,!1,!0,200)}));var o,s=((o=(0,d.gd)("BUTTON","nx-delete-link")).type="button",o.textContent="-",o),u=(0,d.gd)("DIV","nx-distant-link-action");u.append(s),a.append(u),s.addEventListener("click",(()=>{var d=function(d){if(d)(0,i.Vv)(a,200,(function(){a.remove()}));else if(n==C.srcData.threads[e].linked.length-1)(0,i.am)(t,a,!1,!0,200);else{var r=t.childNodes[n];t.insertBefore(a,r),(0,i.YQ)(a,200)}};Q(d),d(!0)})),t.append(a)}function W(t,e){var n=(0,d.gd)("LI");return n.append(e),C.threadId!=t&&(n.style.display="none"),(0,c.Ek)((function(e){"nx-edit"==e.dataUrl&&(C=e,e.threadId==t?setTimeout((function(){(0,i.YQ)(n,200)}),200):(0,i.Vv)(n,200))})),n}function Y(t,e){var n=Object.assign({},C);return n.threadId=e,n.threadIndex=t,n}function M(t,e){var n={index:{parent:S,child:null,link:null,del:null},local:{parent:w,child:null},distant:{parent:U,child:null}};return n.index.child=(0,d.gd)("LI"),n.index.link=function(t,e){var n=Y(t,e),a=(0,d.j1)(n,!1);return(0,d.Zx)(a,n),a.addEventListener("click",(()=>{var t=C.srcData.index.indexOf(e);(0,c.f2)(Y(t,e),!0)})),a}(t,e),n.index.child.append(n.index.link),function(t,e){var n=(0,d.gd)("DIV","nx-edit-move"),a={up:null,down:null};t.addEventListener("IndexChange",(function(){P(e,a)})),Object.keys(a).forEach((i=>{a[i]=(0,d.gd)("BUTTON","nx-edit-move-"+i),a[i].type="button",a[i].textContent=V[i],n.append(a[i]),a[i].addEventListener("click",(function(){!function(t,e,n){var a=function(a){var d=C.srcData.index.indexOf(n),i="up"==e;a||(i=!i),i&&0!=d?(A(d,d-1),B(t,t.previousSibling)):i||d+1==C.srcData.index.length||(A(d,d+1),B(t.nextSibling,t))};Q(a),a(!0)}(t,i,e)}))})),P(e,a),t.append(n)}(n.index.child,e),n.distant.child=W(e,function(t,e){var n=(0,d.gd)("FORM","nx-thread-distant-form"),a=C.srcData.threads[t].linked;if(a.length)for(var i=0;i<a.length;i++)F(n,t,i);var r=(0,d.gd)("DIV"),c=g();return c.addEventListener("click",(()=>{var t=C.srcData.index.indexOf(e),a=C.srcData.threads[t].linked.length;C.srcData.threads[t].linked.push({url:"",id:"/"}),F(n,t,a)})),r.append(n,c),r}(t,e)),n.local.child=W(e,function(t,e){var n=(0,d.gd)("FORM","nx-thread-local-form"),a=(0,d.gd)("FIELDSET");a.append(G(["threads",t,"name"],e)),a.append(G(["threads",t,"description"]));var i=(0,d.gd)("FIELDSET");i.append(x("record",1)),["timestamp","main","aside"].forEach((e=>{i.append(G(["threads",t,"record",e]))}));var r=(0,d.gd)("FIELDSET");return r.append(x("media",2)),r.append(G(["threads",t,"record","media","url"],(function(t,e){e&&function(t,e){var n=t.querySelector(".nx-select-list li[data-item="+function(t){for(var e=0;e<D.length;e++)if(t.includes(D[e]))return D[e];var n=t.split(".").pop();for(let[t,e]of Object.entries(m))if(e.includes(n))return t;return"page"}(e)+"]");n&&n.click()}(r,t)}))),["type","caption"].forEach((e=>{r.append(G(["threads",t,"record","media",e]))})),n.append(a,i,r),n}(t,(function(e,a){if(a){var d=(i=e,(0,r.V7)(i.trim().replace(/[\s_]/,"-")));n.index.link.firstChild.textContent=d,R(["threads",t,"id"],d)}var i}))),n.index.del=function(t,e,n){var a=(0,d.gd)("BUTTON","nx-delete-thread");return a.type="button",a.textContent="-",a.addEventListener("click",(function(){!function(t,e,n){var a=C.srcData.index.indexOf(n),d=S.childNodes[a],r=C.srcData.index.length,c={index:n,threads:C.srcData.threads[a]},l=function(n){if(n)Object.keys(c).forEach((t=>{C.srcData[t].splice(a,1)})),C.threadId="/",C.threadIndex=-1,[e,t,d].forEach((t=>{(0,i.Vv)(t,200,(function(){t.remove()}))})),r>1&&(0===a?d.nextSibling.dispatchEvent(N):a===r-1&&d.previousSibling.dispatchEvent(N));else{if(Object.keys(c).forEach((t=>{C.srcData[t].splice(a,0,c[t])})),a<r-1){var l=S.childNodes[a];S.insertBefore(d,l),0===a&&l.dispatchEvent(N)}else S.append(d),r>1&&d.previousSibling.dispatchEvent(N);(0,i.YQ)(d,200),w.append(t),U.append(e),d.firstChild.click()}};Q(l),l(!0)}(t,e,n)})),a}(n.local.child,n.distant.child,e),n.index.child.append(n.index.del),n}function Q(t){T.position!=T.count-1&&(L.splice(T.position),T.count=L.length+1),10===T.count?L.splice(0,1):T.count++,L.push(t),T.position=T.count-1,(0,d.eV)(T),I.disabled=!1}function R(t,e){return C.srcData||(C.srcData={}),"author"==t[0]?function(t,e){C.srcData.author||(C.srcData.author={}),C.srcData.author[t[1]]=e}(t,e):(function(t){C.srcData.threads?void 0===C.srcData.threads[t[1]]&&(C.srcData.threads[t[1]]={}):C.srcData.threads=[]}(t),["linked","record"].includes(t[2])?("record"==t[2]&&function(t,e){C.srcData.threads[t[1]].record||(C.srcData.threads[t[1]].record={}),"media"==t[3]?(C.srcData.threads[t[1]].record.media||(C.srcData.threads[t[1]].record.media={}),C.srcData.threads[t[1]].record.media[t[4]]=e):C.srcData.threads[t[1]].record[t[3]]=e}(t,e),void function(t,e){C.srcData.threads[t[1]].linked?void 0===C.srcData.threads[t[1]].linked[t[3]]&&(C.srcData.threads[t[1]].linked[t[3]]={}):C.srcData.threads[t[1]].linked=[],C.srcData.threads[t[1]].linked[t[3]][t[4]]=e}(t,e)):function(t,e){C.srcData.threads[t[1]][t[2]]=e}(t,e))}function G(t,e=null,n=null){var i,r=function(t){return C.srcData?"author"==t[0]?C.srcData[t[0]][t[1]]:["linked","record"].includes(t[2])?"record"==t[2]?"media"!=t[3]?C.srcData.threads[t[1]].record[t[3]]:C.srcData.threads[t[1]].record.media[t[4]]:C.srcData.threads[t[1]].linked[t[3]][t[4]]:C.srcData.threads[t[1]][t[2]]:""}(t),c=t[t.length-1],o=t[t.length-2];Number.isInteger(o)&&(o=t[t.length-3]),i=["about","description","main","aside","caption"].includes(c)?function(t){var e=(0,d.gd)("TEXTAREA","nx-edit-textarea");return e.textContent=t,e}(r):"timestamp"==c?function(t){var e=(0,d.gd)("INPUT");return e.type="datetime-local",e.value=t,e}(r):function(t){var e=(0,d.gd)("INPUT","nx-edit-text");return e.type="text",e.value=t,e}(r);var s=t.join("-");i.id=s,i.name=s,["handle","name","main","id","url","type","timestamp"].includes(c)&&(i.required=!0);var u=function(t){var e=(0,d.gd)("LABEL","nx-edit-label");e.for=t;var n=(0,d.gd)("SPAN","nx-edit-title");return n.textContent=(0,l.GY)(t),(0,f.w)(n,t),e.append(n),e}(c),p=(0,d.gd)("SPAN","nx-edit-indication"),h=(0,d.gd)("SPAN","nx-edit-feedback");switch(u.append(p,h),c){case"url":p.textContent="[http]",i.pattern=a.Ni;break;case"id":t.includes("linked")?i.pattern=a.bt:i.pattern=a.Q1;break;case"type":i.pattern="("+a.WS.join("|")+")";break;case"timestamp":break;default:var v=a.m2[c];p.textContent="["+v[0]+"-"+v[1]+"]",i.setAttribute("maxlength",v[1]),i.setAttribute("minlength",v[0])}n&&(n[c]=i);var x=(0,d.gd)("DIV","nx-edit-input nx-edit-"+o+"-"+c);if(x.append(u),"type"==c||"id"==c&&"linked"==t[2]){var g=[];"type"==c?g=a.WS:(g=["/"],"/"!=r&&g.push(r)),x.append((0,d.Sb)(g,i,null,"nx-edit-"+t[2]+"-"+c))}else x.append(i);return function(t,e,n,a){var d="",i=e.value;e.addEventListener("focus",(function(){i=e.value})),e.addEventListener("change",(function(){H(t,e,n,a),Q((function(r){r?e.value=d:(d=e.value,e.value=i),H(t,e,n,a)}))}))}(t,i,h,e),H(t,i,h,e),x}function H(t,e,n,a){var d=!1;e.checkValidity()?(d=!0,R(t,e.value),n.textContent="✓"):n.textContent="✗","function"==typeof a&&a(e.value,d)}function q(t){if(!O){var e=T.position,n=!1;"next"==t&&(e-=1,n=!0),L[e](n),setTimeout(function(){O=!1}.bind(this),k),I.disabled=!1}}function J(t){var e=Object.assign({},C.srcData),n=function(n){var a;a=n?t:e,C.srcData.threads.length&&[S,w,U].forEach((t=>{Array.from(t.childNodes).forEach((t=>{(0,i.Vv)(t,100,(function(){t.remove()}))}))})),C=b(a),function(){for(let[t,e]of Object.entries(j))e.value=C.srcData.author[t]}(),Z()};Q(n),n(!0)}function X(t){(0,i.Po)(y,(0,l.GY)(t),20),setTimeout((function(){(0,i.Po)(y,"",20)}),3e3)}function Z(){var t,e=C.srcData.index;if(e.length)for(var n=0;n<e.length;n++)void 0,t=M(n,e[n]),Object.values(t).forEach((t=>{t.parent.append(t.child)}))}function $(){var t,e=(0,d.gd)("DIV","nx-edit-menu");return e.append(function(){var t=(0,d.gd)("DIV","nx-edit-nav");y=(0,d.gd)("SPAN","nx-action-feedback"),(I=(0,d.gd)("BUTTON","nx-save")).type="button",I.textContent="🖫",I.disabled=!0,I.addEventListener("click",(function(){I.disabled||((0,o.EW)(C.srcData),I.disabled=!0,X("saved"))}));var e,n,a=(0,d.gd)("DIV");return a.append(((n=(0,d.gd)("BUTTON","nx-new")).type="button",n.textContent="🗋",n.addEventListener("click",(function(){J(p())})),n),function(){var t=(0,d.gd)("INPUT");t.type="file",t.accept="application/json",t.addEventListener("change",(function(t){(0,v.e)(t).then((t=>{J(t)})).catch((()=>{X("Invalid source")}))})),t.style.display="none";var e=(0,d.gd)("BUTTON","nx-open-file");e.type="button",e.textContent="🗁",e.addEventListener("click",(function(){t.click()}));var n=(0,d.gd)("SPAN");return n.append(t,e),n}(),I,((e=(0,d.gd)("BUTTON","nx-download")).type="button",e.textContent="⇣",e.addEventListener("click",(function(t){var e=Object.assign({},C.srcData);delete e.index,(0,s.wJ)(e)||X("Invalid Nexus data"),e=JSON.stringify(e,void 0,2);var n="data:text/json;charset=utf-8,"+encodeURIComponent(e),a=(0,d.gd)("A");a.setAttribute("href",n),a.setAttribute("download","Nexus.json"),(0,u.X)().appendChild(a),a.click(),a.remove()})),e)),t.append(y,a),t}(),(t=(0,d.gd)("DIV","nx-edit-actions nx-history-nav"),(0,d.Q$)(T,q),t.append(T.ctrls.prev.elm,T.ctrls.next.elm),t)),e}var _,z,K=n(694);function tt(t){!function(t){if(t&&t.srcData)t.dataUrl="nx-edit",(0,o.EW)(t.srcData);else{var e=(0,o.Ih)();e||(e=p()),t=b(e)}S=(0,d.gd)("UL","nx-edit-index"),w=(0,d.gd)("UL","nx-edit-local"),U=(0,d.gd)("UL","nx-edit-distant"),C=t,Z()}(t),_=(0,K.D)(t);var e,n=(0,d.gd)("DIV"),a=(0,d.gd)("DIV");a.append((E=(0,d.gd)("FORM","nx-edit-author"),["handle","url","about"].forEach((t=>{E.append(G(["author",t],null,j))})),(0,d.rH)("index",null,[E,S,(e=g(),e.addEventListener("click",(function(){var t=(0,r.O1)(10),e=C.srcData.index.length;C.srcData.threads.push(h(t)),C.srcData.index.push(t);var n=M(e,t);["local","distant"].forEach((t=>{n[t].parent.append(n[t].child)}));var a=null;S.childNodes.length&&(a=function(){S.childNodes[e-1].dispatchEvent(N)}),(0,i.am)(n.index.parent,n.index.child,!1,!0,200,a),I.disabled=!1})),e)],!0)));var l=(0,d.gd)("DIV");return l.append((0,d.rH)("local",null,[w],!0),(0,d.rH)("distant",null,[U],!0)),z=(0,d.IW)([(0,d.wI)(),$()],[a,l],[],"edit"),n.append(z,function(t,e){var n=(0,d.gd)("BUTTON","nx-edit-switch");return n.textContent="👁",n.addEventListener("click",(function(){"✎"==n.textContent?(n.textContent="👁",(0,i.Mo)(t,e)):((0,c.f2)(C,!0,!0),n.textContent="✎",(0,i.Mo)(e,t))})),n}(_,z)),n}}}]);